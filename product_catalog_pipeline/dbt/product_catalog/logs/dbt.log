[0m14:42:44.463531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfc1b1c580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfc028c850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfc028d3f0>]}


============================== 14:42:44.470807 | a72da088-6391-4ece-bae8-a414121b5bf4 ==============================
[0m14:42:44.470807 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:42:44.472058 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/product_catalog/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt deps --project-dir /usr/app/dbt/product_catalog --profiles-dir /usr/app/dbt', 'send_anonymous_usage_stats': 'True'}
[0m14:42:44.564161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a72da088-6391-4ece-bae8-a414121b5bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfc079ead0>]}
[0m14:42:44.568642 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-2gqi4u0n'
[0m14:42:44.569780 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m14:42:44.746196 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m14:42:44.748740 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m14:42:44.812673 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m14:42:44.825808 [info ] [MainThread]: Updating lock file in file path: /usr/app/dbt/product_catalog/package-lock.yml
[0m14:42:44.840393 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-38vbvauy'
[0m14:42:44.844411 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m14:42:49.601221 [info ] [MainThread]: Installed from version 1.3.2
[0m14:42:49.602345 [info ] [MainThread]: Up to date!
[0m14:42:49.603465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'a72da088-6391-4ece-bae8-a414121b5bf4', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfbfdeb580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfc03b1030>]}
[0m14:42:49.605724 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 5.211103, "process_user_time": 1.991961, "process_kernel_time": 0.490712, "process_mem_max_rss": "89208", "process_in_blocks": "288", "process_out_blocks": "784"}
[0m14:42:49.606872 [debug] [MainThread]: Command `dbt deps` succeeded at 14:42:49.606742 after 5.21 seconds
[0m14:42:49.607766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfc1b1c580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfc03b24a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bcfc028dcf0>]}
[0m14:42:49.608801 [debug] [MainThread]: Flushing usage events
[0m15:12:32.801372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3854378580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3852c94850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3852c94b20>]}


============================== 15:12:32.808853 | a4d54d9b-c23c-456f-a4fe-6979322be331 ==============================
[0m15:12:32.808853 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:12:32.810071 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/product_catalog/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt deps --project-dir /usr/app/dbt/product_catalog --profiles-dir /usr/app/dbt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:12:32.906589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a4d54d9b-c23c-456f-a4fe-6979322be331', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c385314aad0>]}
[0m15:12:33.384685 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-bivirwdb'
[0m15:12:33.385719 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m15:12:33.526340 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m15:12:33.528985 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m15:12:33.589253 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m15:12:33.596284 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m15:12:46.629972 [info ] [MainThread]: Installed from version 1.3.2
[0m15:12:46.632049 [info ] [MainThread]: Up to date!
[0m15:12:46.633508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'a4d54d9b-c23c-456f-a4fe-6979322be331', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c38527e0ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c38527a9cf0>]}
[0m15:12:46.637517 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 13.909382, "process_user_time": 2.275753, "process_kernel_time": 1.599624, "process_mem_max_rss": "88552", "process_in_blocks": "71832", "process_out_blocks": "784"}
[0m15:12:46.639096 [debug] [MainThread]: Command `dbt deps` succeeded at 15:12:46.638917 after 13.91 seconds
[0m15:12:46.640452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3854378580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c38527e33d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c38527e3580>]}
[0m15:12:46.641529 [debug] [MainThread]: Flushing usage events
[0m15:31:24.504926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7726d7648c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7726d5f67c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7726d5f676d0>]}


============================== 15:31:24.511644 | 65d29311-bc6a-4afe-a68c-088a06ba01d1 ==============================
[0m15:31:24.511644 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:31:24.512951 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/product_catalog/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt debug -t dev', 'send_anonymous_usage_stats': 'True'}
[0m15:31:24.514970 [info ] [MainThread]: dbt version: 1.7.10
[0m15:31:24.516205 [info ] [MainThread]: python version: 3.10.7
[0m15:31:24.517397 [info ] [MainThread]: python path: /usr/local/bin/python
[0m15:31:24.518555 [info ] [MainThread]: os info: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.31
[0m15:31:24.537746 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'SF_ACCOUNT'
[0m15:31:24.540854 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.09131839, "process_user_time": 1.761408, "process_kernel_time": 0.232185, "process_mem_max_rss": "86728", "process_in_blocks": "192", "process_out_blocks": "608", "command_success": false}
[0m15:31:24.542358 [debug] [MainThread]: Command `dbt debug` failed at 15:31:24.542220 after 0.09 seconds
[0m15:31:24.543509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7726d7648c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7726d5ab6620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7726d5ab7e50>]}
[0m15:31:24.544716 [debug] [MainThread]: Flushing usage events
[0m15:41:17.283764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e874976ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8748002350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e87480036d0>]}


============================== 15:41:17.290106 | ad23bf89-5f5d-45dc-bf72-69ca0d69ce3a ==============================
[0m15:41:17.290106 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:41:17.291431 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/product_catalog/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt deps', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:41:17.389428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad23bf89-5f5d-45dc-bf72-69ca0d69ce3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8749e00f10>]}
[0m15:41:17.897942 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-65rf4mmk'
[0m15:41:17.899054 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m15:41:18.030445 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m15:41:18.033139 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m15:41:18.093234 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m15:41:18.098619 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m15:41:22.729647 [info ] [MainThread]: Installed from version 1.3.2
[0m15:41:22.731090 [info ] [MainThread]: Up to date!
[0m15:41:22.732297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'ad23bf89-5f5d-45dc-bf72-69ca0d69ce3a', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8747c232b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8747a8b880>]}
[0m15:41:22.734499 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 5.506028, "process_user_time": 2.00992, "process_kernel_time": 0.592069, "process_mem_max_rss": "88904", "process_in_blocks": "840", "process_out_blocks": "784"}
[0m15:41:22.735622 [debug] [MainThread]: Command `dbt deps` succeeded at 15:41:22.735487 after 5.51 seconds
[0m15:41:22.736559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e874976ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8747ee3bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8747c232e0>]}
[0m15:41:22.737441 [debug] [MainThread]: Flushing usage events
[0m15:41:27.042626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78356e56c880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78356ce88670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78356ce89ab0>]}


============================== 15:41:27.049905 | 158f7d2a-f93d-4383-9bc0-65e72c18fe1b ==============================
[0m15:41:27.049905 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:41:27.051320 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/product_catalog/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt debug -t dev', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:41:27.054436 [info ] [MainThread]: dbt version: 1.7.10
[0m15:41:27.055936 [info ] [MainThread]: python version: 3.10.7
[0m15:41:27.057181 [info ] [MainThread]: python path: /usr/local/bin/python
[0m15:41:27.060502 [info ] [MainThread]: os info: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.31
[0m15:41:27.337629 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m15:41:27.339246 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m15:41:27.340397 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/product_catalog/dbt_project.yml
[0m15:41:27.341716 [info ] [MainThread]: adapter type: snowflake
[0m15:41:27.343012 [info ] [MainThread]: adapter version: 1.7.2
[0m15:41:27.432054 [info ] [MainThread]: Configuration:
[0m15:41:27.433663 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m15:41:27.435258 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m15:41:27.436466 [info ] [MainThread]: Required dependencies:
[0m15:41:27.437581 [debug] [MainThread]: Executing "git --help"
[0m15:41:27.451280 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m15:41:27.453187 [debug] [MainThread]: STDERR: "b''"
[0m15:41:27.454646 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m15:41:27.455910 [info ] [MainThread]: Connection:
[0m15:41:27.457022 [info ] [MainThread]:   account: EAFJVKZ-XEB20360
[0m15:41:27.458668 [info ] [MainThread]:   user: Rohil
[0m15:41:27.460494 [info ] [MainThread]:   database: PRODUCT_CATALOG
[0m15:41:27.461685 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m15:41:27.462758 [info ] [MainThread]:   role: SYSADMIN
[0m15:41:27.464000 [info ] [MainThread]:   schema: CORE
[0m15:41:27.466056 [info ] [MainThread]:   authenticator: None
[0m15:41:27.467334 [info ] [MainThread]:   private_key_path: None
[0m15:41:27.468396 [info ] [MainThread]:   oauth_client_id: None
[0m15:41:27.469501 [info ] [MainThread]:   query_tag: None
[0m15:41:27.470870 [info ] [MainThread]:   client_session_keep_alive: False
[0m15:41:27.472629 [info ] [MainThread]:   host: None
[0m15:41:27.473947 [info ] [MainThread]:   port: None
[0m15:41:27.475030 [info ] [MainThread]:   proxy_host: None
[0m15:41:27.476175 [info ] [MainThread]:   proxy_port: None
[0m15:41:27.477596 [info ] [MainThread]:   protocol: None
[0m15:41:27.479194 [info ] [MainThread]:   connect_retries: 1
[0m15:41:27.480294 [info ] [MainThread]:   connect_timeout: None
[0m15:41:27.481328 [info ] [MainThread]:   retry_on_database_errors: False
[0m15:41:27.482812 [info ] [MainThread]:   retry_all: False
[0m15:41:27.484714 [info ] [MainThread]:   insecure_mode: False
[0m15:41:27.486036 [info ] [MainThread]:   reuse_connections: None
[0m15:41:27.487382 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:41:27.488978 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m15:41:27.490941 [debug] [MainThread]: Using snowflake connection "debug"
[0m15:41:27.492146 [debug] [MainThread]: On debug: select 1 as id
[0m15:41:27.493079 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:41:28.461386 [debug] [MainThread]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:41:28.463144 [debug] [MainThread]: On debug: Close
[0m15:41:28.613910 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m15:41:28.615446 [info ] [MainThread]: [32mAll checks passed![0m
[0m15:41:28.618095 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.6370093, "process_user_time": 2.357409, "process_kernel_time": 0.303789, "process_mem_max_rss": "108484", "process_in_blocks": "3056", "process_out_blocks": "2560"}
[0m15:41:28.619644 [debug] [MainThread]: Command `dbt debug` succeeded at 15:41:28.619511 after 1.64 seconds
[0m15:41:28.620761 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m15:41:28.622138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78356e56c880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78356cf7c250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78356bf1e800>]}
[0m15:41:28.623658 [debug] [MainThread]: Flushing usage events
[0m15:50:53.355411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f695324580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f693c42140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f693c41150>]}


============================== 15:50:53.363151 | 0bdc5978-5780-420e-9256-acf30773db83 ==============================
[0m15:50:53.363151 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:50:53.364570 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt deps', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:50:53.459802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0bdc5978-5780-420e-9256-acf30773db83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f6940e2ad0>]}
[0m15:50:54.393411 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-b3e3qie8'
[0m15:50:54.394657 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m15:50:54.623670 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m15:50:54.625904 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m15:50:54.696402 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m15:50:54.701871 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m15:50:59.131503 [info ] [MainThread]: Installed from version 1.3.2
[0m15:50:59.132930 [info ] [MainThread]: Up to date!
[0m15:50:59.134159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '0bdc5978-5780-420e-9256-acf30773db83', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f693d30b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f693754400>]}
[0m15:50:59.136964 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 5.8385386, "process_user_time": 1.933562, "process_kernel_time": 0.654371, "process_mem_max_rss": "88340", "process_in_blocks": "71704", "process_out_blocks": "784"}
[0m15:50:59.138371 [debug] [MainThread]: Command `dbt deps` succeeded at 15:50:59.138229 after 5.84 seconds
[0m15:50:59.139403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f695324580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f693d30b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f693788130>]}
[0m15:50:59.140423 [debug] [MainThread]: Flushing usage events
[0m15:52:19.311556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72decbffcc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72deca771270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72deca770eb0>]}


============================== 15:52:19.318154 | 8e35ad0b-8a8a-4d20-b336-f4c3f6a913d6 ==============================
[0m15:52:19.318154 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:52:19.319670 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:52:19.321339 [info ] [MainThread]: dbt version: 1.7.10
[0m15:52:19.322390 [info ] [MainThread]: python version: 3.10.7
[0m15:52:19.323338 [info ] [MainThread]: python path: /usr/local/bin/python
[0m15:52:19.324222 [info ] [MainThread]: os info: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.31
[0m15:52:19.613281 [info ] [MainThread]: Using profiles dir at /usr/app/dbt
[0m15:52:19.615041 [info ] [MainThread]: Using profiles.yml file at /usr/app/dbt/profiles.yml
[0m15:52:19.616159 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt/product_catalog/dbt_project.yml
[0m15:52:19.617590 [info ] [MainThread]: adapter type: snowflake
[0m15:52:19.618524 [info ] [MainThread]: adapter version: 1.7.2
[0m15:52:19.693706 [info ] [MainThread]: Configuration:
[0m15:52:19.695212 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m15:52:19.696804 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m15:52:19.697815 [info ] [MainThread]: Required dependencies:
[0m15:52:19.698823 [debug] [MainThread]: Executing "git --help"
[0m15:52:19.711529 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone             Clone a repository into a new directory\n   init              Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add               Add file contents to the index\n   mv                Move or rename a file, a directory, or a symlink\n   restore           Restore working tree files\n   rm                Remove files from the working tree and from the index\n   sparse-checkout   Initialize and modify the sparse-checkout\n\nexamine the history and state (see also: git help revisions)\n   bisect            Use binary search to find the commit that introduced a bug\n   diff              Show changes between commits, commit and working tree, etc\n   grep              Print lines matching a pattern\n   log               Show commit logs\n   show              Show various types of objects\n   status            Show the working tree status\n\ngrow, mark and tweak your common history\n   branch            List, create, or delete branches\n   commit            Record changes to the repository\n   merge             Join two or more development histories together\n   rebase            Reapply commits on top of another base tip\n   reset             Reset current HEAD to the specified state\n   switch            Switch branches\n   tag               Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch             Download objects and refs from another repository\n   pull              Fetch from and integrate with another repository or a local branch\n   push              Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m15:52:19.712925 [debug] [MainThread]: STDERR: "b''"
[0m15:52:19.713809 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m15:52:19.714755 [info ] [MainThread]: Connection:
[0m15:52:19.715683 [info ] [MainThread]:   account: EAFJVKZ-XEB20360
[0m15:52:19.716750 [info ] [MainThread]:   user: Rohil
[0m15:52:19.717758 [info ] [MainThread]:   database: PRODUCT_CATALOG
[0m15:52:19.718718 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m15:52:19.719642 [info ] [MainThread]:   role: SYSADMIN
[0m15:52:19.720620 [info ] [MainThread]:   schema: CORE
[0m15:52:19.721609 [info ] [MainThread]:   authenticator: None
[0m15:52:19.722543 [info ] [MainThread]:   private_key_path: None
[0m15:52:19.723468 [info ] [MainThread]:   oauth_client_id: None
[0m15:52:19.724417 [info ] [MainThread]:   query_tag: None
[0m15:52:19.725518 [info ] [MainThread]:   client_session_keep_alive: False
[0m15:52:19.726586 [info ] [MainThread]:   host: None
[0m15:52:19.727645 [info ] [MainThread]:   port: None
[0m15:52:19.728664 [info ] [MainThread]:   proxy_host: None
[0m15:52:19.729785 [info ] [MainThread]:   proxy_port: None
[0m15:52:19.730743 [info ] [MainThread]:   protocol: None
[0m15:52:19.732000 [info ] [MainThread]:   connect_retries: 1
[0m15:52:19.733368 [info ] [MainThread]:   connect_timeout: None
[0m15:52:19.734464 [info ] [MainThread]:   retry_on_database_errors: False
[0m15:52:19.735400 [info ] [MainThread]:   retry_all: False
[0m15:52:19.736376 [info ] [MainThread]:   insecure_mode: False
[0m15:52:19.737536 [info ] [MainThread]:   reuse_connections: None
[0m15:52:19.738886 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:52:19.740228 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m15:52:19.741451 [debug] [MainThread]: Using snowflake connection "debug"
[0m15:52:19.742581 [debug] [MainThread]: On debug: select 1 as id
[0m15:52:19.743578 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:52:20.870058 [debug] [MainThread]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:52:20.871813 [debug] [MainThread]: On debug: Close
[0m15:52:21.103103 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m15:52:21.104777 [info ] [MainThread]: [32mAll checks passed![0m
[0m15:52:21.107191 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.8493661, "process_user_time": 2.164861, "process_kernel_time": 0.394342, "process_mem_max_rss": "107656", "process_in_blocks": "91624", "process_out_blocks": "2560"}
[0m15:52:21.108491 [debug] [MainThread]: Command `dbt debug` succeeded at 15:52:21.108348 after 1.85 seconds
[0m15:52:21.109567 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m15:52:21.110478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72decbffcc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72dec93ff460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72dec9309fc0>]}
[0m15:52:21.111558 [debug] [MainThread]: Flushing usage events
[0m15:57:10.398301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544f7d4370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544dc557e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544dc55780>]}


============================== 15:57:10.404468 | dfb258c4-1a96-4a64-bb01-545bbacf473e ==============================
[0m15:57:10.404468 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:57:10.405994 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:57:10.776804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dfb258c4-1a96-4a64-bb01-545bbacf473e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544dc93520>]}
[0m15:57:10.856473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dfb258c4-1a96-4a64-bb01-545bbacf473e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544e456aa0>]}
[0m15:57:10.858673 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:57:10.888546 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:57:10.896104 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m15:57:10.897310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'dfb258c4-1a96-4a64-bb01-545bbacf473e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544cb311e0>]}
[0m15:57:13.356384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dfb258c4-1a96-4a64-bb01-545bbacf473e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544cab4b80>]}
[0m15:57:13.387561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dfb258c4-1a96-4a64-bb01-545bbacf473e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544c0e95d0>]}
[0m15:57:13.389101 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m15:57:13.392325 [info ] [MainThread]: 
[0m15:57:13.394125 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:57:13.396425 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m15:57:13.397790 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m15:57:13.398967 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m15:57:13.411906 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m15:57:13.415120 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m15:57:13.419179 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m15:57:13.421251 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m15:57:13.423019 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m15:57:13.424117 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m15:57:13.425445 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:57:13.426428 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:57:13.427515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:57:14.959095 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 2.0 seconds
[0m15:57:14.961597 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m15:57:14.995363 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 2.0 seconds
[0m15:57:14.998098 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m15:57:15.012110 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 2.0 seconds
[0m15:57:15.014555 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m15:57:15.161407 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now create_PRODUCT_CATALOG_snapshots)
[0m15:57:15.162726 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now create_PRODUCT_CATALOG_CORE_core)
[0m15:57:15.163717 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now create_PRODUCT_CATALOG_CORE_staging)
[0m15:57:15.165530 [debug] [ThreadPool]: Creating schema "database: "PRODUCT_CATALOG"
schema: "snapshots"
"
[0m15:57:15.168418 [debug] [ThreadPool]: Creating schema "database: "PRODUCT_CATALOG"
schema: "CORE_core"
"
[0m15:57:15.171090 [debug] [ThreadPool]: Creating schema "database: "PRODUCT_CATALOG"
schema: "CORE_staging"
"
[0m15:57:15.189475 [debug] [ThreadPool]: Using snowflake connection "create_PRODUCT_CATALOG_snapshots"
[0m15:57:15.193417 [debug] [ThreadPool]: Using snowflake connection "create_PRODUCT_CATALOG_CORE_core"
[0m15:57:15.198370 [debug] [ThreadPool]: Using snowflake connection "create_PRODUCT_CATALOG_CORE_staging"
[0m15:57:15.199888 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "create_PRODUCT_CATALOG_snapshots"} */
create schema if not exists PRODUCT_CATALOG.snapshots
[0m15:57:15.201129 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "create_PRODUCT_CATALOG_CORE_core"} */
create schema if not exists PRODUCT_CATALOG.CORE_core
[0m15:57:15.202259 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "create_PRODUCT_CATALOG_CORE_staging"} */
create schema if not exists PRODUCT_CATALOG.CORE_staging
[0m15:57:15.203636 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:15.205891 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:15.207362 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:15.665911 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01c0583d-0106-fd6e-0016-c3df0001468a
[0m15:57:15.666774 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01c0583d-0106-fd6e-0016-c3df0001468e
[0m15:57:15.667495 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 003001 (42501): SQL access control error:
Insufficient privileges to operate on database 'PRODUCT_CATALOG'.
[0m15:57:15.669038 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 003001 (42501): SQL access control error:
Insufficient privileges to operate on database 'PRODUCT_CATALOG'.
[0m15:57:15.669563 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01c0583d-0106-ffa7-0016-c3df0001801e
[0m15:57:15.670320 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro create_schema
[0m15:57:15.671478 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro create_schema
[0m15:57:15.672517 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 003001 (42501): SQL access control error:
Insufficient privileges to operate on database 'PRODUCT_CATALOG'.
[0m15:57:15.673540 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m15:57:15.674521 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m15:57:15.675636 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro create_schema
[0m15:57:15.676499 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_CORE_core: Close
[0m15:57:15.677377 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_snapshots: Close
[0m15:57:15.678307 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m15:57:15.683063 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_CORE_staging: Close
[0m15:57:15.834666 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:57:15.835858 [debug] [MainThread]: Connection 'create_PRODUCT_CATALOG_CORE_staging' was properly closed.
[0m15:57:15.836810 [debug] [MainThread]: Connection 'create_PRODUCT_CATALOG_snapshots' was properly closed.
[0m15:57:15.837718 [debug] [MainThread]: Connection 'create_PRODUCT_CATALOG_CORE_core' was properly closed.
[0m15:57:15.838600 [info ] [MainThread]: 
[0m15:57:15.839632 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 2.44 seconds (2.44s).
[0m15:57:15.840853 [error] [MainThread]: Encountered an error:
Database Error
  003001 (42501): SQL access control error:
  Insufficient privileges to operate on database 'PRODUCT_CATALOG'.
[0m15:57:15.843029 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 5.50036, "process_user_time": 4.646712, "process_kernel_time": 0.550898, "process_mem_max_rss": "129320", "process_in_blocks": "95160", "process_out_blocks": "5528", "command_success": false}
[0m15:57:15.844262 [debug] [MainThread]: Command `dbt build` failed at 15:57:15.844146 after 5.50 seconds
[0m15:57:15.845332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544f7d4370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544cab4b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b544483d570>]}
[0m15:57:15.846297 [debug] [MainThread]: Flushing usage events
[0m16:01:07.298682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefeb2c580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefcf5d810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefcf5d7b0>]}


============================== 16:01:07.304086 | ae4c6114-e360-4e5f-b007-3161e1a41f1f ==============================
[0m16:01:07.304086 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:01:07.305450 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/product_catalog/logs', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt build', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:01:07.586588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae4c6114-e360-4e5f-b007-3161e1a41f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefcf9b550>]}
[0m16:01:07.664281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ae4c6114-e360-4e5f-b007-3161e1a41f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefd8eaad0>]}
[0m16:01:07.665642 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:01:07.692142 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:01:08.764711 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:01:08.765787 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:01:08.771990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ae4c6114-e360-4e5f-b007-3161e1a41f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefbb92620>]}
[0m16:01:08.803779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ae4c6114-e360-4e5f-b007-3161e1a41f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefbd23e50>]}
[0m16:01:08.804868 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:01:08.807621 [info ] [MainThread]: 
[0m16:01:08.809415 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:01:08.811888 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:01:08.813180 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:01:08.814813 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:01:08.828684 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:01:08.831258 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:01:08.834193 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:01:08.835262 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:01:08.836217 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:01:08.837194 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:01:08.838190 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:01:08.839126 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:01:08.840156 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:01:10.273437 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m16:01:10.274755 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m16:01:10.276410 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:01:10.278466 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:01:10.297150 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m16:01:10.299331 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:01:10.448348 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now create_PRODUCT_CATALOG_snapshots)
[0m16:01:10.448957 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now create_PRODUCT_CATALOG_CORE_core)
[0m16:01:10.449594 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now create_PRODUCT_CATALOG_CORE_staging)
[0m16:01:10.450702 [debug] [ThreadPool]: Creating schema "database: "PRODUCT_CATALOG"
schema: "snapshots"
"
[0m16:01:10.451954 [debug] [ThreadPool]: Creating schema "database: "PRODUCT_CATALOG"
schema: "CORE_core"
"
[0m16:01:10.453297 [debug] [ThreadPool]: Creating schema "database: "PRODUCT_CATALOG"
schema: "CORE_staging"
"
[0m16:01:10.458952 [debug] [ThreadPool]: Using snowflake connection "create_PRODUCT_CATALOG_snapshots"
[0m16:01:10.461323 [debug] [ThreadPool]: Using snowflake connection "create_PRODUCT_CATALOG_CORE_core"
[0m16:01:10.463674 [debug] [ThreadPool]: Using snowflake connection "create_PRODUCT_CATALOG_CORE_staging"
[0m16:01:10.464553 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "create_PRODUCT_CATALOG_snapshots"} */
create schema if not exists PRODUCT_CATALOG.snapshots
[0m16:01:10.465460 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "create_PRODUCT_CATALOG_CORE_core"} */
create schema if not exists PRODUCT_CATALOG.CORE_core
[0m16:01:10.466385 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "create_PRODUCT_CATALOG_CORE_staging"} */
create schema if not exists PRODUCT_CATALOG.CORE_staging
[0m16:01:10.467391 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:01:10.468421 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:01:10.469268 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:01:10.880677 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:01:10.882549 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_snapshots: Close
[0m16:01:10.895372 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:01:10.897015 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_CORE_staging: Close
[0m16:01:10.926561 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:01:10.928371 [debug] [ThreadPool]: On create_PRODUCT_CATALOG_CORE_core: Close
[0m16:01:11.110093 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_PRODUCT_CATALOG_snapshots, now list_PRODUCT_CATALOG_snapshots)
[0m16:01:11.110946 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_PRODUCT_CATALOG_CORE_core, now list_PRODUCT_CATALOG_CORE_core)
[0m16:01:11.111703 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_PRODUCT_CATALOG_CORE_staging, now list_PRODUCT_CATALOG_CORE_staging)
[0m16:01:11.120073 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:01:11.122381 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:01:11.125792 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:01:11.126814 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:01:11.127849 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:01:11.128679 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:01:11.129571 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:01:11.130370 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:01:11.131172 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:01:11.553097 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:01:11.553838 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:01:11.555744 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:01:11.557544 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:01:11.562819 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:01:11.564642 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:01:11.714871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae4c6114-e360-4e5f-b007-3161e1a41f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefbc539a0>]}
[0m16:01:11.716412 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:01:11.717470 [info ] [MainThread]: 
[0m16:01:11.731569 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:01:11.732908 [info ] [Thread-1 (]: 1 of 13 START sql view model CORE_staging.stg_products ......................... [RUN]
[0m16:01:11.734243 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_staging, now model.product_catalog.stg_products)
[0m16:01:11.735283 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:01:11.743565 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:01:11.761719 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:01:11.736059 => 16:01:11.761173
[0m16:01:11.763034 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:01:11.785290 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:01:11.802037 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:01:11.803140 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      TRY_TO_TIMESTAMP_NTZ(scraped_at)                             AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean as (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)              AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                       AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP())       AS updated_at,
    CURRENT_TIMESTAMP()                             AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m16:01:11.804154 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:01:12.255931 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c05841-0106-ffa7-0016-c3df00018086
[0m16:01:12.257083 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001065 (22023): SQL compilation error:
Function TRY_CAST cannot be used with arguments of types TIMESTAMP_NTZ(9) and TIMESTAMP_NTZ(9)
[0m16:01:12.258139 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:01:11.763896 => 16:01:12.257937
[0m16:01:12.259155 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:01:12.433848 [debug] [Thread-1 (]: Database Error in model stg_products (models/staging/stg_products.sql)
  001065 (22023): SQL compilation error:
  Function TRY_CAST cannot be used with arguments of types TIMESTAMP_NTZ(9) and TIMESTAMP_NTZ(9)
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:01:12.435254 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae4c6114-e360-4e5f-b007-3161e1a41f1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefa04da80>]}
[0m16:01:12.436475 [error] [Thread-1 (]: 1 of 13 ERROR creating sql view model CORE_staging.stg_products ................ [[31mERROR[0m in 0.70s]
[0m16:01:12.437827 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:01:12.439637 [debug] [Thread-3 (]: Began running node test.product_catalog.accepted_range_stg_products_price__True__0.8363496875
[0m16:01:12.440221 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:01:12.440677 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:01:12.441581 [info ] [Thread-3 (]: 2 of 13 SKIP test accepted_range_stg_products_price__True__0 ................... [[33mSKIP[0m]
[0m16:01:12.442683 [info ] [Thread-4 (]: 3 of 13 SKIP test not_null_stg_products_product_nk ............................. [[33mSKIP[0m]
[0m16:01:12.443923 [info ] [Thread-2 (]: 4 of 13 SKIP test not_null_stg_products_updated_at ............................. [[33mSKIP[0m]
[0m16:01:12.445272 [debug] [Thread-3 (]: Finished running node test.product_catalog.accepted_range_stg_products_price__True__0.8363496875
[0m16:01:12.446900 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:01:12.448395 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:01:12.451607 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m16:01:12.451999 [debug] [Thread-3 (]: Began running node snapshot.product_catalog.product_snapshot
[0m16:01:12.452769 [info ] [Thread-1 (]: 5 of 13 SKIP relation CORE_core.dim_product_scd2_window ........................ [[33mSKIP[0m]
[0m16:01:12.453892 [info ] [Thread-3 (]: 6 of 13 SKIP relation snapshots.product_snapshot ............................... [[33mSKIP[0m]
[0m16:01:12.455137 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m16:01:12.456308 [debug] [Thread-3 (]: Finished running node snapshot.product_catalog.product_snapshot
[0m16:01:12.457772 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:01:12.458139 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:01:12.458575 [debug] [Thread-1 (]: Began running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:01:12.459603 [debug] [Thread-3 (]: Began running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:01:12.460444 [info ] [Thread-2 (]: 7 of 13 SKIP test not_null_dim_product_scd2_window_dim_product_sk .............. [[33mSKIP[0m]
[0m16:01:12.461779 [info ] [Thread-4 (]: 8 of 13 SKIP test not_null_dim_product_scd2_window_product_nk .................. [[33mSKIP[0m]
[0m16:01:12.463073 [info ] [Thread-1 (]: 9 of 13 SKIP test unique_dim_product_scd2_window_dim_product_sk ................ [[33mSKIP[0m]
[0m16:01:12.464143 [info ] [Thread-3 (]: 10 of 13 SKIP relation CORE_core.dim_product_scd2_from_snapshot ................ [[33mSKIP[0m]
[0m16:01:12.465419 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:01:12.466750 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:01:12.467867 [debug] [Thread-1 (]: Finished running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:01:12.468835 [debug] [Thread-3 (]: Finished running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:01:12.472792 [debug] [Thread-2 (]: Began running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:01:12.473316 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:01:12.473721 [debug] [Thread-1 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:01:12.474544 [info ] [Thread-2 (]: 11 of 13 SKIP test dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [[33mSKIP[0m]
[0m16:01:12.475405 [info ] [Thread-4 (]: 12 of 13 SKIP test not_null_dim_product_scd2_from_snapshot_is_current .......... [[33mSKIP[0m]
[0m16:01:12.476554 [info ] [Thread-1 (]: 13 of 13 SKIP test not_null_dim_product_scd2_from_snapshot_product_nk .......... [[33mSKIP[0m]
[0m16:01:12.478070 [debug] [Thread-2 (]: Finished running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:01:12.479567 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:01:12.480614 [debug] [Thread-1 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:01:12.484598 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:01:12.485909 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_snapshots' was properly closed.
[0m16:01:12.486852 [debug] [MainThread]: Connection 'model.product_catalog.stg_products' was properly closed.
[0m16:01:12.487640 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_core' was properly closed.
[0m16:01:12.488608 [info ] [MainThread]: 
[0m16:01:12.489685 [info ] [MainThread]: Finished running 1 view model, 9 tests, 2 table models, 1 snapshot in 0 hours 0 minutes and 3.68 seconds (3.68s).
[0m16:01:12.491324 [debug] [MainThread]: Command end result
[0m16:01:12.515610 [info ] [MainThread]: 
[0m16:01:12.517004 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:01:12.518356 [info ] [MainThread]: 
[0m16:01:12.519600 [error] [MainThread]:   Database Error in model stg_products (models/staging/stg_products.sql)
  001065 (22023): SQL compilation error:
  Function TRY_CAST cannot be used with arguments of types TIMESTAMP_NTZ(9) and TIMESTAMP_NTZ(9)
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:01:12.520914 [info ] [MainThread]: 
[0m16:01:12.522185 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=12 TOTAL=13
[0m16:01:12.524338 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 5.2738132, "process_user_time": 3.296922, "process_kernel_time": 0.556204, "process_mem_max_rss": "124568", "process_in_blocks": "192", "process_out_blocks": "6472", "command_success": false}
[0m16:01:12.525892 [debug] [MainThread]: Command `dbt build` failed at 16:01:12.525736 after 5.28 seconds
[0m16:01:12.527005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefeb2c580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefba21060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdefba20af0>]}
[0m16:01:12.528146 [debug] [MainThread]: Flushing usage events
[0m16:02:22.898359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa82d8370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa67497e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa6749780>]}


============================== 16:02:22.904558 | 07113fbc-7f56-41bc-aff4-8f5e08be1518 ==============================
[0m16:02:22.904558 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:02:22.906032 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt build', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:02:23.288564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07113fbc-7f56-41bc-aff4-8f5e08be1518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa6787520>]}
[0m16:02:23.368789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07113fbc-7f56-41bc-aff4-8f5e08be1518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa7086aa0>]}
[0m16:02:23.370966 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:02:23.399557 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:02:24.473378 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:02:24.474389 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:02:24.481030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07113fbc-7f56-41bc-aff4-8f5e08be1518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa53825f0>]}
[0m16:02:24.511426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07113fbc-7f56-41bc-aff4-8f5e08be1518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa5511660>]}
[0m16:02:24.512686 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:02:24.515552 [info ] [MainThread]: 
[0m16:02:24.517591 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:02:24.520045 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:02:24.521186 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:02:24.522235 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:02:24.535322 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:02:24.537962 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:02:24.541069 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:02:24.542246 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:02:24.543356 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:02:24.544322 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:02:24.545244 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:02:24.546141 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:02:24.547041 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:02:26.145472 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:02:26.147741 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:02:26.192242 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:02:26.194724 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:02:26.219650 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:02:26.222138 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:02:26.393703 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m16:02:26.394534 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m16:02:26.395349 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m16:02:26.404023 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:02:26.406504 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:02:26.409501 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:02:26.410616 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:02:26.411632 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:02:26.412520 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:02:26.413397 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:26.414450 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:26.415349 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:26.780126 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:02:26.783903 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:02:26.849980 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:02:26.852224 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:02:26.942699 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.0 seconds
[0m16:02:26.944883 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:02:27.079239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07113fbc-7f56-41bc-aff4-8f5e08be1518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa51f3b50>]}
[0m16:02:27.080932 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:02:27.082084 [info ] [MainThread]: 
[0m16:02:27.090337 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:02:27.091734 [info ] [Thread-1 (]: 1 of 13 START sql view model CORE_staging.stg_products ......................... [RUN]
[0m16:02:27.093389 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now model.product_catalog.stg_products)
[0m16:02:27.094576 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:02:27.103000 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:02:27.112406 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:02:27.095553 => 16:02:27.112042
[0m16:02:27.113486 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:02:27.138303 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:02:27.147765 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:02:27.148895 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      TRY_TO_TIMESTAMP_NTZ(scraped_at)                             AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean as (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)              AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                       AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP())       AS updated_at,
    CURRENT_TIMESTAMP()                             AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m16:02:27.150006 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:27.630805 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c05842-0106-fd6e-0016-c3df000146fe
[0m16:02:27.632040 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001065 (22023): SQL compilation error:
Function TRY_CAST cannot be used with arguments of types TIMESTAMP_NTZ(9) and TIMESTAMP_NTZ(9)
[0m16:02:27.633329 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:02:27.114244 => 16:02:27.633108
[0m16:02:27.634332 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:02:27.771972 [debug] [Thread-1 (]: Database Error in model stg_products (models/staging/stg_products.sql)
  001065 (22023): SQL compilation error:
  Function TRY_CAST cannot be used with arguments of types TIMESTAMP_NTZ(9) and TIMESTAMP_NTZ(9)
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:02:27.773425 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07113fbc-7f56-41bc-aff4-8f5e08be1518', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa51f3550>]}
[0m16:02:27.774583 [error] [Thread-1 (]: 1 of 13 ERROR creating sql view model CORE_staging.stg_products ................ [[31mERROR[0m in 0.68s]
[0m16:02:27.775964 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:02:27.777655 [debug] [Thread-3 (]: Began running node test.product_catalog.accepted_range_stg_products_price__True__0.8363496875
[0m16:02:27.778125 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:02:27.778573 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:02:27.779504 [info ] [Thread-3 (]: 2 of 13 SKIP test accepted_range_stg_products_price__True__0 ................... [[33mSKIP[0m]
[0m16:02:27.780671 [info ] [Thread-4 (]: 3 of 13 SKIP test not_null_stg_products_product_nk ............................. [[33mSKIP[0m]
[0m16:02:27.781985 [info ] [Thread-2 (]: 4 of 13 SKIP test not_null_stg_products_updated_at ............................. [[33mSKIP[0m]
[0m16:02:27.783343 [debug] [Thread-3 (]: Finished running node test.product_catalog.accepted_range_stg_products_price__True__0.8363496875
[0m16:02:27.784621 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:02:27.785875 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:02:27.789057 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m16:02:27.789465 [debug] [Thread-3 (]: Began running node snapshot.product_catalog.product_snapshot
[0m16:02:27.790348 [info ] [Thread-1 (]: 5 of 13 SKIP relation CORE_core.dim_product_scd2_window ........................ [[33mSKIP[0m]
[0m16:02:27.791455 [info ] [Thread-3 (]: 6 of 13 SKIP relation snapshots.product_snapshot ............................... [[33mSKIP[0m]
[0m16:02:27.792640 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m16:02:27.794006 [debug] [Thread-3 (]: Finished running node snapshot.product_catalog.product_snapshot
[0m16:02:27.795890 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:02:27.796315 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:02:27.796813 [debug] [Thread-1 (]: Began running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:02:27.797952 [debug] [Thread-3 (]: Began running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:02:27.798911 [info ] [Thread-2 (]: 7 of 13 SKIP test not_null_dim_product_scd2_window_dim_product_sk .............. [[33mSKIP[0m]
[0m16:02:27.800032 [info ] [Thread-4 (]: 8 of 13 SKIP test not_null_dim_product_scd2_window_product_nk .................. [[33mSKIP[0m]
[0m16:02:27.801395 [info ] [Thread-1 (]: 9 of 13 SKIP test unique_dim_product_scd2_window_dim_product_sk ................ [[33mSKIP[0m]
[0m16:02:27.803540 [info ] [Thread-3 (]: 10 of 13 SKIP relation CORE_core.dim_product_scd2_from_snapshot ................ [[33mSKIP[0m]
[0m16:02:27.805271 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:02:27.806468 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:02:27.807574 [debug] [Thread-1 (]: Finished running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:02:27.808502 [debug] [Thread-3 (]: Finished running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:02:27.813346 [debug] [Thread-2 (]: Began running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:02:27.813782 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:02:27.814145 [debug] [Thread-1 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:02:27.815027 [info ] [Thread-2 (]: 11 of 13 SKIP test dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [[33mSKIP[0m]
[0m16:02:27.816599 [info ] [Thread-4 (]: 12 of 13 SKIP test not_null_dim_product_scd2_from_snapshot_is_current .......... [[33mSKIP[0m]
[0m16:02:27.818060 [info ] [Thread-1 (]: 13 of 13 SKIP test not_null_dim_product_scd2_from_snapshot_product_nk .......... [[33mSKIP[0m]
[0m16:02:27.819311 [debug] [Thread-2 (]: Finished running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:02:27.820603 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:02:27.821910 [debug] [Thread-1 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:02:27.826492 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:02:27.827906 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_snapshots' was properly closed.
[0m16:02:27.828978 [debug] [MainThread]: Connection 'model.product_catalog.stg_products' was properly closed.
[0m16:02:27.829883 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_staging' was properly closed.
[0m16:02:27.830882 [info ] [MainThread]: 
[0m16:02:27.831864 [info ] [MainThread]: Finished running 1 view model, 9 tests, 2 table models, 1 snapshot in 0 hours 0 minutes and 3.31 seconds (3.31s).
[0m16:02:27.834093 [debug] [MainThread]: Command end result
[0m16:02:27.859568 [info ] [MainThread]: 
[0m16:02:27.860996 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:02:27.862142 [info ] [MainThread]: 
[0m16:02:27.863441 [error] [MainThread]:   Database Error in model stg_products (models/staging/stg_products.sql)
  001065 (22023): SQL compilation error:
  Function TRY_CAST cannot be used with arguments of types TIMESTAMP_NTZ(9) and TIMESTAMP_NTZ(9)
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:02:27.865168 [info ] [MainThread]: 
[0m16:02:27.866499 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=12 TOTAL=13
[0m16:02:27.869015 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 5.0256925, "process_user_time": 3.411995, "process_kernel_time": 0.480389, "process_mem_max_rss": "123116", "process_in_blocks": "94392", "process_out_blocks": "5584", "command_success": false}
[0m16:02:27.870567 [debug] [MainThread]: Command `dbt build` failed at 16:02:27.870370 after 5.03 seconds
[0m16:02:27.872077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa82d8370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa5453910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71eaa5511ea0>]}
[0m16:02:27.873268 [debug] [MainThread]: Flushing usage events
[0m16:08:27.683179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71519d534880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71519b9b57e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71519b9b5780>]}


============================== 16:08:27.689478 | d2e83e25-bde1-491f-9fb2-2163daae3644 ==============================
[0m16:08:27.689478 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:08:27.690861 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run -m stg_products', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:08:28.075398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd2e83e25-bde1-491f-9fb2-2163daae3644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71519b9fb520>]}
[0m16:08:28.158009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd2e83e25-bde1-491f-9fb2-2163daae3644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71519c2e2b30>]}
[0m16:08:28.160090 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:08:28.189235 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:08:29.326538 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:08:29.327779 [debug] [MainThread]: Partial parsing: updated file: product_catalog://models/staging/stg_products.sql
[0m16:08:29.597237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd2e83e25-bde1-491f-9fb2-2163daae3644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7151982ee5f0>]}
[0m16:08:29.629137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd2e83e25-bde1-491f-9fb2-2163daae3644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715198241870>]}
[0m16:08:29.630360 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:08:29.631737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2e83e25-bde1-491f-9fb2-2163daae3644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715198346f80>]}
[0m16:08:29.633789 [info ] [MainThread]: 
[0m16:08:29.635366 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:08:29.638001 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:08:29.651216 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:08:29.652727 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:08:29.653659 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:08:30.614146 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:08:30.616407 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:08:30.749013 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m16:08:30.750479 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_core'
[0m16:08:30.751390 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_staging'
[0m16:08:30.759205 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:08:30.761908 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:08:30.764867 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:08:30.765990 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:08:30.766959 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:08:30.767814 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:08:30.768714 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:08:30.769577 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:08:30.770646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:08:31.284640 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.0 seconds
[0m16:08:31.285755 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.0 seconds
[0m16:08:31.287749 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:08:31.289506 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:08:31.509394 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.0 seconds
[0m16:08:31.511759 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:08:31.646216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2e83e25-bde1-491f-9fb2-2163daae3644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7151982f1e10>]}
[0m16:08:31.648094 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:08:31.649216 [info ] [MainThread]: 
[0m16:08:31.657129 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:08:31.658489 [info ] [Thread-1 (]: 1 of 1 START sql view model CORE_staging.stg_products .......................... [RUN]
[0m16:08:31.659983 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now model.product_catalog.stg_products)
[0m16:08:31.661237 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:08:31.669911 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:08:31.678762 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:08:31.662554 => 16:08:31.678350
[0m16:08:31.680027 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:08:31.704771 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:08:31.714306 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:08:31.715522 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      CASE
        WHEN TYPEOF(scraped_at) LIKE 'TIMESTAMP%' THEN scraped_at::TIMESTAMP_NTZ
        ELSE TRY_TO_TIMESTAMP_NTZ(scraped_at)
      END                                                          AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean;
[0m16:08:31.716559 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:08:32.174008 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c05848-0106-fd6e-0016-c3df00014706
[0m16:08:32.175512 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 47 at position 19 unexpected ';'.
[0m16:08:32.176902 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:08:31.681176 => 16:08:32.176678
[0m16:08:32.177864 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:08:32.305026 [debug] [Thread-1 (]: Database Error in model stg_products (models/staging/stg_products.sql)
  001003 (42000): SQL compilation error:
  syntax error line 47 at position 19 unexpected ';'.
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:08:32.306424 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2e83e25-bde1-491f-9fb2-2163daae3644', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7151980f48b0>]}
[0m16:08:32.307585 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model CORE_staging.stg_products ................. [[31mERROR[0m in 0.65s]
[0m16:08:32.309125 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:08:32.312175 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:08:32.313172 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_snapshots' was properly closed.
[0m16:08:32.313992 [debug] [MainThread]: Connection 'model.product_catalog.stg_products' was properly closed.
[0m16:08:32.314849 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_staging' was properly closed.
[0m16:08:32.315870 [info ] [MainThread]: 
[0m16:08:32.316978 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.68 seconds (2.68s).
[0m16:08:32.318509 [debug] [MainThread]: Command end result
[0m16:08:32.344558 [info ] [MainThread]: 
[0m16:08:32.345976 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:08:32.347367 [info ] [MainThread]: 
[0m16:08:32.348900 [error] [MainThread]:   Database Error in model stg_products (models/staging/stg_products.sql)
  001003 (42000): SQL compilation error:
  syntax error line 47 at position 19 unexpected ';'.
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:08:32.350199 [info ] [MainThread]: 
[0m16:08:32.351330 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m16:08:32.353850 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.724731, "process_user_time": 2.923956, "process_kernel_time": 0.526151, "process_mem_max_rss": "126812", "process_in_blocks": "95256", "process_out_blocks": "2616", "command_success": false}
[0m16:08:32.355441 [debug] [MainThread]: Command `dbt run` failed at 16:08:32.355271 after 4.73 seconds
[0m16:08:32.356691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71519d534880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71519b9fb520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x715198241870>]}
[0m16:08:32.357800 [debug] [MainThread]: Flushing usage events
[0m16:11:20.031421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6437264610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a64356e5780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a64356e5720>]}


============================== 16:11:20.038383 | 736ff91d-f922-4c99-95c7-7c94d4324442 ==============================
[0m16:11:20.038383 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:11:20.039621 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run -m stg_products', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:11:20.429484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '736ff91d-f922-4c99-95c7-7c94d4324442', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a643572b4f0>]}
[0m16:11:20.509839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '736ff91d-f922-4c99-95c7-7c94d4324442', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6436012b00>]}
[0m16:11:20.511745 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:11:20.535358 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:11:21.621723 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:11:21.622830 [debug] [MainThread]: Partial parsing: updated file: product_catalog://models/staging/stg_products.sql
[0m16:11:21.885421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '736ff91d-f922-4c99-95c7-7c94d4324442', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a643200e5c0>]}
[0m16:11:21.918142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '736ff91d-f922-4c99-95c7-7c94d4324442', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6431f76d40>]}
[0m16:11:21.919553 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:11:21.920916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '736ff91d-f922-4c99-95c7-7c94d4324442', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a643572b580>]}
[0m16:11:21.923120 [info ] [MainThread]: 
[0m16:11:21.925014 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:11:21.927196 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:11:21.939493 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:11:21.941190 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:11:21.942197 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:22.819907 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:11:22.822280 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:11:22.951884 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m16:11:22.953073 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_staging'
[0m16:11:22.954080 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_snapshots'
[0m16:11:22.962353 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:11:22.965268 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:11:22.967963 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:11:22.968910 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:11:22.969883 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:11:22.970700 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:11:22.971508 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:11:22.972377 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:22.973279 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:23.432381 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:11:23.433132 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:11:23.435204 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:11:23.437133 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:11:23.451349 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:11:23.453368 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:11:23.619614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '736ff91d-f922-4c99-95c7-7c94d4324442', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6431e9bc70>]}
[0m16:11:23.621284 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:11:23.622688 [info ] [MainThread]: 
[0m16:11:23.637695 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:11:23.639382 [info ] [Thread-1 (]: 1 of 1 START sql view model CORE_staging.stg_products .......................... [RUN]
[0m16:11:23.641014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now model.product_catalog.stg_products)
[0m16:11:23.642235 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:11:23.650800 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:11:23.659518 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:11:23.643076 => 16:11:23.659137
[0m16:11:23.660652 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:11:23.684299 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:11:23.692882 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:11:23.694091 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      CASE
        WHEN TYPEOF(scraped_at) IN ('TIMESTAMP_NTZ', 'TIMESTAMP_LTZ', 'TIMESTAMP_TZ')
          THEN scraped_at::TIMESTAMP_NTZ
        ELSE TRY_TO_TIMESTAMP_NTZ(scraped_at)
      END                                                          AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m16:11:23.695280 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:24.100234 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c0584b-0106-fd6e-0016-c3df0001470e
[0m16:11:24.101443 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001044 (42P13): SQL compilation error: error line 22 at position 13
Invalid argument types for function 'TYPEOF': (TIMESTAMP_NTZ(9))
[0m16:11:24.102684 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:11:23.661600 => 16:11:24.102401
[0m16:11:24.103698 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:11:24.227445 [debug] [Thread-1 (]: Database Error in model stg_products (models/staging/stg_products.sql)
  001044 (42P13): SQL compilation error: error line 22 at position 13
  Invalid argument types for function 'TYPEOF': (TIMESTAMP_NTZ(9))
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:11:24.229120 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '736ff91d-f922-4c99-95c7-7c94d4324442', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6431e288e0>]}
[0m16:11:24.230562 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model CORE_staging.stg_products ................. [[31mERROR[0m in 0.59s]
[0m16:11:24.232127 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:11:24.234898 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:11:24.235822 [debug] [MainThread]: Connection 'model.product_catalog.stg_products' was properly closed.
[0m16:11:24.236789 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_staging' was properly closed.
[0m16:11:24.237740 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_snapshots' was properly closed.
[0m16:11:24.238712 [info ] [MainThread]: 
[0m16:11:24.239804 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.31 seconds (2.31s).
[0m16:11:24.241444 [debug] [MainThread]: Command end result
[0m16:11:24.266455 [info ] [MainThread]: 
[0m16:11:24.267800 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:11:24.269033 [info ] [MainThread]: 
[0m16:11:24.270169 [error] [MainThread]:   Database Error in model stg_products (models/staging/stg_products.sql)
  001044 (42P13): SQL compilation error: error line 22 at position 13
  Invalid argument types for function 'TYPEOF': (TIMESTAMP_NTZ(9))
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:11:24.271685 [info ] [MainThread]: 
[0m16:11:24.273421 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m16:11:24.276119 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.3007436, "process_user_time": 2.812072, "process_kernel_time": 0.529043, "process_mem_max_rss": "126216", "process_in_blocks": "95192", "process_out_blocks": "2616", "command_success": false}
[0m16:11:24.277966 [debug] [MainThread]: Command `dbt run` failed at 16:11:24.277721 after 4.30 seconds
[0m16:11:24.279214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6437264610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6431f764a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a6431f77fa0>]}
[0m16:11:24.280423 [debug] [MainThread]: Flushing usage events
[0m16:16:09.418706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307f40c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307d83d780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307d83d720>]}


============================== 16:16:09.425406 | e05e0293-6dbd-4503-9d06-7f5d47f00233 ==============================
[0m16:16:09.425406 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:16:09.426764 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m stg_products', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:16:09.795743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e05e0293-6dbd-4503-9d06-7f5d47f00233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307d8834f0>]}
[0m16:16:09.875548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e05e0293-6dbd-4503-9d06-7f5d47f00233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307e1deb00>]}
[0m16:16:09.877617 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:16:09.904170 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:16:11.122882 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:16:11.124188 [debug] [MainThread]: Partial parsing: updated file: product_catalog://models/staging/stg_products.sql
[0m16:16:11.400934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e05e0293-6dbd-4503-9d06-7f5d47f00233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307a18e5c0>]}
[0m16:16:11.432640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e05e0293-6dbd-4503-9d06-7f5d47f00233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307a0e6d40>]}
[0m16:16:11.434056 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:16:11.435278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e05e0293-6dbd-4503-9d06-7f5d47f00233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307d883580>]}
[0m16:16:11.437334 [info ] [MainThread]: 
[0m16:16:11.438999 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:16:11.441295 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:16:11.454624 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:16:11.455938 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:16:11.457079 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:16:12.446057 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:16:12.448555 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:16:12.588526 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m16:16:12.589792 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_snapshots'
[0m16:16:12.590747 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_staging'
[0m16:16:12.598811 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:16:12.601613 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:16:12.604521 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:16:12.605477 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:16:12.606313 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:16:12.607087 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:16:12.607914 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:16:12.608757 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:16:12.609532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:16:13.108130 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:16:13.109411 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.0 seconds
[0m16:16:13.110048 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.0 seconds
[0m16:16:13.111596 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:16:13.113991 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:16:13.115791 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:16:13.298227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e05e0293-6dbd-4503-9d06-7f5d47f00233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307a1a3d30>]}
[0m16:16:13.300071 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:16:13.301349 [info ] [MainThread]: 
[0m16:16:13.316648 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:16:13.318040 [info ] [Thread-1 (]: 1 of 1 START sql view model CORE_staging.stg_products .......................... [RUN]
[0m16:16:13.319620 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_snapshots, now model.product_catalog.stg_products)
[0m16:16:13.320826 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:16:13.329023 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:16:13.337203 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:16:13.321660 => 16:16:13.336820
[0m16:16:13.338343 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:16:13.361697 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:16:13.369947 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:16:13.371022 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      /* Always convert via string so it works for either text or timestamp inputs */
      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at
  FROM product_catalog.staging.raw_products
),

clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)

SELECT * FROM clean;
[0m16:16:13.372095 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:16:13.792208 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c05850-0106-ffa7-0016-c3df000180a2
[0m16:16:13.793552 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 47 at position 19 unexpected ';'.
[0m16:16:13.794781 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:16:13.339215 => 16:16:13.794553
[0m16:16:13.795792 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:16:13.954187 [debug] [Thread-1 (]: Database Error in model stg_products (models/staging/stg_products.sql)
  001003 (42000): SQL compilation error:
  syntax error line 47 at position 19 unexpected ';'.
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:16:13.955613 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e05e0293-6dbd-4503-9d06-7f5d47f00233', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307a09c8e0>]}
[0m16:16:13.956882 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model CORE_staging.stg_products ................. [[31mERROR[0m in 0.64s]
[0m16:16:13.958428 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:16:13.961514 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:16:13.962671 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_core' was properly closed.
[0m16:16:13.963624 [debug] [MainThread]: Connection 'model.product_catalog.stg_products' was properly closed.
[0m16:16:13.964649 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_staging' was properly closed.
[0m16:16:13.965574 [info ] [MainThread]: 
[0m16:16:13.966810 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.53 seconds (2.53s).
[0m16:16:13.968484 [debug] [MainThread]: Command end result
[0m16:16:13.993969 [info ] [MainThread]: 
[0m16:16:13.995201 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:16:13.996377 [info ] [MainThread]: 
[0m16:16:13.997528 [error] [MainThread]:   Database Error in model stg_products (models/staging/stg_products.sql)
  001003 (42000): SQL compilation error:
  syntax error line 47 at position 19 unexpected ';'.
  compiled Code at target/run/product_catalog/models/staging/stg_products.sql
[0m16:16:13.998811 [info ] [MainThread]: 
[0m16:16:14.000036 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m16:16:14.002573 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.6393027, "process_user_time": 2.90246, "process_kernel_time": 0.485784, "process_mem_max_rss": "127292", "process_in_blocks": "95192", "process_out_blocks": "2616", "command_success": false}
[0m16:16:14.004302 [debug] [MainThread]: Command `dbt run` failed at 16:16:14.004097 after 4.64 seconds
[0m16:16:14.005674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307f40c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307a0e6b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c307d8834f0>]}
[0m16:16:14.007058 [debug] [MainThread]: Flushing usage events
[0m16:19:25.452804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fc4bd73df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fc4a89b100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fc4c406830>]}


============================== 16:19:25.459423 | 9d75c708-882b-467e-a3d1-7482f7b6f86b ==============================
[0m16:19:25.459423 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:19:25.461026 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/usr/app/dbt/product_catalog/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt compile', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:19:25.470806 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'SF_ACCOUNT'
[0m16:19:25.473133 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_wall_clock_time": 0.07608189, "process_user_time": 1.728393, "process_kernel_time": 0.308351, "process_mem_max_rss": "86100", "process_in_blocks": "66808", "process_out_blocks": "608", "command_success": false}
[0m16:19:25.474586 [debug] [MainThread]: Command `dbt compile` failed at 16:19:25.474437 after 0.08 seconds
[0m16:19:25.475727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fc4bd73df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fc4c405f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fc4a229ea0>]}
[0m16:19:25.476734 [debug] [MainThread]: Flushing usage events
[0m16:19:35.069238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7430246d8c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743022ff5270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743022ff4eb0>]}


============================== 16:19:35.075218 | 0b78328c-f5f1-4151-95e7-585e5d05dc1b ==============================
[0m16:19:35.075218 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:19:35.076586 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/product_catalog/logs', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt clean', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:19:35.172023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0b78328c-f5f1-4151-95e7-585e5d05dc1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743023496a70>]}
[0m16:19:35.741538 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.7253655, "process_user_time": 1.759124, "process_kernel_time": 0.272484, "process_mem_max_rss": "87012", "process_in_blocks": "888", "process_out_blocks": "608"}
[0m16:19:35.742889 [debug] [MainThread]: Command `dbt clean` succeeded at 16:19:35.742766 after 0.73 seconds
[0m16:19:35.744011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7430246d8c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743022b426e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743022b43e50>]}
[0m16:19:35.745088 [debug] [MainThread]: Flushing usage events
[0m16:19:39.250414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2407cd4610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2406155780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2406155720>]}


============================== 16:19:39.256322 | 43571766-920d-4ba5-b2b9-49297f00f9e6 ==============================
[0m16:19:39.256322 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:19:39.257478 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/product_catalog/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m stg_products', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:19:39.632032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '43571766-920d-4ba5-b2b9-49297f00f9e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2405f9f4f0>]}
[0m16:19:39.715126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '43571766-920d-4ba5-b2b9-49297f00f9e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d240695ab00>]}
[0m16:19:39.717154 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:19:39.719226 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m16:19:39.721134 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5232059, "process_user_time": 2.045241, "process_kernel_time": 0.285382, "process_mem_max_rss": "103524", "process_in_blocks": "20152", "process_out_blocks": "616", "command_success": false}
[0m16:19:39.722524 [debug] [MainThread]: Command `dbt run` failed at 16:19:39.722397 after 0.52 seconds
[0m16:19:39.723524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2407cd4610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2404eb77f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2404eb42b0>]}
[0m16:19:39.724480 [debug] [MainThread]: Flushing usage events
[0m16:19:57.430555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b46669f0e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b466530e140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b466530d030>]}


============================== 16:19:57.436762 | 636a09b8-560f-4ac8-8008-70d626f00e45 ==============================
[0m16:19:57.436762 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:19:57.437956 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt compile', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:19:57.447334 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'SF_ACCOUNT'
[0m16:19:57.449389 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_wall_clock_time": 0.07039414, "process_user_time": 1.722566, "process_kernel_time": 0.216826, "process_mem_max_rss": "86108", "process_out_blocks": "608", "command_success": false, "process_in_blocks": "0"}
[0m16:19:57.450880 [debug] [MainThread]: Command `dbt compile` failed at 16:19:57.450714 after 0.07 seconds
[0m16:19:57.452014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b46669f0e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4664e59b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4664e59f00>]}
[0m16:19:57.453096 [debug] [MainThread]: Flushing usage events
[0m16:22:03.901970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6764354610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6762ac8880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6762ac8b50>]}


============================== 16:22:03.908485 | 7b55393e-ea7c-447b-aad5-d7a4b9a36c27 ==============================
[0m16:22:03.908485 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:22:03.909732 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/product_catalog/logs', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m16:22:04.001836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7b55393e-ea7c-447b-aad5-d7a4b9a36c27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6763102b00>]}
[0m16:22:04.015905 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-b5abug2n'
[0m16:22:04.017007 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m16:22:04.134029 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m16:22:04.136808 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m16:22:04.201682 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m16:22:04.207736 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m16:22:08.568448 [info ] [MainThread]: Installed from version 1.3.2
[0m16:22:08.569672 [info ] [MainThread]: Up to date!
[0m16:22:08.570921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '7b55393e-ea7c-447b-aad5-d7a4b9a36c27', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6762808ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f67627d41c0>]}
[0m16:22:08.573266 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 4.724112, "process_user_time": 1.901359, "process_kernel_time": 0.564274, "process_mem_max_rss": "88348", "process_in_blocks": "71704", "process_out_blocks": "784"}
[0m16:22:08.574495 [debug] [MainThread]: Command `dbt deps` succeeded at 16:22:08.574382 after 4.73 seconds
[0m16:22:08.575430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6764354610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f676280b3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f676280b580>]}
[0m16:22:08.576330 [debug] [MainThread]: Flushing usage events
[0m16:22:12.034654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708658f74580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7086573f5750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7086573f56f0>]}


============================== 16:22:12.040397 | a52f4fa8-78c5-48f5-a69a-adc44c52a74d ==============================
[0m16:22:12.040397 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:22:12.041678 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run -m stg_products', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:22:12.402939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a52f4fa8-78c5-48f5-a69a-adc44c52a74d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70865723f4c0>]}
[0m16:22:12.481933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a52f4fa8-78c5-48f5-a69a-adc44c52a74d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708657bfaad0>]}
[0m16:22:12.484057 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:22:12.512357 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:22:12.519207 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:22:12.520221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a52f4fa8-78c5-48f5-a69a-adc44c52a74d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7086576e5db0>]}
[0m16:22:14.829428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a52f4fa8-78c5-48f5-a69a-adc44c52a74d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70865631eaa0>]}
[0m16:22:14.859726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a52f4fa8-78c5-48f5-a69a-adc44c52a74d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7086540ce1a0>]}
[0m16:22:14.861019 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:22:14.862092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a52f4fa8-78c5-48f5-a69a-adc44c52a74d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70861fc2b070>]}
[0m16:22:14.864174 [info ] [MainThread]: 
[0m16:22:14.866005 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:22:14.868244 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:22:14.881598 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:22:14.882905 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:22:14.883994 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:22:15.675324 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:22:15.676773 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:22:15.677834 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m16:22:15.678818 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:22:15.679743 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: No close available on handle
[0m16:22:15.681479 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:22:15.682413 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG' was properly closed.
[0m16:22:15.683376 [info ] [MainThread]: 
[0m16:22:15.684783 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m16:22:15.686082 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "PRODUCT_CATALOG"
  Database Error
    250001 (08001): Failed to connect to DB: EAFJVKZ-XEB20360.snowflakecomputing.com:443. Incorrect username or password was specified.
[0m16:22:15.687856 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.7045784, "process_user_time": 3.723547, "process_kernel_time": 0.400381, "process_mem_max_rss": "123828", "process_in_blocks": "25984", "process_out_blocks": "2560", "command_success": false}
[0m16:22:15.689583 [debug] [MainThread]: Command `dbt run` failed at 16:22:15.689409 after 3.71 seconds
[0m16:22:15.690652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708658f74580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7086561381f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70861fd56fb0>]}
[0m16:22:15.691689 [debug] [MainThread]: Flushing usage events
[0m16:22:38.446224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e80938580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7edb96f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7edb9690>]}


============================== 16:22:38.452006 | 62812d81-f3a0-4e3c-9558-4f55e3d7e142 ==============================
[0m16:22:38.452006 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:22:38.453425 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/product_catalog/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt compile', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:22:38.753680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '62812d81-f3a0-4e3c-9558-4f55e3d7e142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7edf3490>]}
[0m16:22:38.832074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '62812d81-f3a0-4e3c-9558-4f55e3d7e142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7f6e6ad0>]}
[0m16:22:38.833804 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:22:38.861779 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:22:39.893888 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:22:39.894843 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:22:39.901095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '62812d81-f3a0-4e3c-9558-4f55e3d7e142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7d9c2560>]}
[0m16:22:39.931320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '62812d81-f3a0-4e3c-9558-4f55e3d7e142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7db643d0>]}
[0m16:22:39.932717 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:22:39.933953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62812d81-f3a0-4e3c-9558-4f55e3d7e142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7db67610>]}
[0m16:22:39.936634 [info ] [MainThread]: 
[0m16:22:39.938347 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:22:39.940298 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_staging'
[0m16:22:39.941271 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_snapshots'
[0m16:22:39.942456 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_core'
[0m16:22:39.955704 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:22:39.958290 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:22:39.962015 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:22:39.963296 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:22:39.964320 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:22:39.965179 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:22:39.966346 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:22:39.967333 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:22:39.968242 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:22:41.171533 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:22:41.172954 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:22:41.174533 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m16:22:41.175892 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:22:41.176983 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: No close available on handle
[0m16:22:41.222564 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:22:41.223933 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:22:41.224948 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m16:22:41.225808 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:22:41.226736 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: No close available on handle
[0m16:22:41.235332 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:22:41.236595 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:22:41.237674 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m16:22:41.238706 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m16:22:41.239793 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: No close available on handle
[0m16:22:41.241317 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:22:41.242176 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_staging' was properly closed.
[0m16:22:41.243014 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_snapshots' was properly closed.
[0m16:22:41.243859 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_core' was properly closed.
[0m16:22:41.245025 [error] [MainThread]: Encountered an error:
Database Error
  250001 (08001): Failed to connect to DB: EAFJVKZ-XEB20360.snowflakecomputing.com:443. Incorrect username or password was specified.
[0m16:22:41.246674 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_wall_clock_time": 2.853556, "process_user_time": 3.028484, "process_kernel_time": 0.41939, "process_mem_max_rss": "121988", "process_out_blocks": "6416", "command_success": false, "process_in_blocks": "0"}
[0m16:22:41.247964 [debug] [MainThread]: Command `dbt compile` failed at 16:22:41.247830 after 2.85 seconds
[0m16:22:41.248893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e80938580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7edf36d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708e7d99c970>]}
[0m16:22:41.249818 [debug] [MainThread]: Flushing usage events
[0m16:27:13.605321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737ee0874a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737edeca5810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737edeca57b0>]}


============================== 16:27:13.610893 | 2668c972-f56b-4d3e-9298-2db42fb6dafc ==============================
[0m16:27:13.610893 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:27:13.612017 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run -m stg_products', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:27:13.892082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2668c972-f56b-4d3e-9298-2db42fb6dafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737edeceb550>]}
[0m16:27:13.971301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2668c972-f56b-4d3e-9298-2db42fb6dafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737edf632b60>]}
[0m16:27:13.972820 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:27:13.998699 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:27:14.023307 [info ] [MainThread]: Unable to do partial parsing because env vars used in profiles.yml have changed
[0m16:27:14.024900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '2668c972-f56b-4d3e-9298-2db42fb6dafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737eddcd7250>]}
[0m16:27:16.276228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2668c972-f56b-4d3e-9298-2db42fb6dafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737edda378e0>]}
[0m16:27:16.305874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2668c972-f56b-4d3e-9298-2db42fb6dafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737eddbcfdf0>]}
[0m16:27:16.307193 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:27:16.308386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2668c972-f56b-4d3e-9298-2db42fb6dafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737eaf6ed000>]}
[0m16:27:16.310300 [info ] [MainThread]: 
[0m16:27:16.311854 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:27:16.313779 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:27:16.326175 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:27:16.327546 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:27:16.328464 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:27:17.243375 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:27:17.245596 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:27:17.411377 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m16:27:17.412499 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_core'
[0m16:27:17.413445 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_staging'
[0m16:27:17.421434 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:27:17.424795 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:27:17.427617 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:27:17.428576 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:27:17.429407 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:27:17.430261 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:27:17.431041 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:27:17.431859 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:27:17.432624 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:27:17.794365 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:27:17.797107 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:27:17.871118 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:27:17.873376 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:27:17.877831 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:27:17.879804 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:27:18.032677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2668c972-f56b-4d3e-9298-2db42fb6dafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737eaf3a2ef0>]}
[0m16:27:18.034231 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:27:18.035294 [info ] [MainThread]: 
[0m16:27:18.049645 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:27:18.051078 [info ] [Thread-1 (]: 1 of 1 START sql view model CORE_staging.stg_products .......................... [RUN]
[0m16:27:18.052749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_staging, now model.product_catalog.stg_products)
[0m16:27:18.054095 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:27:18.062408 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:27:18.079986 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:27:18.055160 => 16:27:18.079617
[0m16:27:18.081057 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:27:18.104740 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:27:18.121846 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:27:18.122979 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      -- make it work whether column is text or timestamp
      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m16:27:18.124121 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:27:18.693553 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:27:18.709716 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:27:18.081929 => 16:27:18.709495
[0m16:27:18.711058 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:27:18.848759 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2668c972-f56b-4d3e-9298-2db42fb6dafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737eaf2b67d0>]}
[0m16:27:18.850196 [info ] [Thread-1 (]: 1 of 1 OK created sql view model CORE_staging.stg_products ..................... [[32mSUCCESS 1[0m in 0.80s]
[0m16:27:18.851695 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:27:18.854325 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:27:18.855389 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_snapshots' was properly closed.
[0m16:27:18.856181 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_core' was properly closed.
[0m16:27:18.856936 [debug] [MainThread]: Connection 'model.product_catalog.stg_products' was properly closed.
[0m16:27:18.857814 [info ] [MainThread]: 
[0m16:27:18.859024 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.55 seconds (2.55s).
[0m16:27:18.860440 [debug] [MainThread]: Command end result
[0m16:27:18.883616 [info ] [MainThread]: 
[0m16:27:18.885377 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:27:18.887122 [info ] [MainThread]: 
[0m16:27:18.888707 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m16:27:18.891388 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.33522, "process_user_time": 3.864939, "process_kernel_time": 0.356888, "process_mem_max_rss": "128516", "process_in_blocks": "72", "process_out_blocks": "2616"}
[0m16:27:18.892823 [debug] [MainThread]: Command `dbt run` succeeded at 16:27:18.892682 after 5.34 seconds
[0m16:27:18.893938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737ee0874a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737eaf706110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737eddbce050>]}
[0m16:27:18.895392 [debug] [MainThread]: Flushing usage events
[0m16:30:18.538013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991dd028610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991db499840>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991db4997e0>]}


============================== 16:30:18.546178 | af8291ac-c647-479c-a2c4-1e1f998c7e41 ==============================
[0m16:30:18.546178 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:30:18.547816 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt build', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:30:18.985663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af8291ac-c647-479c-a2c4-1e1f998c7e41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991db4d7580>]}
[0m16:30:19.067339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af8291ac-c647-479c-a2c4-1e1f998c7e41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991dbdd6b00>]}
[0m16:30:19.069435 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:30:19.101514 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:30:20.241712 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:30:20.242713 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:30:20.249101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'af8291ac-c647-479c-a2c4-1e1f998c7e41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991da0d2650>]}
[0m16:30:20.280004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'af8291ac-c647-479c-a2c4-1e1f998c7e41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991da261690>]}
[0m16:30:20.281401 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:30:20.284426 [info ] [MainThread]: 
[0m16:30:20.286437 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:30:20.288930 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:30:20.290377 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:30:20.291583 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:30:20.304828 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:30:20.307471 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:30:20.310591 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:30:20.311865 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:30:20.312893 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:30:20.314074 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:30:20.315059 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:20.316029 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:20.317016 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:21.867131 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:30:21.869523 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:30:21.873985 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:30:21.876212 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:30:21.877483 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:30:21.880794 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:30:22.022474 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m16:30:22.023368 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m16:30:22.024155 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m16:30:22.032547 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:30:22.035152 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:30:22.038283 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:30:22.039416 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:30:22.040427 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:30:22.041599 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:30:22.042646 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:22.043553 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:22.044393 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:22.411758 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:30:22.414157 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:30:22.460259 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:30:22.462239 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:30:22.478797 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:30:22.480964 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:30:22.667806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af8291ac-c647-479c-a2c4-1e1f998c7e41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991da1a3f40>]}
[0m16:30:22.672031 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:30:22.673149 [info ] [MainThread]: 
[0m16:30:22.682443 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:30:22.684033 [info ] [Thread-1 (]: 1 of 13 START sql view model CORE_staging.stg_products ......................... [RUN]
[0m16:30:22.685637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_staging, now model.product_catalog.stg_products)
[0m16:30:22.686709 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:30:22.694476 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:30:22.704326 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:30:22.687583 => 16:30:22.703844
[0m16:30:22.705404 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:30:22.730153 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:30:22.739695 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:30:22.740953 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      -- make it work whether column is text or timestamp
      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m16:30:22.742135 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:30:23.389667 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:30:23.407749 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:30:22.706186 => 16:30:23.407551
[0m16:30:23.409046 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:30:23.534975 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af8291ac-c647-479c-a2c4-1e1f998c7e41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991d86b8d00>]}
[0m16:30:23.536579 [info ] [Thread-1 (]: 1 of 13 OK created sql view model CORE_staging.stg_products .................... [[32mSUCCESS 1[0m in 0.85s]
[0m16:30:23.538177 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:30:23.539827 [debug] [Thread-3 (]: Began running node test.product_catalog.accepted_range_stg_products_price__True__0.8363496875
[0m16:30:23.540283 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:30:23.540832 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:30:23.541383 [info ] [Thread-3 (]: 2 of 13 START test accepted_range_stg_products_price__True__0 .................. [RUN]
[0m16:30:23.542345 [info ] [Thread-4 (]: 3 of 13 START test not_null_stg_products_product_nk ............................ [RUN]
[0m16:30:23.543406 [info ] [Thread-2 (]: 4 of 13 START test not_null_stg_products_updated_at ............................ [RUN]
[0m16:30:23.544960 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_snapshots, now test.product_catalog.accepted_range_stg_products_price__True__0.8363496875)
[0m16:30:23.546795 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.product_catalog.not_null_stg_products_product_nk.a931f51b61'
[0m16:30:23.548175 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now test.product_catalog.not_null_stg_products_updated_at.7ba2e52730)
[0m16:30:23.549504 [debug] [Thread-3 (]: Began compiling node test.product_catalog.accepted_range_stg_products_price__True__0.8363496875
[0m16:30:23.550898 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:30:23.552177 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:30:23.568251 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:30:23.569248 [debug] [Thread-3 (]: Timing info for test.product_catalog.accepted_range_stg_products_price__True__0.8363496875 (compile): 16:30:23.553112 => 16:30:23.568937
[0m16:30:23.574036 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:30:23.581712 [debug] [Thread-3 (]: Compilation Error in test accepted_range_stg_products_price__True__0 (models/staging/stg_products.yml)
  'test_accepted_range' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m16:30:23.583903 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (compile): 16:30:23.570249 => 16:30:23.583671
[0m16:30:23.583381 [error] [Thread-3 (]: 2 of 13 ERROR accepted_range_stg_products_price__True__0 ....................... [[31mERROR[0m in 0.04s]
[0m16:30:23.585090 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:30:23.586257 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (compile): 16:30:23.560219 => 16:30:23.586022
[0m16:30:23.586932 [debug] [Thread-3 (]: Finished running node test.product_catalog.accepted_range_stg_products_price__True__0.8363496875
[0m16:30:23.602686 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:30:23.603460 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:30:23.610051 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:30:23.618131 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:30:23.619440 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products
where updated_at is null



      
    ) dbt_internal_test
[0m16:30:23.620437 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:30:23.620992 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:30:23.622268 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_staging.stg_products
where product_nk is null



      
    ) dbt_internal_test
[0m16:30:23.625392 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:30:25.005250 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:30:25.005939 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:30:25.008860 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (execute): 16:30:23.587902 => 16:30:25.008608
[0m16:30:25.011587 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (execute): 16:30:23.606261 => 16:30:25.011366
[0m16:30:25.012731 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: Close
[0m16:30:25.013756 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: Close
[0m16:30:25.160577 [info ] [Thread-4 (]: 3 of 13 PASS not_null_stg_products_product_nk .................................. [[32mPASS[0m in 1.61s]
[0m16:30:25.162535 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:30:25.163545 [info ] [Thread-2 (]: 4 of 13 PASS not_null_stg_products_updated_at .................................. [[32mPASS[0m in 1.62s]
[0m16:30:25.165372 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:30:25.166903 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m16:30:25.167422 [debug] [Thread-3 (]: Began running node snapshot.product_catalog.product_snapshot
[0m16:30:25.168302 [info ] [Thread-1 (]: 5 of 13 SKIP relation CORE_core.dim_product_scd2_window ........................ [[33mSKIP[0m]
[0m16:30:25.169379 [info ] [Thread-3 (]: 6 of 13 SKIP relation snapshots.product_snapshot ............................... [[33mSKIP[0m]
[0m16:30:25.170616 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m16:30:25.172050 [debug] [Thread-3 (]: Finished running node snapshot.product_catalog.product_snapshot
[0m16:30:25.173771 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:30:25.174278 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:30:25.174755 [debug] [Thread-1 (]: Began running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:30:25.175707 [debug] [Thread-3 (]: Began running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:30:25.176537 [info ] [Thread-2 (]: 7 of 13 SKIP test not_null_dim_product_scd2_window_dim_product_sk .............. [[33mSKIP[0m]
[0m16:30:25.177590 [info ] [Thread-4 (]: 8 of 13 SKIP test not_null_dim_product_scd2_window_product_nk .................. [[33mSKIP[0m]
[0m16:30:25.178697 [info ] [Thread-1 (]: 9 of 13 SKIP test unique_dim_product_scd2_window_dim_product_sk ................ [[33mSKIP[0m]
[0m16:30:25.179858 [info ] [Thread-3 (]: 10 of 13 SKIP relation CORE_core.dim_product_scd2_from_snapshot ................ [[33mSKIP[0m]
[0m16:30:25.181287 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:30:25.182581 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:30:25.183727 [debug] [Thread-1 (]: Finished running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:30:25.184824 [debug] [Thread-3 (]: Finished running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:30:25.189265 [debug] [Thread-2 (]: Began running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:30:25.189749 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:30:25.190140 [debug] [Thread-1 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:30:25.190983 [info ] [Thread-2 (]: 11 of 13 SKIP test dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [[33mSKIP[0m]
[0m16:30:25.192473 [info ] [Thread-4 (]: 12 of 13 SKIP test not_null_dim_product_scd2_from_snapshot_is_current .......... [[33mSKIP[0m]
[0m16:30:25.194195 [info ] [Thread-1 (]: 13 of 13 SKIP test not_null_dim_product_scd2_from_snapshot_product_nk .......... [[33mSKIP[0m]
[0m16:30:25.195594 [debug] [Thread-2 (]: Finished running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:30:25.196752 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:30:25.197769 [debug] [Thread-1 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:30:25.202360 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:30:25.203963 [debug] [MainThread]: Connection 'model.product_catalog.stg_products' was properly closed.
[0m16:30:25.205043 [debug] [MainThread]: Connection 'test.product_catalog.not_null_stg_products_updated_at.7ba2e52730' was properly closed.
[0m16:30:25.206186 [debug] [MainThread]: Connection 'test.product_catalog.accepted_range_stg_products_price__True__0.8363496875' was properly closed.
[0m16:30:25.207277 [debug] [MainThread]: Connection 'test.product_catalog.not_null_stg_products_product_nk.a931f51b61' was properly closed.
[0m16:30:25.208267 [info ] [MainThread]: 
[0m16:30:25.209349 [info ] [MainThread]: Finished running 1 view model, 9 tests, 2 table models, 1 snapshot in 0 hours 0 minutes and 4.92 seconds (4.92s).
[0m16:30:25.211698 [debug] [MainThread]: Command end result
[0m16:30:25.238907 [info ] [MainThread]: 
[0m16:30:25.240580 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:30:25.242424 [info ] [MainThread]: 
[0m16:30:25.243896 [error] [MainThread]:   Compilation Error in test accepted_range_stg_products_price__True__0 (models/staging/stg_products.yml)
  'test_accepted_range' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m16:30:25.245081 [info ] [MainThread]: 
[0m16:30:25.246195 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=9 TOTAL=13
[0m16:30:25.249052 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 6.786676, "process_user_time": 3.699, "process_kernel_time": 0.585129, "process_mem_max_rss": "125328", "process_in_blocks": "94336", "process_out_blocks": "5584", "command_success": false}
[0m16:30:25.250550 [debug] [MainThread]: Command `dbt build` failed at 16:30:25.250392 after 6.79 seconds
[0m16:30:25.251499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991dd028610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991d85d7e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7991da263c70>]}
[0m16:30:25.252705 [debug] [MainThread]: Flushing usage events
[0m16:34:11.471627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef035e8c580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef0345f6140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef0345f5150>]}


============================== 16:34:11.478195 | 58ff1b7d-4158-482a-8b9a-7cf4e816916b ==============================
[0m16:34:11.478195 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:34:11.479648 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/product_catalog/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m16:34:11.575451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '58ff1b7d-4158-482a-8b9a-7cf4e816916b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef034c42ad0>]}
[0m16:34:11.585163 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-aurv2fhc'
[0m16:34:11.586740 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m16:34:11.753248 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m16:34:11.755782 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m16:34:11.821778 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m16:34:11.833286 [info ] [MainThread]: Updating lock file in file path: /usr/app/dbt/product_catalog/package-lock.yml
[0m16:34:12.352833 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-vpvgxh5w'
[0m16:34:12.357004 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m16:34:16.808545 [info ] [MainThread]: Installed from version 1.3.2
[0m16:34:16.809949 [info ] [MainThread]: Up to date!
[0m16:34:16.811066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '58ff1b7d-4158-482a-8b9a-7cf4e816916b', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef0346ed7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef0346ed9c0>]}
[0m16:34:16.813577 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 5.4113493, "process_user_time": 2.042004, "process_kernel_time": 0.560306, "process_mem_max_rss": "88216", "process_in_blocks": "71376", "process_out_blocks": "784"}
[0m16:34:16.814808 [debug] [MainThread]: Command `dbt deps` succeeded at 16:34:16.814672 after 5.41 seconds
[0m16:34:16.815883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef035e8c580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef036512950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ef0346efca0>]}
[0m16:34:16.816912 [debug] [MainThread]: Flushing usage events
[0m16:34:26.759755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae2093f0580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae207871810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae2078717b0>]}


============================== 16:34:26.765813 | 32dca379-f20b-42e5-9d62-c55ddd580398 ==============================
[0m16:34:26.765813 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:34:26.767314 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt build', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:34:27.211953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae2078af550>]}
[0m16:34:27.298630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae207c837f0>]}
[0m16:34:27.300886 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:34:27.331062 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:34:28.498690 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:34:28.500112 [debug] [MainThread]: Partial parsing: updated file: product_catalog://models/staging/stg_products.yml
[0m16:34:28.779228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae204192650>]}
[0m16:34:28.810298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae204103d90>]}
[0m16:34:28.811652 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:34:28.814494 [info ] [MainThread]: 
[0m16:34:28.816537 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:34:28.819029 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:34:28.820120 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:34:28.821351 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:34:28.834292 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:34:28.836866 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:34:28.840334 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:34:28.841843 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:34:28.843059 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:34:28.844371 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:34:28.845551 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:34:28.846807 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:34:28.847816 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:34:30.386091 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:34:30.388248 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:34:30.392766 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:34:30.394794 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:34:30.442166 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:34:30.444595 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:34:30.566223 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m16:34:30.566994 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m16:34:30.567836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m16:34:30.575605 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:34:30.577929 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:34:30.580839 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:34:30.582046 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:34:30.582990 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:34:30.584165 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:34:30.585228 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:30.586328 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:30.587519 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:31.031656 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:34:31.033910 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:34:31.050280 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:34:31.052425 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:34:31.056115 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:34:31.058473 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:34:31.173988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae2041026b0>]}
[0m16:34:31.175654 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:34:31.176776 [info ] [MainThread]: 
[0m16:34:31.185122 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:34:31.186670 [info ] [Thread-1 (]: 1 of 13 START sql view model CORE_staging.stg_products ......................... [RUN]
[0m16:34:31.188366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_snapshots, now model.product_catalog.stg_products)
[0m16:34:31.189504 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:34:31.197799 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:34:31.208237 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:34:31.190339 => 16:34:31.207825
[0m16:34:31.209526 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:34:31.233873 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:34:31.243356 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:34:31.244617 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      -- make it work whether column is text or timestamp
      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m16:34:31.245580 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:31.859591 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:31.879738 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:34:31.210444 => 16:34:31.879536
[0m16:34:31.881044 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:34:32.016333 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae1c6580ac0>]}
[0m16:34:32.018128 [info ] [Thread-1 (]: 1 of 13 OK created sql view model CORE_staging.stg_products .................... [[32mSUCCESS 1[0m in 0.83s]
[0m16:34:32.019575 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:34:32.021683 [debug] [Thread-3 (]: Began running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:34:32.022337 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:34:32.022778 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:34:32.023678 [info ] [Thread-3 (]: 2 of 13 START test dbt_utils_accepted_range_stg_products_price__True__0 ........ [RUN]
[0m16:34:32.024753 [info ] [Thread-4 (]: 3 of 13 START test not_null_stg_products_product_nk ............................ [RUN]
[0m16:34:32.026203 [info ] [Thread-2 (]: 4 of 13 START test not_null_stg_products_updated_at ............................ [RUN]
[0m16:34:32.028147 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e)
[0m16:34:32.030229 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.product_catalog.not_null_stg_products_product_nk.a931f51b61'
[0m16:34:32.031793 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_staging, now test.product_catalog.not_null_stg_products_updated_at.7ba2e52730)
[0m16:34:32.033283 [debug] [Thread-3 (]: Began compiling node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:34:32.034558 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:34:32.035767 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:34:32.041275 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:34:32.052708 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:34:32.058388 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:34:32.065248 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (compile): 16:34:32.036890 => 16:34:32.064851
[0m16:34:32.067025 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (compile): 16:34:32.053859 => 16:34:32.066577
[0m16:34:32.067721 [debug] [Thread-3 (]: Began executing node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:34:32.068156 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (compile): 16:34:32.042739 => 16:34:32.067937
[0m16:34:32.069185 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:34:32.084330 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:34:32.085083 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:34:32.088437 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:34:32.092654 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:34:32.098691 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:34:32.100054 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with meet_condition as(
  select *
  from PRODUCT_CATALOG.CORE_staging.stg_products
),

validation_errors as (
  select *
  from meet_condition
  where
    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds
    1 = 2
    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.
    or not price >= 0
)

select *
from validation_errors


      
    ) dbt_internal_test
[0m16:34:32.100827 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:34:32.101488 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:34:32.102051 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:34:32.103112 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_staging.stg_products
where product_nk is null



      
    ) dbt_internal_test
[0m16:34:32.104231 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products
where updated_at is null



      
    ) dbt_internal_test
[0m16:34:32.107354 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:34:32.108458 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:34:32.710144 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:32.713475 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (execute): 16:34:32.086034 => 16:34:32.713202
[0m16:34:32.714970 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:32.715613 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: Close
[0m16:34:32.718665 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (execute): 16:34:32.090363 => 16:34:32.718419
[0m16:34:32.722259 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:32.723613 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: Close
[0m16:34:32.726135 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (execute): 16:34:32.070137 => 16:34:32.725915
[0m16:34:32.729446 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: Close
[0m16:34:32.855850 [info ] [Thread-2 (]: 4 of 13 PASS not_null_stg_products_updated_at .................................. [[32mPASS[0m in 0.82s]
[0m16:34:32.857692 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:34:32.862339 [info ] [Thread-3 (]: 2 of 13 PASS dbt_utils_accepted_range_stg_products_price__True__0 .............. [[32mPASS[0m in 0.83s]
[0m16:34:32.864327 [info ] [Thread-4 (]: 3 of 13 PASS not_null_stg_products_product_nk .................................. [[32mPASS[0m in 0.83s]
[0m16:34:32.865290 [debug] [Thread-3 (]: Finished running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:34:32.866935 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:34:32.869916 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m16:34:32.870413 [debug] [Thread-2 (]: Began running node snapshot.product_catalog.product_snapshot
[0m16:34:32.871441 [info ] [Thread-1 (]: 5 of 13 START sql table model CORE_core.dim_product_scd2_window ................ [RUN]
[0m16:34:32.872512 [info ] [Thread-2 (]: 6 of 13 START snapshot snapshots.product_snapshot .............................. [RUN]
[0m16:34:32.874152 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.stg_products, now model.product_catalog.dim_product_scd2_window)
[0m16:34:32.875661 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_updated_at.7ba2e52730, now snapshot.product_catalog.product_snapshot)
[0m16:34:32.876766 [debug] [Thread-1 (]: Began compiling node model.product_catalog.dim_product_scd2_window
[0m16:34:32.877730 [debug] [Thread-2 (]: Began compiling node snapshot.product_catalog.product_snapshot
[0m16:34:32.884379 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_window"
[0m16:34:32.888732 [debug] [Thread-2 (]: Timing info for snapshot.product_catalog.product_snapshot (compile): 16:34:32.885435 => 16:34:32.888429
[0m16:34:32.890782 [debug] [Thread-2 (]: Began executing node snapshot.product_catalog.product_snapshot
[0m16:34:32.934198 [debug] [Thread-2 (]: Writing runtime sql for node "snapshot.product_catalog.product_snapshot"
[0m16:34:32.936193 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (compile): 16:34:32.878725 => 16:34:32.935929
[0m16:34:32.937235 [debug] [Thread-1 (]: Began executing node model.product_catalog.dim_product_scd2_window
[0m16:34:32.946480 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_window"
[0m16:34:32.951518 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:34:32.952677 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
create or replace transient table PRODUCT_CATALOG.snapshots.product_snapshot
         as
        (

    select *,
        md5(coalesce(cast(product_nk as varchar ), '')
         || '|' || coalesce(cast(updated_at as varchar ), '')
        ) as dbt_scd_id,
        updated_at as dbt_updated_at,
        updated_at as dbt_valid_from,
        nullif(updated_at, updated_at) as dbt_valid_to
    from (
        

select
  product_nk,
  url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products
    ) sbq



        );
[0m16:34:32.953770 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:34:32.959646 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_window"
[0m16:34:32.961105 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_window"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
         as
        (

WITH source_data AS (
    SELECT
        product_nk,
        MAX_BY(url, updated_at)        AS url,
        MAX_BY(title, updated_at)      AS title,
        MAX_BY(images, updated_at)     AS images,
        MAX_BY(description, updated_at)AS description,
        MAX_BY(product_id, updated_at) AS product_id,
        MAX_BY(sku, updated_at)        AS sku,
        MAX_BY(gtin13, updated_at)     AS gtin13,
        MAX_BY(brand, updated_at)      AS brand,
        MAX_BY(price, updated_at)      AS price,
        MAX_BY(currency, updated_at)   AS currency,
        MAX_BY(availability, updated_at) AS availability,
        MAX_BY(uniq_id, updated_at)    AS uniq_id,
        updated_at
    FROM PRODUCT_CATALOG.CORE_staging.stg_products
    QUALIFY ROW_NUMBER() OVER (PARTITION BY product_nk, updated_at ORDER BY updated_at) = 1
), ordered AS (
    SELECT
        *,
        LAG(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS prev_updated_at,
        LEAD(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS next_updated_at
    FROM source_data
), scd AS (
    SELECT
        product_nk,
        url, title, images, description,
        product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
        COALESCE(prev_updated_at, updated_at) AS valid_from,
        next_updated_at                       AS valid_to,
        updated_at                            AS version_updated_at
    FROM ordered
)
SELECT
    MD5( COALESCE(CAST(product_nk AS STRING), '') || COALESCE(CAST(valid_from AS STRING), '') )   AS dim_product_sk,
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    valid_from,
    valid_to,
    IFF(valid_to IS NULL, TRUE, FALSE)                  AS is_current,
    version_updated_at,
    CURRENT_TIMESTAMP()                                  AS dbt_loaded_at
FROM scd
        );
[0m16:34:32.962255 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:33.496788 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c05862-0106-fd6e-0016-c3df00014792
[0m16:34:33.498017 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000979 (42601): SQL compilation error:
[STG_PRODUCTS.PRODUCT_NK] is not a valid group by expression
[0m16:34:33.499232 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (execute): 16:34:32.938043 => 16:34:33.498980
[0m16:34:33.500165 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: Close
[0m16:34:33.686325 [debug] [Thread-1 (]: Database Error in model dim_product_scd2_window (models/core/dim_product_scd2_window.sql)
  000979 (42601): SQL compilation error:
  [STG_PRODUCTS.PRODUCT_NK] is not a valid group by expression
  compiled Code at target/run/product_catalog/models/core/dim_product_scd2_window.sql
[0m16:34:33.687766 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae1c44ab310>]}
[0m16:34:33.689175 [error] [Thread-1 (]: 5 of 13 ERROR creating sql table model CORE_core.dim_product_scd2_window ....... [[31mERROR[0m in 0.81s]
[0m16:34:33.690489 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m16:34:33.692055 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:34:33.692476 [debug] [Thread-3 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:34:33.692858 [debug] [Thread-1 (]: Began running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:34:33.693891 [info ] [Thread-4 (]: 7 of 13 SKIP test not_null_dim_product_scd2_window_dim_product_sk .............. [[33mSKIP[0m]
[0m16:34:33.695470 [info ] [Thread-3 (]: 8 of 13 SKIP test not_null_dim_product_scd2_window_product_nk .................. [[33mSKIP[0m]
[0m16:34:33.697001 [info ] [Thread-1 (]: 9 of 13 SKIP test unique_dim_product_scd2_window_dim_product_sk ................ [[33mSKIP[0m]
[0m16:34:33.698315 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:34:33.699691 [debug] [Thread-3 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:34:33.700917 [debug] [Thread-1 (]: Finished running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:34:34.505154 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m16:34:34.511503 [debug] [Thread-2 (]: Timing info for snapshot.product_catalog.product_snapshot (execute): 16:34:32.891843 => 16:34:34.511302
[0m16:34:34.512952 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: Close
[0m16:34:34.678921 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae1c443ffd0>]}
[0m16:34:34.680715 [info ] [Thread-2 (]: 6 of 13 OK snapshotted snapshots.product_snapshot .............................. [[32mSUCCESS 1[0m in 1.80s]
[0m16:34:34.682424 [debug] [Thread-2 (]: Finished running node snapshot.product_catalog.product_snapshot
[0m16:34:34.684213 [debug] [Thread-4 (]: Began running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:34:34.685323 [info ] [Thread-4 (]: 10 of 13 START sql table model CORE_core.dim_product_scd2_from_snapshot ........ [RUN]
[0m16:34:34.686840 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_product_nk.a931f51b61, now model.product_catalog.dim_product_scd2_from_snapshot)
[0m16:34:34.687971 [debug] [Thread-4 (]: Began compiling node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:34:34.692806 [debug] [Thread-4 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:34:34.702582 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (compile): 16:34:34.688825 => 16:34:34.701978
[0m16:34:34.704055 [debug] [Thread-4 (]: Began executing node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:34:34.707918 [debug] [Thread-4 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:34:34.718441 [debug] [Thread-4 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:34:34.719871 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_from_snapshot"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
         as
        (

WITH snap AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    dbt_valid_from AS valid_from,
    dbt_valid_to   AS valid_to
  FROM PRODUCT_CATALOG.snapshots.product_snapshot
),
dedup AS (
  SELECT DISTINCT * FROM snap
)
SELECT
  MD5( COALESCE(CAST(product_nk AS STRING), '') || COALESCE(CAST(valid_from AS STRING), '') ) AS dim_product_sk,
  product_nk, url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  valid_from, valid_to,
  IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
  CURRENT_TIMESTAMP() AS dbt_loaded_at
FROM dedup
        );
[0m16:34:34.721076 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:34:36.177820 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:36.180882 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (execute): 16:34:34.705074 => 16:34:36.180674
[0m16:34:36.182089 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: Close
[0m16:34:36.346089 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '32dca379-f20b-42e5-9d62-c55ddd580398', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae1c443ffd0>]}
[0m16:34:36.347926 [info ] [Thread-4 (]: 10 of 13 OK created sql table model CORE_core.dim_product_scd2_from_snapshot ... [[32mSUCCESS 1[0m in 1.66s]
[0m16:34:36.349586 [debug] [Thread-4 (]: Finished running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:34:36.351320 [debug] [Thread-1 (]: Began running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:34:36.351798 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:34:36.352162 [debug] [Thread-3 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:34:36.352978 [info ] [Thread-1 (]: 11 of 13 START test dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [RUN]
[0m16:34:36.354297 [info ] [Thread-2 (]: 12 of 13 START test not_null_dim_product_scd2_from_snapshot_is_current ......... [RUN]
[0m16:34:36.355407 [info ] [Thread-3 (]: 13 of 13 START test not_null_dim_product_scd2_from_snapshot_product_nk ......... [RUN]
[0m16:34:36.356994 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.dim_product_scd2_window, now test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a)
[0m16:34:36.358783 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly snapshot.product_catalog.product_snapshot, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135)
[0m16:34:36.360243 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36)
[0m16:34:36.361395 [debug] [Thread-1 (]: Began compiling node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:34:36.362617 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:34:36.363873 [debug] [Thread-3 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:34:36.374088 [debug] [Thread-1 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:34:36.379000 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:34:36.384344 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:34:36.393901 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (compile): 16:34:36.365067 => 16:34:36.393515
[0m16:34:36.395146 [debug] [Thread-1 (]: Began executing node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:34:36.395784 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (compile): 16:34:36.374674 => 16:34:36.395500
[0m16:34:36.470342 [debug] [Thread-1 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:34:36.470985 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (compile): 16:34:36.380323 => 16:34:36.470744
[0m16:34:36.471963 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:34:36.473935 [debug] [Thread-3 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:34:36.477293 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:34:36.481109 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:34:36.488579 [debug] [Thread-1 (]: Using snowflake connection "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:34:36.490036 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        product_nk, valid_from
    from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
    group by product_nk, valid_from
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m16:34:36.490935 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:34:36.492079 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:36.493729 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:34:36.494428 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_current
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where is_current is null



      
    ) dbt_internal_test
[0m16:34:36.497771 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where product_nk is null



      
    ) dbt_internal_test
[0m16:34:36.499743 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:34:36.501400 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:34:37.050551 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:37.053504 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (execute): 16:34:36.396737 => 16:34:37.053232
[0m16:34:37.054653 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: Close
[0m16:34:37.185028 [info ] [Thread-1 (]: 11 of 13 PASS dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [[32mPASS[0m in 0.83s]
[0m16:34:37.186690 [debug] [Thread-1 (]: Finished running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:34:37.230109 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:37.233462 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (execute): 16:34:36.478525 => 16:34:37.233195
[0m16:34:37.234297 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:37.235277 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: Close
[0m16:34:37.237723 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (execute): 16:34:36.474936 => 16:34:37.237495
[0m16:34:37.241171 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: Close
[0m16:34:37.385198 [info ] [Thread-3 (]: 13 of 13 PASS not_null_dim_product_scd2_from_snapshot_product_nk ............... [[32mPASS[0m in 1.03s]
[0m16:34:37.386927 [debug] [Thread-3 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:34:37.391533 [info ] [Thread-2 (]: 12 of 13 PASS not_null_dim_product_scd2_from_snapshot_is_current ............... [[32mPASS[0m in 1.03s]
[0m16:34:37.392958 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:34:37.395742 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:34:37.396792 [debug] [MainThread]: Connection 'test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a' was properly closed.
[0m16:34:37.397662 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36' was properly closed.
[0m16:34:37.398471 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135' was properly closed.
[0m16:34:37.399307 [debug] [MainThread]: Connection 'model.product_catalog.dim_product_scd2_from_snapshot' was properly closed.
[0m16:34:37.400274 [info ] [MainThread]: 
[0m16:34:37.401298 [info ] [MainThread]: Finished running 1 view model, 9 tests, 2 table models, 1 snapshot in 0 hours 0 minutes and 8.58 seconds (8.58s).
[0m16:34:37.404139 [debug] [MainThread]: Command end result
[0m16:34:37.431679 [info ] [MainThread]: 
[0m16:34:37.433406 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:34:37.434906 [info ] [MainThread]: 
[0m16:34:37.436164 [error] [MainThread]:   Database Error in model dim_product_scd2_window (models/core/dim_product_scd2_window.sql)
  000979 (42601): SQL compilation error:
  [STG_PRODUCTS.PRODUCT_NK] is not a valid group by expression
  compiled Code at target/run/product_catalog/models/core/dim_product_scd2_window.sql
[0m16:34:37.437355 [info ] [MainThread]: 
[0m16:34:37.438524 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=3 TOTAL=13
[0m16:34:37.440573 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 10.7344, "process_user_time": 4.219302, "process_kernel_time": 0.537076, "process_mem_max_rss": "130980", "process_in_blocks": "25984", "process_out_blocks": "5584", "command_success": false}
[0m16:34:37.442067 [debug] [MainThread]: Command `dbt build` failed at 16:34:37.441920 after 10.74 seconds
[0m16:34:37.443510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae2093f0580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae1c6526200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae1c6524880>]}
[0m16:34:37.444861 [debug] [MainThread]: Flushing usage events
[0m16:38:25.106069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e62c09a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e4741960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e4741900>]}


============================== 16:38:25.112535 | b8a7697b-c1e7-4b06-b6e8-6febc33c4451 ==============================
[0m16:38:25.112535 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:38:25.113656 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run -m dim_product_scd2_window', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:38:25.485812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8a7697b-c1e7-4b06-b6e8-6febc33c4451', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e4783580>]}
[0m16:38:25.562409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8a7697b-c1e7-4b06-b6e8-6febc33c4451', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e47837f0>]}
[0m16:38:25.564587 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:38:25.593646 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:38:26.574761 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:38:26.575924 [debug] [MainThread]: Partial parsing: updated file: product_catalog://models/core/dim_product_scd2_window.sql
[0m16:38:26.836593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8a7697b-c1e7-4b06-b6e8-6febc33c4451', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e307e6e0>]}
[0m16:38:26.864956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8a7697b-c1e7-4b06-b6e8-6febc33c4451', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e3505d80>]}
[0m16:38:26.866191 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:38:26.867594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8a7697b-c1e7-4b06-b6e8-6febc33c4451', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e3505600>]}
[0m16:38:26.869864 [info ] [MainThread]: 
[0m16:38:26.871532 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:38:26.873702 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:38:26.885990 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:38:26.887509 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:38:26.888511 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:27.862440 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:38:27.864881 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:38:28.008982 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m16:38:28.010529 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_core'
[0m16:38:28.011714 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_snapshots'
[0m16:38:28.018928 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:38:28.021452 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:38:28.025138 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:38:28.026205 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:38:28.027077 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:38:28.027932 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:38:28.028807 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:38:28.029582 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:28.030395 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:28.593881 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:28.596179 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:38:28.661315 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:28.664237 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:38:28.675318 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:28.677383 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:38:28.878577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8a7697b-c1e7-4b06-b6e8-6febc33c4451', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e305a950>]}
[0m16:38:28.880470 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:38:28.881655 [info ] [MainThread]: 
[0m16:38:28.892232 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m16:38:28.893745 [info ] [Thread-1 (]: 1 of 1 START sql table model CORE_core.dim_product_scd2_window ................. [RUN]
[0m16:38:28.895522 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_snapshots, now model.product_catalog.dim_product_scd2_window)
[0m16:38:28.896836 [debug] [Thread-1 (]: Began compiling node model.product_catalog.dim_product_scd2_window
[0m16:38:28.906037 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_window"
[0m16:38:28.916550 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (compile): 16:38:28.897855 => 16:38:28.916097
[0m16:38:28.917973 [debug] [Thread-1 (]: Began executing node model.product_catalog.dim_product_scd2_window
[0m16:38:28.941949 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_window"
[0m16:38:28.950729 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_window"
[0m16:38:28.951852 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_window"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
         as
        (

WITH src AS (
  SELECT
    row_idx,
    product_nk,
    url,
    title,
    images,
    description,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    currency,
    availability,
    uniq_id,
    updated_at
  FROM PRODUCT_CATALOG.CORE_staging.stg_products
),

-- If the raw has duplicates per (product_nk, updated_at), keep one deterministically
dedup AS (
  SELECT *
  FROM (
    SELECT
      s.*,
      ROW_NUMBER() OVER (
        PARTITION BY product_nk, updated_at
        ORDER BY row_idx
      ) AS rn
    FROM src s
  )
  WHERE rn = 1
),

ordered AS (
  SELECT
    *,
    LAG(updated_at)  OVER (PARTITION BY product_nk ORDER BY updated_at) AS prev_updated_at,
    LEAD(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS next_updated_at
  FROM dedup
),

scd AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    COALESCE(prev_updated_at, updated_at) AS valid_from,
    next_updated_at                       AS valid_to,
    updated_at                            AS version_updated_at
  FROM ordered
)

SELECT
  md5(cast(coalesce(cast(product_nk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(valid_from as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS dim_product_sk,
  product_nk,
  url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  valid_from,
  valid_to,
  IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
  CURRENT_TIMESTAMP()                AS dbt_loaded_at
FROM scd;
[0m16:38:28.952912 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:38:29.414813 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c05866-0106-ffa7-0016-c3df000180ae
[0m16:38:29.415910 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 68 at position 8 unexpected ';'.
[0m16:38:29.417126 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (execute): 16:38:28.918965 => 16:38:29.416923
[0m16:38:29.418185 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: Close
[0m16:38:29.607329 [debug] [Thread-1 (]: Database Error in model dim_product_scd2_window (models/core/dim_product_scd2_window.sql)
  001003 (42000): SQL compilation error:
  syntax error line 68 at position 8 unexpected ';'.
  compiled Code at target/run/product_catalog/models/core/dim_product_scd2_window.sql
[0m16:38:29.608732 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8a7697b-c1e7-4b06-b6e8-6febc33c4451', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e14d6890>]}
[0m16:38:29.610080 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model CORE_core.dim_product_scd2_window ........ [[31mERROR[0m in 0.71s]
[0m16:38:29.611746 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m16:38:29.614991 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:38:29.616193 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_staging' was properly closed.
[0m16:38:29.617343 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_core' was properly closed.
[0m16:38:29.618684 [debug] [MainThread]: Connection 'model.product_catalog.dim_product_scd2_window' was properly closed.
[0m16:38:29.620125 [info ] [MainThread]: 
[0m16:38:29.621421 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.75 seconds (2.75s).
[0m16:38:29.622854 [debug] [MainThread]: Command end result
[0m16:38:29.650608 [info ] [MainThread]: 
[0m16:38:29.652248 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:38:29.653565 [info ] [MainThread]: 
[0m16:38:29.654796 [error] [MainThread]:   Database Error in model dim_product_scd2_window (models/core/dim_product_scd2_window.sql)
  001003 (42000): SQL compilation error:
  syntax error line 68 at position 8 unexpected ';'.
  compiled Code at target/run/product_catalog/models/core/dim_product_scd2_window.sql
[0m16:38:29.656376 [info ] [MainThread]: 
[0m16:38:29.658093 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m16:38:29.660575 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.605804, "process_user_time": 2.701076, "process_kernel_time": 0.535384, "process_mem_max_rss": "126500", "process_in_blocks": "94664", "process_out_blocks": "2616", "command_success": false}
[0m16:38:29.662163 [debug] [MainThread]: Command `dbt run` failed at 16:38:29.661971 after 4.61 seconds
[0m16:38:29.663949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e62c09a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e3505d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c75e47837f0>]}
[0m16:38:29.665209 [debug] [MainThread]: Flushing usage events
[0m16:38:46.120764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714668650370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714666ad17e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714666ad1780>]}


============================== 16:38:46.126765 | 368ab827-4c09-47be-a5e2-a7fb22198aa9 ==============================
[0m16:38:46.126765 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:38:46.128278 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt build', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:38:46.400955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714666b0f520>]}
[0m16:38:46.476772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714666ee3eb0>]}
[0m16:38:46.478595 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:38:46.505507 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:38:47.518231 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:38:47.519294 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:38:47.525582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7146656f6650>]}
[0m16:38:47.555160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714665891660>]}
[0m16:38:47.556435 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:38:47.559400 [info ] [MainThread]: 
[0m16:38:47.561264 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:38:47.563592 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:38:47.564559 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:38:47.565540 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:38:47.578232 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:38:47.580777 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:38:47.583744 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:38:47.584881 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:38:47.585828 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:38:47.586663 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:38:47.587471 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:47.588309 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:47.589205 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:49.035441 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:38:49.038288 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:38:49.072404 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:38:49.074960 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:38:49.079600 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:38:49.081556 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:38:49.307573 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m16:38:49.308451 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m16:38:49.309197 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m16:38:49.318154 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:38:49.320485 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:38:49.323230 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:38:49.324196 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:38:49.325135 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:38:49.326155 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:38:49.327118 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:38:49.328129 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:38:49.329003 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:38:49.737302 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:38:49.739804 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:38:49.757847 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:38:49.760872 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:38:49.799528 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:38:49.802306 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:38:50.045534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7146659334f0>]}
[0m16:38:50.047503 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:38:50.048925 [info ] [MainThread]: 
[0m16:38:50.057891 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:38:50.059375 [info ] [Thread-1 (]: 1 of 13 START sql view model CORE_staging.stg_products ......................... [RUN]
[0m16:38:50.060794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now model.product_catalog.stg_products)
[0m16:38:50.061952 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:38:50.069524 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:38:50.077953 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:38:50.062708 => 16:38:50.077558
[0m16:38:50.079151 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:38:50.103038 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:38:50.111660 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:38:50.112685 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      -- make it work whether column is text or timestamp
      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m16:38:50.113736 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:38:50.821606 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:50.839106 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:38:50.080150 => 16:38:50.838898
[0m16:38:50.840687 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:38:50.995903 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71466561a860>]}
[0m16:38:50.997493 [info ] [Thread-1 (]: 1 of 13 OK created sql view model CORE_staging.stg_products .................... [[32mSUCCESS 1[0m in 0.94s]
[0m16:38:50.998982 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:38:51.001034 [debug] [Thread-3 (]: Began running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:38:51.001444 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:38:51.001910 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:38:51.002809 [info ] [Thread-3 (]: 2 of 13 START test dbt_utils_accepted_range_stg_products_price__True__0 ........ [RUN]
[0m16:38:51.004007 [info ] [Thread-4 (]: 3 of 13 START test not_null_stg_products_product_nk ............................ [RUN]
[0m16:38:51.005280 [info ] [Thread-2 (]: 4 of 13 START test not_null_stg_products_updated_at ............................ [RUN]
[0m16:38:51.007038 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_staging, now test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e)
[0m16:38:51.010273 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.product_catalog.not_null_stg_products_product_nk.a931f51b61'
[0m16:38:51.012726 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_snapshots, now test.product_catalog.not_null_stg_products_updated_at.7ba2e52730)
[0m16:38:51.014354 [debug] [Thread-3 (]: Began compiling node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:38:51.016253 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:38:51.017879 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:38:51.030517 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:38:51.038755 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:38:51.043277 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:38:51.050056 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (compile): 16:38:51.019171 => 16:38:51.049613
[0m16:38:51.050960 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (compile): 16:38:51.031160 => 16:38:51.050743
[0m16:38:51.051607 [debug] [Thread-3 (]: Began executing node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:38:51.052561 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (compile): 16:38:51.039569 => 16:38:51.052352
[0m16:38:51.053129 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:38:51.067401 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:38:51.068242 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:38:51.072869 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:38:51.077060 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:38:51.083016 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:38:51.083844 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:38:51.084953 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with meet_condition as(
  select *
  from PRODUCT_CATALOG.CORE_staging.stg_products
),

validation_errors as (
  select *
  from meet_condition
  where
    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds
    1 = 2
    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.
    or not price >= 0
)

select *
from validation_errors


      
    ) dbt_internal_test
[0m16:38:51.085818 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:38:51.086669 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products
where updated_at is null



      
    ) dbt_internal_test
[0m16:38:51.087656 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:38:51.088828 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_staging.stg_products
where product_nk is null



      
    ) dbt_internal_test
[0m16:38:51.090146 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:38:51.093198 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:38:51.634171 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:51.637710 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (execute): 16:38:51.074856 => 16:38:51.637461
[0m16:38:51.639079 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:51.639681 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: Close
[0m16:38:51.642097 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (execute): 16:38:51.054065 => 16:38:51.641803
[0m16:38:51.645039 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: Close
[0m16:38:51.664517 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:51.667420 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (execute): 16:38:51.069556 => 16:38:51.667170
[0m16:38:51.668500 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: Close
[0m16:38:51.810561 [info ] [Thread-3 (]: 2 of 13 PASS dbt_utils_accepted_range_stg_products_price__True__0 .............. [[32mPASS[0m in 0.80s]
[0m16:38:51.812350 [debug] [Thread-3 (]: Finished running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:38:51.843402 [info ] [Thread-2 (]: 4 of 13 PASS not_null_stg_products_updated_at .................................. [[32mPASS[0m in 0.83s]
[0m16:38:51.846505 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:38:51.851249 [info ] [Thread-4 (]: 3 of 13 PASS not_null_stg_products_product_nk .................................. [[32mPASS[0m in 0.84s]
[0m16:38:51.852927 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:38:51.854982 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m16:38:51.855511 [debug] [Thread-3 (]: Began running node snapshot.product_catalog.product_snapshot
[0m16:38:51.856858 [info ] [Thread-1 (]: 5 of 13 START sql table model CORE_core.dim_product_scd2_window ................ [RUN]
[0m16:38:51.858627 [info ] [Thread-3 (]: 6 of 13 START snapshot snapshots.product_snapshot .............................. [RUN]
[0m16:38:51.860207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.stg_products, now model.product_catalog.dim_product_scd2_window)
[0m16:38:51.861657 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e, now snapshot.product_catalog.product_snapshot)
[0m16:38:51.862806 [debug] [Thread-1 (]: Began compiling node model.product_catalog.dim_product_scd2_window
[0m16:38:51.863827 [debug] [Thread-3 (]: Began compiling node snapshot.product_catalog.product_snapshot
[0m16:38:51.878702 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_window"
[0m16:38:51.883252 [debug] [Thread-3 (]: Timing info for snapshot.product_catalog.product_snapshot (compile): 16:38:51.879103 => 16:38:51.882906
[0m16:38:51.885631 [debug] [Thread-3 (]: Began executing node snapshot.product_catalog.product_snapshot
[0m16:38:51.924943 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (compile): 16:38:51.864684 => 16:38:51.924637
[0m16:38:51.925294 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:51.926370 [debug] [Thread-1 (]: Began executing node model.product_catalog.dim_product_scd2_window
[0m16:38:51.927763 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m16:38:51.946909 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_window"
[0m16:38:51.947387 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:38:51.957946 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_window"
[0m16:38:51.959098 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_window"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
         as
        (

WITH src AS (
  SELECT
    row_idx,
    product_nk,
    url,
    title,
    images,
    description,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    currency,
    availability,
    uniq_id,
    updated_at
  FROM PRODUCT_CATALOG.CORE_staging.stg_products
),

-- If the raw has duplicates per (product_nk, updated_at), keep one deterministically
dedup AS (
  SELECT *
  FROM (
    SELECT
      s.*,
      ROW_NUMBER() OVER (
        PARTITION BY product_nk, updated_at
        ORDER BY row_idx
      ) AS rn
    FROM src s
  )
  WHERE rn = 1
),

ordered AS (
  SELECT
    *,
    LAG(updated_at)  OVER (PARTITION BY product_nk ORDER BY updated_at) AS prev_updated_at,
    LEAD(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS next_updated_at
  FROM dedup
),

scd AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    COALESCE(prev_updated_at, updated_at) AS valid_from,
    next_updated_at                       AS valid_to,
    updated_at                            AS version_updated_at
  FROM ordered
)

SELECT
  md5(cast(coalesce(cast(product_nk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(valid_from as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS dim_product_sk,
  product_nk,
  url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  valid_from,
  valid_to,
  IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
  CURRENT_TIMESTAMP()                AS dbt_loaded_at
FROM scd;
[0m16:38:51.960047 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:38:52.349209 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m16:38:52.364301 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:52.365653 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
create or replace temporary table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        

select
  product_nk,
  url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products

    ),

    snapshotted_data as (

        select *,
            product_nk as dbt_unique_key

        from "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            product_nk as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            md5(coalesce(cast(product_nk as varchar ), '')
         || '|' || coalesce(cast(updated_at as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            product_nk as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m16:38:52.367513 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c05866-0106-fb10-0016-c3df0001654e
[0m16:38:52.368855 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 68 at position 8 unexpected ';'.
[0m16:38:52.369943 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (execute): 16:38:51.928805 => 16:38:52.369723
[0m16:38:52.370825 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: Close
[0m16:38:52.536597 [debug] [Thread-1 (]: Database Error in model dim_product_scd2_window (models/core/dim_product_scd2_window.sql)
  001003 (42000): SQL compilation error:
  syntax error line 68 at position 8 unexpected ';'.
  compiled Code at target/run/product_catalog/models/core/dim_product_scd2_window.sql
[0m16:38:52.538118 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71466439fbe0>]}
[0m16:38:52.539451 [error] [Thread-1 (]: 5 of 13 ERROR creating sql table model CORE_core.dim_product_scd2_window ....... [[31mERROR[0m in 0.68s]
[0m16:38:52.541025 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m16:38:52.542613 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:38:52.543074 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:38:52.543479 [debug] [Thread-1 (]: Began running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:38:52.544404 [info ] [Thread-4 (]: 7 of 13 SKIP test not_null_dim_product_scd2_window_dim_product_sk .............. [[33mSKIP[0m]
[0m16:38:52.545759 [info ] [Thread-2 (]: 8 of 13 SKIP test not_null_dim_product_scd2_window_product_nk .................. [[33mSKIP[0m]
[0m16:38:52.546923 [info ] [Thread-1 (]: 9 of 13 SKIP test unique_dim_product_scd2_window_dim_product_sk ................ [[33mSKIP[0m]
[0m16:38:52.548205 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:38:52.549624 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:38:52.551066 [debug] [Thread-1 (]: Finished running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:38:53.801449 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:53.805480 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:53.806922 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m16:38:53.917543 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:38:53.923943 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:53.925104 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m16:38:54.024553 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m16:38:54.029956 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:54.031131 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m16:38:54.150530 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:38:54.156110 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:54.157261 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m16:38:54.273660 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m16:38:54.282390 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:54.283652 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m16:38:54.374721 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:38:54.383670 [debug] [Thread-3 (]: Writing runtime sql for node "snapshot.product_catalog.product_snapshot"
[0m16:38:54.391500 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:54.392531 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
BEGIN
[0m16:38:54.547966 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:38:54.549385 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:54.550600 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
merge into "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT" as DBT_INTERNAL_DEST
    using "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("PRODUCT_NK", "URL", "TITLE", "IMAGES", "DESCRIPTION", "PRODUCT_ID", "SKU", "GTIN13", "BRAND", "PRICE", "CURRENCY", "AVAILABILITY", "UNIQ_ID", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("PRODUCT_NK", "URL", "TITLE", "IMAGES", "DESCRIPTION", "PRODUCT_ID", "SKU", "GTIN13", "BRAND", "PRICE", "CURRENCY", "AVAILABILITY", "UNIQ_ID", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m16:38:54.988326 [debug] [Thread-3 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:38:54.989644 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:38:54.990806 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
COMMIT
[0m16:38:55.234864 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:38:55.240193 [debug] [Thread-3 (]: Timing info for snapshot.product_catalog.product_snapshot (execute): 16:38:51.886603 => 16:38:55.239984
[0m16:38:55.241230 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: Close
[0m16:38:55.400458 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7146644dbee0>]}
[0m16:38:55.402102 [info ] [Thread-3 (]: 6 of 13 OK snapshotted snapshots.product_snapshot .............................. [[32mSUCCESS 0[0m in 3.54s]
[0m16:38:55.403730 [debug] [Thread-3 (]: Finished running node snapshot.product_catalog.product_snapshot
[0m16:38:55.405364 [debug] [Thread-4 (]: Began running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:38:55.406491 [info ] [Thread-4 (]: 10 of 13 START sql table model CORE_core.dim_product_scd2_from_snapshot ........ [RUN]
[0m16:38:55.407823 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_product_nk.a931f51b61, now model.product_catalog.dim_product_scd2_from_snapshot)
[0m16:38:55.408852 [debug] [Thread-4 (]: Began compiling node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:38:55.414547 [debug] [Thread-4 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:38:55.424079 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (compile): 16:38:55.409641 => 16:38:55.423687
[0m16:38:55.425142 [debug] [Thread-4 (]: Began executing node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:38:55.428520 [debug] [Thread-4 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:38:55.438033 [debug] [Thread-4 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:38:55.439326 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_from_snapshot"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
         as
        (

WITH snap AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    dbt_valid_from AS valid_from,
    dbt_valid_to   AS valid_to
  FROM PRODUCT_CATALOG.snapshots.product_snapshot
),
dedup AS (
  SELECT DISTINCT * FROM snap
)
SELECT
  MD5( COALESCE(CAST(product_nk AS STRING), '') || COALESCE(CAST(valid_from AS STRING), '') ) AS dim_product_sk,
  product_nk, url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  valid_from, valid_to,
  IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
  CURRENT_TIMESTAMP() AS dbt_loaded_at
FROM dedup
        );
[0m16:38:55.440533 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:38:56.791071 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:56.794851 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (execute): 16:38:55.425898 => 16:38:56.794597
[0m16:38:56.796154 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: Close
[0m16:38:56.935013 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '368ab827-4c09-47be-a5e2-a7fb22198aa9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714664185a80>]}
[0m16:38:56.936817 [info ] [Thread-4 (]: 10 of 13 OK created sql table model CORE_core.dim_product_scd2_from_snapshot ... [[32mSUCCESS 1[0m in 1.53s]
[0m16:38:56.938433 [debug] [Thread-4 (]: Finished running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:38:56.940233 [debug] [Thread-1 (]: Began running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:38:56.940761 [debug] [Thread-3 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:38:56.941184 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:38:56.942079 [info ] [Thread-1 (]: 11 of 13 START test dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [RUN]
[0m16:38:56.943285 [info ] [Thread-3 (]: 12 of 13 START test not_null_dim_product_scd2_from_snapshot_is_current ......... [RUN]
[0m16:38:56.944470 [info ] [Thread-2 (]: 13 of 13 START test not_null_dim_product_scd2_from_snapshot_product_nk ......... [RUN]
[0m16:38:56.946553 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.dim_product_scd2_window, now test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a)
[0m16:38:56.948127 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly snapshot.product_catalog.product_snapshot, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135)
[0m16:38:56.949585 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_updated_at.7ba2e52730, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36)
[0m16:38:56.950825 [debug] [Thread-1 (]: Began compiling node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:38:56.952167 [debug] [Thread-3 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:38:56.953421 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:38:56.963006 [debug] [Thread-1 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:38:56.966946 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:38:56.971826 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:38:56.978654 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (compile): 16:38:56.954342 => 16:38:56.978266
[0m16:38:56.979602 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (compile): 16:38:56.963557 => 16:38:56.979342
[0m16:38:56.980336 [debug] [Thread-1 (]: Began executing node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:38:56.981264 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (compile): 16:38:56.968118 => 16:38:56.981048
[0m16:38:56.981869 [debug] [Thread-3 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:38:56.985537 [debug] [Thread-1 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:38:56.986703 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:38:56.990447 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:38:56.995616 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:38:57.001442 [debug] [Thread-1 (]: Using snowflake connection "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:38:57.002302 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:38:57.003298 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        product_nk, valid_from
    from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
    group by product_nk, valid_from
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m16:38:57.004475 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:38:57.005155 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where product_nk is null



      
    ) dbt_internal_test
[0m16:38:57.006358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:38:57.007398 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_current
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where is_current is null



      
    ) dbt_internal_test
[0m16:38:57.008436 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:38:57.011497 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:38:57.500136 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:38:57.503249 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (execute): 16:38:56.992333 => 16:38:57.503028
[0m16:38:57.504266 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: Close
[0m16:38:57.513173 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:57.515565 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (execute): 16:38:56.987755 => 16:38:57.515344
[0m16:38:57.516501 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: Close
[0m16:38:57.527738 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:38:57.530146 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (execute): 16:38:56.982841 => 16:38:57.529915
[0m16:38:57.531137 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: Close
[0m16:38:57.642472 [info ] [Thread-2 (]: 13 of 13 PASS not_null_dim_product_scd2_from_snapshot_product_nk ............... [[32mPASS[0m in 0.69s]
[0m16:38:57.644398 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:38:57.672734 [info ] [Thread-3 (]: 12 of 13 PASS not_null_dim_product_scd2_from_snapshot_is_current ............... [[32mPASS[0m in 0.72s]
[0m16:38:57.673992 [info ] [Thread-1 (]: 11 of 13 PASS dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [[32mPASS[0m in 0.73s]
[0m16:38:57.675790 [debug] [Thread-3 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:38:57.676977 [debug] [Thread-1 (]: Finished running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:38:57.680554 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:38:57.681518 [debug] [MainThread]: Connection 'test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a' was properly closed.
[0m16:38:57.682527 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135' was properly closed.
[0m16:38:57.683438 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36' was properly closed.
[0m16:38:57.684355 [debug] [MainThread]: Connection 'model.product_catalog.dim_product_scd2_from_snapshot' was properly closed.
[0m16:38:57.685470 [info ] [MainThread]: 
[0m16:38:57.686739 [info ] [MainThread]: Finished running 1 view model, 9 tests, 2 table models, 1 snapshot in 0 hours 0 minutes and 10.12 seconds (10.12s).
[0m16:38:57.689323 [debug] [MainThread]: Command end result
[0m16:38:57.715556 [info ] [MainThread]: 
[0m16:38:57.717328 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:38:57.718841 [info ] [MainThread]: 
[0m16:38:57.720097 [error] [MainThread]:   Database Error in model dim_product_scd2_window (models/core/dim_product_scd2_window.sql)
  001003 (42000): SQL compilation error:
  syntax error line 68 at position 8 unexpected ';'.
  compiled Code at target/run/product_catalog/models/core/dim_product_scd2_window.sql
[0m16:38:57.721665 [info ] [MainThread]: 
[0m16:38:57.723229 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=3 TOTAL=13
[0m16:38:57.725158 [debug] [MainThread]: Resource report: {"command_name": "build", "command_wall_clock_time": 11.65539, "process_user_time": 3.824242, "process_kernel_time": 0.47049, "process_mem_max_rss": "127276", "process_in_blocks": "200", "process_out_blocks": "4544", "command_success": false}
[0m16:38:57.726415 [debug] [MainThread]: Command `dbt build` failed at 16:38:57.726297 after 11.66 seconds
[0m16:38:57.727506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714668650370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714665546050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7146658930d0>]}
[0m16:38:57.728936 [debug] [MainThread]: Flushing usage events
[0m16:41:53.209090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75331d938c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75331c0ad270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75331c0aceb0>]}


============================== 16:41:53.215627 | ab94f250-89fa-4361-8754-f50294104c76 ==============================
[0m16:41:53.215627 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:41:53.217198 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m16:41:53.309504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ab94f250-89fa-4361-8754-f50294104c76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75331c6e6a70>]}
[0m16:41:53.864825 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.709349, "process_user_time": 1.78506, "process_kernel_time": 0.316234, "process_mem_max_rss": "86420", "process_in_blocks": "68048", "process_out_blocks": "608"}
[0m16:41:53.865988 [debug] [MainThread]: Command `dbt clean` succeeded at 16:41:53.865877 after 0.71 seconds
[0m16:41:53.866921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75331d938c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75331c19e9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75331c19efb0>]}
[0m16:41:53.867967 [debug] [MainThread]: Flushing usage events
[0m16:41:57.384492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6fffba5e8880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6fffb8a197e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6fffb8a19780>]}


============================== 16:41:57.392051 | e3ee8e01-bf8e-4274-a48f-1b9fb743127d ==============================
[0m16:41:57.392051 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:41:57.393387 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run -m dim_product_scd2_window', 'send_anonymous_usage_stats': 'True'}
[0m16:41:57.775393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e3ee8e01-bf8e-4274-a48f-1b9fb743127d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6fffb8a5b520>]}
[0m16:41:57.857556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e3ee8e01-bf8e-4274-a48f-1b9fb743127d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6fffb8e2b430>]}
[0m16:41:57.863178 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:41:57.865344 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m16:41:57.866986 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5456616, "process_user_time": 2.153052, "process_kernel_time": 0.300705, "process_mem_max_rss": "103564", "process_in_blocks": "20152", "process_out_blocks": "616", "command_success": false}
[0m16:41:57.868207 [debug] [MainThread]: Command `dbt run` failed at 16:41:57.868066 after 0.55 seconds
[0m16:41:57.869338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6fffba5e8880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6fffb7975870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6fffb79740d0>]}
[0m16:41:57.870335 [debug] [MainThread]: Flushing usage events
[0m16:42:13.999209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d617da2c880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d617be9d780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d617be9d720>]}


============================== 16:42:14.005752 | d4397c20-1169-45de-b4ca-4b74d2794040 ==============================
[0m16:42:14.005752 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:42:14.007104 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt compile', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:42:14.294074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4397c20-1169-45de-b4ca-4b74d2794040', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d617bed74f0>]}
[0m16:42:14.374062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4397c20-1169-45de-b4ca-4b74d2794040', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d617c2bd090>]}
[0m16:42:14.375847 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:42:14.377718 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m16:42:14.379315 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_wall_clock_time": 0.43276316, "process_user_time": 1.911719, "process_kernel_time": 0.279374, "process_mem_max_rss": "103716", "process_out_blocks": "616", "command_success": false, "process_in_blocks": "0"}
[0m16:42:14.380389 [debug] [MainThread]: Command `dbt compile` failed at 16:42:14.380255 after 0.43 seconds
[0m16:42:14.381361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d617da2c880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d617adfe7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d617adfd990>]}
[0m16:42:14.382297 [debug] [MainThread]: Flushing usage events
[0m16:43:52.936271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac5ae8370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac425e1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac425d0f0>]}


============================== 16:43:52.942494 | 8f96ea73-6064-4356-9bf7-cce4f7c05f4b ==============================
[0m16:43:52.942494 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:43:52.943847 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/product_catalog/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:43:53.027159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8f96ea73-6064-4356-9bf7-cce4f7c05f4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac4896aa0>]}
[0m16:43:53.042320 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-5k2bd1e8'
[0m16:43:53.043613 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m16:43:53.183214 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m16:43:53.185995 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m16:43:53.246943 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m16:43:53.253562 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m16:43:57.802805 [info ] [MainThread]: Installed from version 1.3.2
[0m16:43:57.804246 [info ] [MainThread]: Up to date!
[0m16:43:57.805401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '8f96ea73-6064-4356-9bf7-cce4f7c05f4b', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac3f9eaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac3f6abf0>]}
[0m16:43:57.807424 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 4.92342, "process_user_time": 1.935767, "process_kernel_time": 0.532029, "process_mem_max_rss": "88632", "process_in_blocks": "32", "process_out_blocks": "784"}
[0m16:43:57.808759 [debug] [MainThread]: Command `dbt deps` succeeded at 16:43:57.808635 after 4.92 seconds
[0m16:43:57.809696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac5ae8370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac434ec80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cdac617e2c0>]}
[0m16:43:57.810641 [debug] [MainThread]: Flushing usage events
[0m16:44:01.263487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdec0dc880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdea50d7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdea50d780>]}


============================== 16:44:01.269622 | 42f5793a-bef9-4093-a0b7-81f8f8f0fcd3 ==============================
[0m16:44:01.269622 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:44:01.271179 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/usr/app/dbt', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run -m dim_product_scd2_window', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:44:01.553993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '42f5793a-bef9-4093-a0b7-81f8f8f0fcd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdea553520>]}
[0m16:44:01.635153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '42f5793a-bef9-4093-a0b7-81f8f8f0fcd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdea923430>]}
[0m16:44:01.636744 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:44:01.672850 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:44:01.680602 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:44:01.681779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '42f5793a-bef9-4093-a0b7-81f8f8f0fcd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fde94de2c0>]}
[0m16:44:04.179639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42f5793a-bef9-4093-a0b7-81f8f8f0fcd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fde91c1600>]}
[0m16:44:04.213094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42f5793a-bef9-4093-a0b7-81f8f8f0fcd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fde928f430>]}
[0m16:44:04.214563 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:44:04.215880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42f5793a-bef9-4093-a0b7-81f8f8f0fcd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdcae13fa0>]}
[0m16:44:04.218338 [info ] [MainThread]: 
[0m16:44:04.220201 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:44:04.222409 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:44:04.236050 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:44:04.237474 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:44:04.238605 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:44:05.161846 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m16:44:05.164108 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:44:05.306472 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m16:44:05.307874 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_snapshots'
[0m16:44:05.309041 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG_CORE_core'
[0m16:44:05.317141 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:44:05.320380 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:44:05.323984 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:44:05.325376 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:44:05.326551 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:44:05.328040 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:44:05.329133 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:44:05.330323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:44:05.331596 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:44:05.754579 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:44:05.756962 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:44:05.867466 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:44:05.869146 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:44:05.870951 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:44:05.872994 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:44:06.005985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42f5793a-bef9-4093-a0b7-81f8f8f0fcd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdcabce2f0>]}
[0m16:44:06.008294 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:44:06.009890 [info ] [MainThread]: 
[0m16:44:06.019730 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m16:44:06.021100 [info ] [Thread-1 (]: 1 of 1 START sql table model CORE_core.dim_product_scd2_window ................. [RUN]
[0m16:44:06.022629 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now model.product_catalog.dim_product_scd2_window)
[0m16:44:06.023889 [debug] [Thread-1 (]: Began compiling node model.product_catalog.dim_product_scd2_window
[0m16:44:06.034725 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_window"
[0m16:44:06.055367 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (compile): 16:44:06.024840 => 16:44:06.054855
[0m16:44:06.056904 [debug] [Thread-1 (]: Began executing node model.product_catalog.dim_product_scd2_window
[0m16:44:06.083172 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_window"
[0m16:44:06.104906 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_window"
[0m16:44:06.106237 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_window"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
         as
        (

WITH src AS (
  SELECT
    row_idx,
    product_nk,
    url,
    title,
    images,
    description,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    currency,
    availability,
    uniq_id,
    updated_at
  FROM PRODUCT_CATALOG.CORE_staging.stg_products
),

-- keep one row per (product_nk, updated_at)
dedup AS (
  SELECT *
  FROM src
  QUALIFY ROW_NUMBER() OVER (
    PARTITION BY product_nk, updated_at
    ORDER BY row_idx
  ) = 1
),

-- build SCD2 boundaries with window functions
ordered AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    updated_at,
    LAG(updated_at)  OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_from,
    LEAD(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_to
  FROM dedup
),

final AS (
  SELECT
    md5(cast(coalesce(cast(product_nk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(valid_from as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS dim_product_sk,
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    COALESCE(valid_from, updated_at) AS valid_from,
    valid_to,
    IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
    CURRENT_TIMESTAMP() AS dbt_loaded_at
  FROM ordered
)

SELECT * FROM final
        );
[0m16:44:06.107374 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:44:07.912497 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m16:44:07.930273 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (execute): 16:44:06.057831 => 16:44:07.930066
[0m16:44:07.931819 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: Close
[0m16:44:08.076850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f5793a-bef9-4093-a0b7-81f8f8f0fcd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdcaa97c10>]}
[0m16:44:08.078365 [info ] [Thread-1 (]: 1 of 1 OK created sql table model CORE_core.dim_product_scd2_window ............ [[32mSUCCESS 1[0m in 2.05s]
[0m16:44:08.079764 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m16:44:08.082647 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:44:08.083667 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_CORE_staging' was properly closed.
[0m16:44:08.084586 [debug] [MainThread]: Connection 'list_PRODUCT_CATALOG_snapshots' was properly closed.
[0m16:44:08.085412 [debug] [MainThread]: Connection 'model.product_catalog.dim_product_scd2_window' was properly closed.
[0m16:44:08.086413 [info ] [MainThread]: 
[0m16:44:08.087422 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.87 seconds (3.87s).
[0m16:44:08.088985 [debug] [MainThread]: Command end result
[0m16:44:08.115122 [info ] [MainThread]: 
[0m16:44:08.116660 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:44:08.118235 [info ] [MainThread]: 
[0m16:44:08.119867 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m16:44:08.121924 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.909822, "process_user_time": 3.987747, "process_kernel_time": 0.42209, "process_mem_max_rss": "128964", "process_in_blocks": "5016", "process_out_blocks": "2616"}
[0m16:44:08.123852 [debug] [MainThread]: Command `dbt run` succeeded at 16:44:08.123618 after 6.91 seconds
[0m16:44:08.125285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fdec0dc880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fde93e43d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76fde928f430>]}
[0m16:44:08.126376 [debug] [MainThread]: Flushing usage events
[0m16:46:27.131098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68ed0ac610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68eb51d810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68eb51d7b0>]}


============================== 16:46:27.137056 | dbda66c8-345a-48a0-96c2-d63429e93104 ==============================
[0m16:46:27.137056 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:46:27.138383 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:46:27.432360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68eb55b550>]}
[0m16:46:27.530031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68eb93b820>]}
[0m16:46:27.531782 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:46:27.563847 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:46:28.565844 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:46:28.566777 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:46:28.572497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68ea146620>]}
[0m16:46:28.601404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68ea2e5f00>]}
[0m16:46:28.602817 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m16:46:28.605366 [info ] [MainThread]: 
[0m16:46:28.607194 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:46:28.609254 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:46:28.610177 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:46:28.611120 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m16:46:28.623288 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:46:28.626077 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:46:28.629554 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m16:46:28.630800 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:46:28.631688 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:46:28.632567 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m16:46:28.633512 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:46:28.634532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:46:28.635387 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:46:30.136502 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:46:30.137146 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:46:30.138898 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:46:30.141166 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:46:30.180058 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.0 seconds
[0m16:46:30.182427 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m16:46:30.301317 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m16:46:30.302087 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m16:46:30.302736 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m16:46:30.310208 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m16:46:30.312240 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m16:46:30.315010 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m16:46:30.316068 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m16:46:30.316966 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m16:46:30.317968 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m16:46:30.318823 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:46:30.319620 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:46:30.320467 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:46:30.753535 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m16:46:30.755934 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m16:46:30.757159 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:30.760589 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m16:46:30.770957 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:30.773158 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m16:46:30.891722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68eca12a40>]}
[0m16:46:30.893530 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m16:46:30.894842 [info ] [MainThread]: 
[0m16:46:30.903433 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m16:46:30.904964 [info ] [Thread-1 (]: 1 of 13 START sql view model CORE_staging.stg_products ......................... [RUN]
[0m16:46:30.906528 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_snapshots, now model.product_catalog.stg_products)
[0m16:46:30.907724 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m16:46:30.915796 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m16:46:30.929327 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 16:46:30.908630 => 16:46:30.928958
[0m16:46:30.930389 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m16:46:30.954253 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m16:46:30.967141 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m16:46:30.968276 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      -- make it work whether column is text or timestamp
      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m16:46:30.969188 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:46:31.519992 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:46:31.538869 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 16:46:30.931169 => 16:46:31.538680
[0m16:46:31.540339 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m16:46:31.696955 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68ea079ab0>]}
[0m16:46:31.698513 [info ] [Thread-1 (]: 1 of 13 OK created sql view model CORE_staging.stg_products .................... [[32mSUCCESS 1[0m in 0.79s]
[0m16:46:31.699872 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m16:46:31.701657 [debug] [Thread-3 (]: Began running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:46:31.702089 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:46:31.702519 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:46:31.703371 [info ] [Thread-3 (]: 2 of 13 START test dbt_utils_accepted_range_stg_products_price__True__0 ........ [RUN]
[0m16:46:31.704421 [info ] [Thread-4 (]: 3 of 13 START test not_null_stg_products_product_nk ............................ [RUN]
[0m16:46:31.705825 [info ] [Thread-2 (]: 4 of 13 START test not_null_stg_products_updated_at ............................ [RUN]
[0m16:46:31.707478 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_staging, now test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e)
[0m16:46:31.709408 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.product_catalog.not_null_stg_products_product_nk.a931f51b61'
[0m16:46:31.710983 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now test.product_catalog.not_null_stg_products_updated_at.7ba2e52730)
[0m16:46:31.712254 [debug] [Thread-3 (]: Began compiling node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:46:31.713394 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:46:31.714421 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:46:31.725118 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:46:31.733514 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:46:31.737853 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:46:31.746844 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (compile): 16:46:31.715222 => 16:46:31.746480
[0m16:46:31.749609 [debug] [Thread-3 (]: Began executing node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:46:31.765067 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:46:31.766706 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (compile): 16:46:31.734289 => 16:46:31.766418
[0m16:46:31.767394 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (compile): 16:46:31.726088 => 16:46:31.767143
[0m16:46:31.768280 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:46:31.769327 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:46:31.773642 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:46:31.776672 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:46:31.782577 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m16:46:31.783748 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with meet_condition as(
  select *
  from PRODUCT_CATALOG.CORE_staging.stg_products
),

validation_errors as (
  select *
  from meet_condition
  where
    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds
    1 = 2
    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.
    or not price >= 0
)

select *
from validation_errors


      
    ) dbt_internal_test
[0m16:46:31.784365 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m16:46:31.785240 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:46:31.786174 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m16:46:31.786686 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products
where updated_at is null



      
    ) dbt_internal_test
[0m16:46:31.789325 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_staging.stg_products
where product_nk is null



      
    ) dbt_internal_test
[0m16:46:31.790445 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:46:31.791689 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:46:32.221764 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:32.222599 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:32.225927 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (execute): 16:46:31.750605 => 16:46:32.225694
[0m16:46:32.228589 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (execute): 16:46:31.770179 => 16:46:32.228308
[0m16:46:32.229788 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: Close
[0m16:46:32.230898 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: Close
[0m16:46:32.254602 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:32.257446 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (execute): 16:46:31.774644 => 16:46:32.257212
[0m16:46:32.258687 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: Close
[0m16:46:32.372998 [info ] [Thread-2 (]: 4 of 13 PASS not_null_stg_products_updated_at .................................. [[32mPASS[0m in 0.66s]
[0m16:46:32.373972 [info ] [Thread-3 (]: 2 of 13 PASS dbt_utils_accepted_range_stg_products_price__True__0 .............. [[32mPASS[0m in 0.67s]
[0m16:46:32.375612 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m16:46:32.376662 [debug] [Thread-3 (]: Finished running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m16:46:32.387471 [info ] [Thread-4 (]: 3 of 13 PASS not_null_stg_products_product_nk .................................. [[32mPASS[0m in 0.68s]
[0m16:46:32.389020 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m16:46:32.390942 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m16:46:32.391322 [debug] [Thread-2 (]: Began running node snapshot.product_catalog.product_snapshot
[0m16:46:32.392277 [info ] [Thread-1 (]: 5 of 13 START sql table model CORE_core.dim_product_scd2_window ................ [RUN]
[0m16:46:32.393647 [info ] [Thread-2 (]: 6 of 13 START snapshot snapshots.product_snapshot .............................. [RUN]
[0m16:46:32.395045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.stg_products, now model.product_catalog.dim_product_scd2_window)
[0m16:46:32.396378 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_updated_at.7ba2e52730, now snapshot.product_catalog.product_snapshot)
[0m16:46:32.397537 [debug] [Thread-1 (]: Began compiling node model.product_catalog.dim_product_scd2_window
[0m16:46:32.399013 [debug] [Thread-2 (]: Began compiling node snapshot.product_catalog.product_snapshot
[0m16:46:32.415188 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_window"
[0m16:46:32.418828 [debug] [Thread-2 (]: Timing info for snapshot.product_catalog.product_snapshot (compile): 16:46:32.415572 => 16:46:32.418541
[0m16:46:32.420853 [debug] [Thread-2 (]: Began executing node snapshot.product_catalog.product_snapshot
[0m16:46:32.453344 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (compile): 16:46:32.400229 => 16:46:32.453008
[0m16:46:32.457990 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:32.458916 [debug] [Thread-1 (]: Began executing node model.product_catalog.dim_product_scd2_window
[0m16:46:32.460147 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m16:46:32.477681 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_window"
[0m16:46:32.478121 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:46:32.488575 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_window"
[0m16:46:32.489713 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_window"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
         as
        (

WITH src AS (
  SELECT
    row_idx,
    product_nk,
    url,
    title,
    images,
    description,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    currency,
    availability,
    uniq_id,
    updated_at
  FROM PRODUCT_CATALOG.CORE_staging.stg_products
),

-- keep one row per (product_nk, updated_at)
dedup AS (
  SELECT *
  FROM src
  QUALIFY ROW_NUMBER() OVER (
    PARTITION BY product_nk, updated_at
    ORDER BY row_idx
  ) = 1
),

-- build SCD2 boundaries with window functions
ordered AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    updated_at,
    LAG(updated_at)  OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_from,
    LEAD(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_to
  FROM dedup
),

final AS (
  SELECT
    md5(cast(coalesce(cast(product_nk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(valid_from as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS dim_product_sk,
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    COALESCE(valid_from, updated_at) AS valid_from,
    valid_to,
    IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
    CURRENT_TIMESTAMP() AS dbt_loaded_at
  FROM ordered
)

SELECT * FROM final
        );
[0m16:46:32.490778 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:46:32.977166 [debug] [Thread-2 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m16:46:32.993201 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:32.994637 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
create or replace temporary table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        

select
  product_nk,
  url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products

    ),

    snapshotted_data as (

        select *,
            product_nk as dbt_unique_key

        from "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            product_nk as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            md5(coalesce(cast(product_nk as varchar ), '')
         || '|' || coalesce(cast(updated_at as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            product_nk as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m16:46:33.749965 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:46:33.754098 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:33.755377 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m16:46:33.838075 [debug] [Thread-2 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:46:33.844175 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:33.845830 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m16:46:33.942424 [debug] [Thread-2 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m16:46:33.947501 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:33.948629 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m16:46:33.951921 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:46:33.954768 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (execute): 16:46:32.461010 => 16:46:33.954567
[0m16:46:33.956275 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: Close
[0m16:46:34.058291 [debug] [Thread-2 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:46:34.063495 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:34.064762 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m16:46:34.125809 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68e8648e50>]}
[0m16:46:34.127703 [info ] [Thread-1 (]: 5 of 13 OK created sql table model CORE_core.dim_product_scd2_window ........... [[32mSUCCESS 1[0m in 1.73s]
[0m16:46:34.129254 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m16:46:34.130950 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:46:34.131402 [debug] [Thread-3 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:46:34.131795 [debug] [Thread-1 (]: Began running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:46:34.132668 [info ] [Thread-4 (]: 7 of 13 START test not_null_dim_product_scd2_window_dim_product_sk ............. [RUN]
[0m16:46:34.133738 [info ] [Thread-3 (]: 8 of 13 START test not_null_dim_product_scd2_window_product_nk ................. [RUN]
[0m16:46:34.134911 [info ] [Thread-1 (]: 9 of 13 START test unique_dim_product_scd2_window_dim_product_sk ............... [RUN]
[0m16:46:34.136583 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_product_nk.a931f51b61, now test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376)
[0m16:46:34.138485 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e, now test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e)
[0m16:46:34.139940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.dim_product_scd2_window, now test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e)
[0m16:46:34.141035 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:46:34.142395 [debug] [Thread-3 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:46:34.144051 [debug] [Thread-1 (]: Began compiling node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:46:34.148981 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m16:46:34.153918 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m16:46:34.160455 [debug] [Thread-1 (]: Writing injected SQL for node "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m16:46:34.169255 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376 (compile): 16:46:34.144959 => 16:46:34.168856
[0m16:46:34.170481 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:46:34.175542 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m16:46:34.176968 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e (compile): 16:46:34.150230 => 16:46:34.176713
[0m16:46:34.177744 [debug] [Thread-1 (]: Timing info for test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e (compile): 16:46:34.154932 => 16:46:34.177509
[0m16:46:34.178583 [debug] [Thread-3 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:46:34.179522 [debug] [Thread-1 (]: Began executing node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:46:34.183287 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m16:46:34.184814 [debug] [Thread-2 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m16:46:34.187921 [debug] [Thread-1 (]: Writing runtime sql for node "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m16:46:34.196065 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:34.198252 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m16:46:34.198949 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m16:46:34.200496 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m16:46:34.200871 [debug] [Thread-4 (]: On test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dim_product_sk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where dim_product_sk is null



      
    ) dbt_internal_test
[0m16:46:34.201579 [debug] [Thread-1 (]: Using snowflake connection "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m16:46:34.204307 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where product_nk is null



      
    ) dbt_internal_test
[0m16:46:34.205764 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:46:34.206882 [debug] [Thread-1 (]: On test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dim_product_sk as unique_field,
    count(*) as n_records

from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where dim_product_sk is not null
group by dim_product_sk
having count(*) > 1



      
    ) dbt_internal_test
[0m16:46:34.207981 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:46:34.211091 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:46:34.320296 [debug] [Thread-2 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:46:34.328803 [debug] [Thread-2 (]: Writing runtime sql for node "snapshot.product_catalog.product_snapshot"
[0m16:46:34.343391 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:34.344589 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
BEGIN
[0m16:46:34.459641 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:34.460969 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:34.462022 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
merge into "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT" as DBT_INTERNAL_DEST
    using "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("PRODUCT_NK", "URL", "TITLE", "IMAGES", "DESCRIPTION", "PRODUCT_ID", "SKU", "GTIN13", "BRAND", "PRICE", "CURRENCY", "AVAILABILITY", "UNIQ_ID", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("PRODUCT_NK", "URL", "TITLE", "IMAGES", "DESCRIPTION", "PRODUCT_ID", "SKU", "GTIN13", "BRAND", "PRICE", "CURRENCY", "AVAILABILITY", "UNIQ_ID", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m16:46:34.610597 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:34.613930 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376 (execute): 16:46:34.171473 => 16:46:34.613641
[0m16:46:34.615055 [debug] [Thread-4 (]: On test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376: Close
[0m16:46:34.667057 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:34.671113 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e (execute): 16:46:34.180467 => 16:46:34.670770
[0m16:46:34.672241 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e: Close
[0m16:46:34.693101 [debug] [Thread-2 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m16:46:34.694456 [debug] [Thread-2 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m16:46:34.695477 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
COMMIT
[0m16:46:34.720223 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:46:34.723231 [debug] [Thread-1 (]: Timing info for test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e (execute): 16:46:34.185308 => 16:46:34.722984
[0m16:46:34.724418 [debug] [Thread-1 (]: On test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e: Close
[0m16:46:34.754240 [info ] [Thread-4 (]: 7 of 13 PASS not_null_dim_product_scd2_window_dim_product_sk ................... [[32mPASS[0m in 0.62s]
[0m16:46:34.756118 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m16:46:34.816127 [info ] [Thread-3 (]: 8 of 13 PASS not_null_dim_product_scd2_window_product_nk ....................... [[32mPASS[0m in 0.68s]
[0m16:46:34.818211 [debug] [Thread-3 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m16:46:34.830701 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:34.835817 [debug] [Thread-2 (]: Timing info for snapshot.product_catalog.product_snapshot (execute): 16:46:32.421791 => 16:46:34.835608
[0m16:46:34.837276 [debug] [Thread-2 (]: On snapshot.product_catalog.product_snapshot: Close
[0m16:46:34.874770 [info ] [Thread-1 (]: 9 of 13 PASS unique_dim_product_scd2_window_dim_product_sk ..................... [[32mPASS[0m in 0.73s]
[0m16:46:34.876606 [debug] [Thread-1 (]: Finished running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m16:46:34.968135 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68ea2b4ee0>]}
[0m16:46:34.970180 [info ] [Thread-2 (]: 6 of 13 OK snapshotted snapshots.product_snapshot .............................. [[32mSUCCESS 0[0m in 2.57s]
[0m16:46:34.971736 [debug] [Thread-2 (]: Finished running node snapshot.product_catalog.product_snapshot
[0m16:46:34.973634 [debug] [Thread-4 (]: Began running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:46:34.974652 [info ] [Thread-4 (]: 10 of 13 START sql table model CORE_core.dim_product_scd2_from_snapshot ........ [RUN]
[0m16:46:34.975946 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376, now model.product_catalog.dim_product_scd2_from_snapshot)
[0m16:46:34.976941 [debug] [Thread-4 (]: Began compiling node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:46:34.983962 [debug] [Thread-4 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:46:34.993904 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (compile): 16:46:34.977732 => 16:46:34.993538
[0m16:46:34.995015 [debug] [Thread-4 (]: Began executing node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:46:34.998372 [debug] [Thread-4 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:46:35.008926 [debug] [Thread-4 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_from_snapshot"
[0m16:46:35.010430 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_from_snapshot"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
         as
        (

WITH snap AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    dbt_valid_from AS valid_from,
    dbt_valid_to   AS valid_to
  FROM PRODUCT_CATALOG.snapshots.product_snapshot
),
dedup AS (
  SELECT DISTINCT * FROM snap
)
SELECT
  MD5( COALESCE(CAST(product_nk AS STRING), '') || COALESCE(CAST(valid_from AS STRING), '') ) AS dim_product_sk,
  product_nk, url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  valid_from, valid_to,
  IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
  CURRENT_TIMESTAMP() AS dbt_loaded_at
FROM dedup
        );
[0m16:46:35.011655 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:46:36.471735 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:46:36.475162 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (execute): 16:46:34.995813 => 16:46:36.474943
[0m16:46:36.476339 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: Close
[0m16:46:36.590982 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbda66c8-345a-48a0-96c2-d63429e93104', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68e8656800>]}
[0m16:46:36.592593 [info ] [Thread-4 (]: 10 of 13 OK created sql table model CORE_core.dim_product_scd2_from_snapshot ... [[32mSUCCESS 1[0m in 1.62s]
[0m16:46:36.594344 [debug] [Thread-4 (]: Finished running node model.product_catalog.dim_product_scd2_from_snapshot
[0m16:46:36.596268 [debug] [Thread-1 (]: Began running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:46:36.596712 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:46:36.597145 [debug] [Thread-3 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:46:36.597992 [info ] [Thread-1 (]: 11 of 13 START test dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [RUN]
[0m16:46:36.599028 [info ] [Thread-2 (]: 12 of 13 START test not_null_dim_product_scd2_from_snapshot_is_current ......... [RUN]
[0m16:46:36.600252 [info ] [Thread-3 (]: 13 of 13 START test not_null_dim_product_scd2_from_snapshot_product_nk ......... [RUN]
[0m16:46:36.602063 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e, now test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a)
[0m16:46:36.603962 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly snapshot.product_catalog.product_snapshot, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135)
[0m16:46:36.605716 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36)
[0m16:46:36.606814 [debug] [Thread-1 (]: Began compiling node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:46:36.607827 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:46:36.608943 [debug] [Thread-3 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:46:36.618430 [debug] [Thread-1 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:46:36.622324 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:46:36.627542 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:46:36.634378 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (compile): 16:46:36.623580 => 16:46:36.633970
[0m16:46:36.635710 [debug] [Thread-3 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:46:36.636223 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (compile): 16:46:36.609817 => 16:46:36.636002
[0m16:46:36.641246 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:46:36.641906 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (compile): 16:46:36.618983 => 16:46:36.641681
[0m16:46:36.642777 [debug] [Thread-1 (]: Began executing node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:46:36.644492 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:46:36.648243 [debug] [Thread-1 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:46:36.652056 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:46:36.653773 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m16:46:36.655519 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where product_nk is null



      
    ) dbt_internal_test
[0m16:46:36.656500 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:46:36.660517 [debug] [Thread-1 (]: Using snowflake connection "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m16:46:36.662198 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        product_nk, valid_from
    from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
    group by product_nk, valid_from
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m16:46:36.663122 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m16:46:36.664050 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:46:36.665341 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_current
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where is_current is null



      
    ) dbt_internal_test
[0m16:46:36.668267 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:46:37.148825 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:37.151800 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (execute): 16:46:36.649523 => 16:46:37.151555
[0m16:46:37.152937 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: Close
[0m16:46:37.156410 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:46:37.159213 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (execute): 16:46:36.637026 => 16:46:37.158970
[0m16:46:37.160543 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: Close
[0m16:46:37.195835 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:46:37.199220 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (execute): 16:46:36.645493 => 16:46:37.198918
[0m16:46:37.200414 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: Close
[0m16:46:37.291337 [info ] [Thread-2 (]: 12 of 13 PASS not_null_dim_product_scd2_from_snapshot_is_current ............... [[32mPASS[0m in 0.69s]
[0m16:46:37.293289 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m16:46:37.320007 [info ] [Thread-3 (]: 13 of 13 PASS not_null_dim_product_scd2_from_snapshot_product_nk ............... [[32mPASS[0m in 0.71s]
[0m16:46:37.321985 [debug] [Thread-3 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m16:46:37.359351 [info ] [Thread-1 (]: 11 of 13 PASS dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [[32mPASS[0m in 0.76s]
[0m16:46:37.361088 [debug] [Thread-1 (]: Finished running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m16:46:37.363998 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:46:37.365056 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36' was properly closed.
[0m16:46:37.366269 [debug] [MainThread]: Connection 'test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a' was properly closed.
[0m16:46:37.367270 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135' was properly closed.
[0m16:46:37.368267 [debug] [MainThread]: Connection 'model.product_catalog.dim_product_scd2_from_snapshot' was properly closed.
[0m16:46:37.369306 [info ] [MainThread]: 
[0m16:46:37.370488 [info ] [MainThread]: Finished running 1 view model, 9 tests, 2 table models, 1 snapshot in 0 hours 0 minutes and 8.76 seconds (8.76s).
[0m16:46:37.374061 [debug] [MainThread]: Command end result
[0m16:46:37.402205 [info ] [MainThread]: 
[0m16:46:37.403781 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:46:37.405257 [info ] [MainThread]: 
[0m16:46:37.406707 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m16:46:37.408669 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 10.330852, "process_user_time": 3.942824, "process_kernel_time": 0.53674, "process_mem_max_rss": "126640", "process_in_blocks": "200", "process_out_blocks": "4544"}
[0m16:46:37.409921 [debug] [MainThread]: Command `dbt build` succeeded at 16:46:37.409791 after 10.33 seconds
[0m16:46:37.410951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68ed0ac610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68ea550760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f68e86710f0>]}
[0m16:46:37.411985 [debug] [MainThread]: Flushing usage events
[0m17:59:49.616131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe22784580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe20c05810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe20c057b0>]}


============================== 17:59:49.624492 | 1e7239e6-44de-4427-bc16-e96b95f6c4ab ==============================
[0m17:59:49.624492 [info ] [MainThread]: Running with dbt=1.7.10
[0m17:59:49.625858 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/product_catalog/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:59:50.063148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe20c43550>]}
[0m17:59:50.147066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe210177f0>]}
[0m17:59:50.149213 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m17:59:50.180510 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m17:59:51.280502 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:59:51.281899 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:59:51.289225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe1f82a620>]}
[0m17:59:51.325212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe1f9c5f00>]}
[0m17:59:51.327289 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m17:59:51.331169 [info ] [MainThread]: 
[0m17:59:51.333640 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:59:51.336213 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m17:59:51.337286 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m17:59:51.338720 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m17:59:51.352335 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m17:59:51.355005 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m17:59:51.358886 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m17:59:51.360209 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m17:59:51.361281 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m17:59:51.362890 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m17:59:51.364374 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:59:51.365364 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:59:51.366243 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:59:52.826659 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m17:59:52.829388 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m17:59:52.834459 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 1.0 seconds
[0m17:59:52.837019 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m17:59:52.922167 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 2.0 seconds
[0m17:59:52.924409 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m17:59:53.068603 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m17:59:53.069666 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m17:59:53.070447 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m17:59:53.080339 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m17:59:53.083274 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m17:59:53.086679 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m17:59:53.087863 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m17:59:53.088937 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m17:59:53.090108 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m17:59:53.091206 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:59:53.092214 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:59:53.093248 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:59:53.518955 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m17:59:53.521746 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m17:59:53.525979 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:59:53.528412 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m17:59:53.680788 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:59:53.682895 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m17:59:53.814027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe220e9510>]}
[0m17:59:53.815861 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:59:53.817186 [info ] [MainThread]: 
[0m17:59:53.827674 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m17:59:53.829517 [info ] [Thread-1 (]: 1 of 13 START sql view model CORE_staging.stg_products ......................... [RUN]
[0m17:59:53.831307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_staging, now model.product_catalog.stg_products)
[0m17:59:53.832462 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m17:59:53.840649 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m17:59:53.850340 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 17:59:53.833236 => 17:59:53.849945
[0m17:59:53.851436 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m17:59:53.876600 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m17:59:53.885977 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m17:59:53.887201 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      -- make it work whether column is text or timestamp
      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m17:59:53.888280 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:59:54.523688 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:59:54.542795 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 17:59:53.852516 => 17:59:54.542596
[0m17:59:54.544068 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m17:59:54.678396 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe1f69afe0>]}
[0m17:59:54.680048 [info ] [Thread-1 (]: 1 of 13 OK created sql view model CORE_staging.stg_products .................... [[32mSUCCESS 1[0m in 0.85s]
[0m17:59:54.681408 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m17:59:54.683362 [debug] [Thread-3 (]: Began running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m17:59:54.683854 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m17:59:54.684237 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m17:59:54.685132 [info ] [Thread-3 (]: 2 of 13 START test dbt_utils_accepted_range_stg_products_price__True__0 ........ [RUN]
[0m17:59:54.686084 [info ] [Thread-4 (]: 3 of 13 START test not_null_stg_products_product_nk ............................ [RUN]
[0m17:59:54.687209 [info ] [Thread-2 (]: 4 of 13 START test not_null_stg_products_updated_at ............................ [RUN]
[0m17:59:54.688964 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e)
[0m17:59:54.691597 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.product_catalog.not_null_stg_products_product_nk.a931f51b61'
[0m17:59:54.693182 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_snapshots, now test.product_catalog.not_null_stg_products_updated_at.7ba2e52730)
[0m17:59:54.694254 [debug] [Thread-3 (]: Began compiling node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m17:59:54.695478 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m17:59:54.696756 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m17:59:54.709371 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m17:59:54.719725 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m17:59:54.724960 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m17:59:54.732235 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (compile): 17:59:54.697697 => 17:59:54.731773
[0m17:59:54.732862 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (compile): 17:59:54.720738 => 17:59:54.732536
[0m17:59:54.734011 [debug] [Thread-3 (]: Began executing node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m17:59:54.735199 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m17:59:54.735784 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (compile): 17:59:54.709967 => 17:59:54.735576
[0m17:59:54.751558 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m17:59:54.755786 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m17:59:54.757283 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m17:59:54.762036 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m17:59:54.767474 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m17:59:54.768990 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m17:59:54.769726 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products
where updated_at is null



      
    ) dbt_internal_test
[0m17:59:54.770821 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m17:59:54.771458 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with meet_condition as(
  select *
  from PRODUCT_CATALOG.CORE_staging.stg_products
),

validation_errors as (
  select *
  from meet_condition
  where
    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds
    1 = 2
    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.
    or not price >= 0
)

select *
from validation_errors


      
    ) dbt_internal_test
[0m17:59:54.772471 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m17:59:54.773601 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_staging.stg_products
where product_nk is null



      
    ) dbt_internal_test
[0m17:59:54.775025 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m17:59:54.777919 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:59:55.358583 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:59:55.363412 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (execute): 17:59:54.736358 => 17:59:55.362903
[0m17:59:55.365169 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: Close
[0m17:59:55.460465 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:59:55.461202 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:59:55.463408 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (execute): 17:59:54.752178 => 17:59:55.463143
[0m17:59:55.466190 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (execute): 17:59:54.759478 => 17:59:55.465891
[0m17:59:55.467400 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: Close
[0m17:59:55.468353 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: Close
[0m17:59:55.484402 [info ] [Thread-3 (]: 2 of 13 PASS dbt_utils_accepted_range_stg_products_price__True__0 .............. [[32mPASS[0m in 0.80s]
[0m17:59:55.486032 [debug] [Thread-3 (]: Finished running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m17:59:55.602941 [info ] [Thread-2 (]: 4 of 13 PASS not_null_stg_products_updated_at .................................. [[32mPASS[0m in 0.91s]
[0m17:59:55.605358 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m17:59:55.608410 [info ] [Thread-4 (]: 3 of 13 PASS not_null_stg_products_product_nk .................................. [[32mPASS[0m in 0.92s]
[0m17:59:55.610076 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m17:59:55.612489 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m17:59:55.613039 [debug] [Thread-3 (]: Began running node snapshot.product_catalog.product_snapshot
[0m17:59:55.613977 [info ] [Thread-1 (]: 5 of 13 START sql table model CORE_core.dim_product_scd2_window ................ [RUN]
[0m17:59:55.614939 [info ] [Thread-3 (]: 6 of 13 START snapshot snapshots.product_snapshot .............................. [RUN]
[0m17:59:55.616640 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.stg_products, now model.product_catalog.dim_product_scd2_window)
[0m17:59:55.618793 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e, now snapshot.product_catalog.product_snapshot)
[0m17:59:55.619991 [debug] [Thread-1 (]: Began compiling node model.product_catalog.dim_product_scd2_window
[0m17:59:55.620936 [debug] [Thread-3 (]: Began compiling node snapshot.product_catalog.product_snapshot
[0m17:59:55.635671 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_window"
[0m17:59:55.639288 [debug] [Thread-3 (]: Timing info for snapshot.product_catalog.product_snapshot (compile): 17:59:55.636083 => 17:59:55.639031
[0m17:59:55.641349 [debug] [Thread-3 (]: Began executing node snapshot.product_catalog.product_snapshot
[0m17:59:55.679886 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:55.680472 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (compile): 17:59:55.621708 => 17:59:55.680228
[0m17:59:55.681210 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m17:59:55.682153 [debug] [Thread-1 (]: Began executing node model.product_catalog.dim_product_scd2_window
[0m17:59:55.683495 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m17:59:55.702316 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_window"
[0m17:59:55.713757 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_window"
[0m17:59:55.715075 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_window"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
         as
        (

WITH src AS (
  SELECT
    row_idx,
    product_nk,
    url,
    title,
    images,
    description,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    currency,
    availability,
    uniq_id,
    updated_at
  FROM PRODUCT_CATALOG.CORE_staging.stg_products
),

-- keep one row per (product_nk, updated_at)
dedup AS (
  SELECT *
  FROM src
  QUALIFY ROW_NUMBER() OVER (
    PARTITION BY product_nk, updated_at
    ORDER BY row_idx
  ) = 1
),

-- build SCD2 boundaries with window functions
ordered AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    updated_at,
    LAG(updated_at)  OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_from,
    LEAD(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_to
  FROM dedup
),

final AS (
  SELECT
    md5(cast(coalesce(cast(product_nk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(valid_from as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS dim_product_sk,
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    COALESCE(valid_from, updated_at) AS valid_from,
    valid_to,
    IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
    CURRENT_TIMESTAMP() AS dbt_loaded_at
  FROM ordered
)

SELECT * FROM final
        );
[0m17:59:55.716064 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:59:56.042872 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m17:59:56.057531 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:56.059664 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
create or replace temporary table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        

select
  product_nk,
  url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products

    ),

    snapshotted_data as (

        select *,
            product_nk as dbt_unique_key

        from "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            product_nk as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            md5(coalesce(cast(product_nk as varchar ), '')
         || '|' || coalesce(cast(updated_at as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            product_nk as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m17:59:57.090508 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:59:57.093971 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (execute): 17:59:55.684508 => 17:59:57.093749
[0m17:59:57.095455 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: Close
[0m17:59:57.247691 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe1dc71030>]}
[0m17:59:57.249422 [info ] [Thread-1 (]: 5 of 13 OK created sql table model CORE_core.dim_product_scd2_window ........... [[32mSUCCESS 1[0m in 1.63s]
[0m17:59:57.251020 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m17:59:57.252795 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m17:59:57.253260 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m17:59:57.253713 [debug] [Thread-1 (]: Began running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m17:59:57.254851 [info ] [Thread-4 (]: 7 of 13 START test not_null_dim_product_scd2_window_dim_product_sk ............. [RUN]
[0m17:59:57.256047 [info ] [Thread-2 (]: 8 of 13 START test not_null_dim_product_scd2_window_product_nk ................. [RUN]
[0m17:59:57.257167 [info ] [Thread-1 (]: 9 of 13 START test unique_dim_product_scd2_window_dim_product_sk ............... [RUN]
[0m17:59:57.258942 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_product_nk.a931f51b61, now test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376)
[0m17:59:57.261108 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_updated_at.7ba2e52730, now test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e)
[0m17:59:57.262365 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.dim_product_scd2_window, now test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e)
[0m17:59:57.263392 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m17:59:57.264513 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m17:59:57.265887 [debug] [Thread-1 (]: Began compiling node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m17:59:57.271651 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m17:59:57.276548 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m17:59:57.285620 [debug] [Thread-1 (]: Writing injected SQL for node "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m17:59:57.292674 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e (compile): 17:59:57.272922 => 17:59:57.292290
[0m17:59:57.293762 [debug] [Thread-1 (]: Timing info for test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e (compile): 17:59:57.277926 => 17:59:57.293496
[0m17:59:57.294467 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m17:59:57.295763 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376 (compile): 17:59:57.266869 => 17:59:57.295361
[0m17:59:57.296472 [debug] [Thread-1 (]: Began executing node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m17:59:57.299940 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m17:59:57.301323 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m17:59:57.305108 [debug] [Thread-1 (]: Writing runtime sql for node "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m17:59:57.309562 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m17:59:57.315668 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m17:59:57.316470 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m17:59:57.317632 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where product_nk is null



      
    ) dbt_internal_test
[0m17:59:57.318789 [debug] [Thread-1 (]: Using snowflake connection "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m17:59:57.319509 [debug] [Thread-4 (]: On test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dim_product_sk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where dim_product_sk is null



      
    ) dbt_internal_test
[0m17:59:57.321182 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m17:59:57.322353 [debug] [Thread-1 (]: On test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dim_product_sk as unique_field,
    count(*) as n_records

from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where dim_product_sk is not null
group by dim_product_sk
having count(*) > 1



      
    ) dbt_internal_test
[0m17:59:57.323593 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m17:59:57.326992 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:59:57.329096 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:59:57.337444 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:57.339262 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m17:59:57.430675 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m17:59:57.437671 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:57.439361 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m17:59:57.546885 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m17:59:57.552371 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:57.553833 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m17:59:57.654575 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m17:59:57.660280 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:57.661605 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m17:59:57.740081 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m17:59:57.749038 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:57.750711 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m17:59:57.756745 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:59:57.759414 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376 (execute): 17:59:57.306914 => 17:59:57.759141
[0m17:59:57.760370 [debug] [Thread-4 (]: On test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376: Close
[0m17:59:57.767102 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:59:57.770124 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e (execute): 17:59:57.297427 => 17:59:57.769834
[0m17:59:57.771163 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e: Close
[0m17:59:57.858633 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m17:59:57.868366 [debug] [Thread-3 (]: Writing runtime sql for node "snapshot.product_catalog.product_snapshot"
[0m17:59:57.876433 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:57.877795 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
BEGIN
[0m17:59:57.883118 [info ] [Thread-4 (]: 7 of 13 PASS not_null_dim_product_scd2_window_dim_product_sk ................... [[32mPASS[0m in 0.62s]
[0m17:59:57.884877 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m17:59:57.920999 [info ] [Thread-2 (]: 8 of 13 PASS not_null_dim_product_scd2_window_product_nk ....................... [[32mPASS[0m in 0.66s]
[0m17:59:57.922624 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m17:59:58.008576 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:59:58.010276 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:58.011818 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
merge into "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT" as DBT_INTERNAL_DEST
    using "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("PRODUCT_NK", "URL", "TITLE", "IMAGES", "DESCRIPTION", "PRODUCT_ID", "SKU", "GTIN13", "BRAND", "PRICE", "CURRENCY", "AVAILABILITY", "UNIQ_ID", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("PRODUCT_NK", "URL", "TITLE", "IMAGES", "DESCRIPTION", "PRODUCT_ID", "SKU", "GTIN13", "BRAND", "PRICE", "CURRENCY", "AVAILABILITY", "UNIQ_ID", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m17:59:58.048757 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m17:59:58.051841 [debug] [Thread-1 (]: Timing info for test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e (execute): 17:59:57.302430 => 17:59:58.051588
[0m17:59:58.053154 [debug] [Thread-1 (]: On test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e: Close
[0m17:59:58.178256 [info ] [Thread-1 (]: 9 of 13 PASS unique_dim_product_scd2_window_dim_product_sk ..................... [[32mPASS[0m in 0.92s]
[0m17:59:58.180193 [debug] [Thread-1 (]: Finished running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m17:59:58.942774 [debug] [Thread-3 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m17:59:58.944455 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m17:59:58.945879 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
COMMIT
[0m17:59:59.255180 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m17:59:59.260666 [debug] [Thread-3 (]: Timing info for snapshot.product_catalog.product_snapshot (execute): 17:59:55.642260 => 17:59:59.260383
[0m17:59:59.262011 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: Close
[0m17:59:59.384159 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe1dc7d990>]}
[0m17:59:59.386421 [info ] [Thread-3 (]: 6 of 13 OK snapshotted snapshots.product_snapshot .............................. [[32mSUCCESS 2[0m in 3.77s]
[0m17:59:59.388193 [debug] [Thread-3 (]: Finished running node snapshot.product_catalog.product_snapshot
[0m17:59:59.389952 [debug] [Thread-4 (]: Began running node model.product_catalog.dim_product_scd2_from_snapshot
[0m17:59:59.391097 [info ] [Thread-4 (]: 10 of 13 START sql table model CORE_core.dim_product_scd2_from_snapshot ........ [RUN]
[0m17:59:59.392978 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376, now model.product_catalog.dim_product_scd2_from_snapshot)
[0m17:59:59.394370 [debug] [Thread-4 (]: Began compiling node model.product_catalog.dim_product_scd2_from_snapshot
[0m17:59:59.400349 [debug] [Thread-4 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m17:59:59.408658 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (compile): 17:59:59.395209 => 17:59:59.408124
[0m17:59:59.409868 [debug] [Thread-4 (]: Began executing node model.product_catalog.dim_product_scd2_from_snapshot
[0m17:59:59.414724 [debug] [Thread-4 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m17:59:59.425419 [debug] [Thread-4 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_from_snapshot"
[0m17:59:59.426656 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_from_snapshot"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
         as
        (

WITH snap AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    dbt_valid_from AS valid_from,
    dbt_valid_to   AS valid_to
  FROM PRODUCT_CATALOG.snapshots.product_snapshot
),
dedup AS (
  SELECT DISTINCT * FROM snap
)
SELECT
  MD5( COALESCE(CAST(product_nk AS STRING), '') || COALESCE(CAST(valid_from AS STRING), '') ) AS dim_product_sk,
  product_nk, url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  valid_from, valid_to,
  IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
  CURRENT_TIMESTAMP() AS dbt_loaded_at
FROM dedup
        );
[0m17:59:59.427662 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:00:00.742957 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:00:00.746692 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (execute): 17:59:59.410999 => 18:00:00.746471
[0m18:00:00.748131 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: Close
[0m18:00:00.870419 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e7239e6-44de-4427-bc16-e96b95f6c4ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe1c264a60>]}
[0m18:00:00.872526 [info ] [Thread-4 (]: 10 of 13 OK created sql table model CORE_core.dim_product_scd2_from_snapshot ... [[32mSUCCESS 1[0m in 1.48s]
[0m18:00:00.874213 [debug] [Thread-4 (]: Finished running node model.product_catalog.dim_product_scd2_from_snapshot
[0m18:00:00.876136 [debug] [Thread-1 (]: Began running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m18:00:00.876557 [debug] [Thread-3 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m18:00:00.877050 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m18:00:00.878045 [info ] [Thread-1 (]: 11 of 13 START test dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [RUN]
[0m18:00:00.879158 [info ] [Thread-3 (]: 12 of 13 START test not_null_dim_product_scd2_from_snapshot_is_current ......... [RUN]
[0m18:00:00.880360 [info ] [Thread-2 (]: 13 of 13 START test not_null_dim_product_scd2_from_snapshot_product_nk ......... [RUN]
[0m18:00:00.882029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e, now test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a)
[0m18:00:00.884088 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly snapshot.product_catalog.product_snapshot, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135)
[0m18:00:00.885661 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36)
[0m18:00:00.887161 [debug] [Thread-1 (]: Began compiling node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m18:00:00.888241 [debug] [Thread-3 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m18:00:00.889554 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m18:00:00.900123 [debug] [Thread-1 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m18:00:00.905005 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m18:00:00.909876 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m18:00:00.917749 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (compile): 18:00:00.890908 => 18:00:00.917330
[0m18:00:00.918347 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (compile): 18:00:00.906155 => 18:00:00.918076
[0m18:00:00.919274 [debug] [Thread-1 (]: Began executing node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m18:00:00.920116 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (compile): 18:00:00.901055 => 18:00:00.919813
[0m18:00:00.920990 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m18:00:00.924531 [debug] [Thread-1 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m18:00:00.925805 [debug] [Thread-3 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m18:00:00.930327 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m18:00:00.935257 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m18:00:00.941823 [debug] [Thread-1 (]: Using snowflake connection "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m18:00:00.942656 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m18:00:00.943509 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        product_nk, valid_from
    from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
    group by product_nk, valid_from
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m18:00:00.944419 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m18:00:00.945062 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where product_nk is null



      
    ) dbt_internal_test
[0m18:00:00.946362 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:00:00.947426 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_current
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where is_current is null



      
    ) dbt_internal_test
[0m18:00:00.948350 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:00:00.951791 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m18:00:01.539211 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:00:01.542107 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (execute): 18:00:00.932816 => 18:00:01.541856
[0m18:00:01.543391 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: Close
[0m18:00:01.550587 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:00:01.553620 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (execute): 18:00:00.926884 => 18:00:01.553351
[0m18:00:01.554843 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: Close
[0m18:00:01.556554 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m18:00:01.561661 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (execute): 18:00:00.921905 => 18:00:01.561338
[0m18:00:01.563311 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: Close
[0m18:00:01.711739 [info ] [Thread-3 (]: 12 of 13 PASS not_null_dim_product_scd2_from_snapshot_is_current ............... [[32mPASS[0m in 0.83s]
[0m18:00:01.713721 [debug] [Thread-3 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m18:00:01.724308 [info ] [Thread-2 (]: 13 of 13 PASS not_null_dim_product_scd2_from_snapshot_product_nk ............... [[32mPASS[0m in 0.84s]
[0m18:00:01.726917 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m18:00:01.735151 [info ] [Thread-1 (]: 11 of 13 PASS dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [[32mPASS[0m in 0.85s]
[0m18:00:01.737210 [debug] [Thread-1 (]: Finished running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m18:00:01.741234 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:00:01.742397 [debug] [MainThread]: Connection 'test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a' was properly closed.
[0m18:00:01.743469 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135' was properly closed.
[0m18:00:01.744794 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36' was properly closed.
[0m18:00:01.745828 [debug] [MainThread]: Connection 'model.product_catalog.dim_product_scd2_from_snapshot' was properly closed.
[0m18:00:01.746864 [info ] [MainThread]: 
[0m18:00:01.747966 [info ] [MainThread]: Finished running 1 view model, 9 tests, 2 table models, 1 snapshot in 0 hours 0 minutes and 10.41 seconds (10.41s).
[0m18:00:01.750863 [debug] [MainThread]: Command end result
[0m18:00:01.779149 [info ] [MainThread]: 
[0m18:00:01.780935 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:00:01.783202 [info ] [MainThread]: 
[0m18:00:01.784685 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m18:00:01.788471 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 12.231428, "process_user_time": 4.162497, "process_kernel_time": 0.935169, "process_mem_max_rss": "127528", "process_in_blocks": "27080", "process_out_blocks": "6472"}
[0m18:00:01.790105 [debug] [MainThread]: Command `dbt build` succeeded at 18:00:01.789918 after 12.23 seconds
[0m18:00:01.791167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe22784580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe1c43bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dfe20c43790>]}
[0m18:00:01.792371 [debug] [MainThread]: Flushing usage events
[0m05:18:31.957340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707bec8f0a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707bead219c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707bead21960>]}


============================== 05:18:31.969380 | 66543680-9aea-4860-945e-6570a0233e40 ==============================
[0m05:18:31.969380 [info ] [MainThread]: Running with dbt=1.7.10
[0m05:18:31.973776 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/product_catalog/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt build', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m05:18:32.756897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707bead5f5e0>]}
[0m05:18:32.890014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707beb6aeb60>]}
[0m05:18:32.900754 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m05:18:32.976108 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m05:18:36.716657 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:18:36.719328 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:18:36.729049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be99526b0>]}
[0m05:18:36.862693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be9ae5a50>]}
[0m05:18:36.865401 [info ] [MainThread]: Found 3 models, 1 snapshot, 9 tests, 1 source, 0 exposures, 0 metrics, 549 macros, 0 groups, 0 semantic models
[0m05:18:36.870939 [info ] [MainThread]: 
[0m05:18:36.874663 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m05:18:36.888519 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m05:18:36.891093 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m05:18:36.893454 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_PRODUCT_CATALOG'
[0m05:18:36.922326 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m05:18:36.923141 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m05:18:36.928905 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG"
[0m05:18:36.931525 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m05:18:36.933576 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m05:18:36.935515 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG"} */
show terse schemas in database PRODUCT_CATALOG
    limit 10000
[0m05:18:36.937650 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:18:36.939879 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:18:36.941778 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:18:39.148615 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 2.0 seconds
[0m05:18:39.150015 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 2.0 seconds
[0m05:18:39.151021 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 2.0 seconds
[0m05:18:39.154376 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m05:18:39.159003 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m05:18:39.162975 [debug] [ThreadPool]: On list_PRODUCT_CATALOG: Close
[0m05:18:39.326599 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_snapshots)
[0m05:18:39.328162 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_staging)
[0m05:18:39.329709 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG, now list_PRODUCT_CATALOG_CORE_core)
[0m05:18:39.345618 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_snapshots"
[0m05:18:39.348797 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_staging"
[0m05:18:39.353930 [debug] [ThreadPool]: Using snowflake connection "list_PRODUCT_CATALOG_CORE_core"
[0m05:18:39.356599 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_snapshots"} */
show terse objects in PRODUCT_CATALOG.snapshots limit 10000
[0m05:18:39.358749 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_staging"} */
show terse objects in PRODUCT_CATALOG.CORE_staging limit 10000
[0m05:18:39.360865 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "connection_name": "list_PRODUCT_CATALOG_CORE_core"} */
show terse objects in PRODUCT_CATALOG.CORE_core limit 10000
[0m05:18:39.362857 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:18:39.364822 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:18:39.366861 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:18:39.823234 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:18:39.827503 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_snapshots: Close
[0m05:18:39.842463 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:18:39.846661 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_staging: Close
[0m05:18:39.877552 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m05:18:39.881924 [debug] [ThreadPool]: On list_PRODUCT_CATALOG_CORE_core: Close
[0m05:18:40.023706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be998fee0>]}
[0m05:18:40.026648 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m05:18:40.028728 [info ] [MainThread]: 
[0m05:18:40.050541 [debug] [Thread-1 (]: Began running node model.product_catalog.stg_products
[0m05:18:40.053530 [info ] [Thread-1 (]: 1 of 13 START sql view model CORE_staging.stg_products ......................... [RUN]
[0m05:18:40.056621 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_core, now model.product_catalog.stg_products)
[0m05:18:40.058962 [debug] [Thread-1 (]: Began compiling node model.product_catalog.stg_products
[0m05:18:40.072528 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.stg_products"
[0m05:18:40.111143 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (compile): 05:18:40.061093 => 05:18:40.110650
[0m05:18:40.113803 [debug] [Thread-1 (]: Began executing node model.product_catalog.stg_products
[0m05:18:40.152904 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.stg_products"
[0m05:18:40.194339 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.stg_products"
[0m05:18:40.196760 [debug] [Thread-1 (]: On model.product_catalog.stg_products: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.stg_products"} */
create or replace   view PRODUCT_CATALOG.CORE_staging.stg_products
  
   as (
    

WITH base AS (
  SELECT
      TRY_TO_NUMBER(index)                                        AS row_idx,
      url,
      title,
      images,
      description,
      NULLIF(product_id, '')                                       AS product_id,
      NULLIF(sku, '')                                              AS sku,
      NULLIF(gtin13, '')                                           AS gtin13,
      NULLIF(brand, '')                                            AS brand,
      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\.]', ''), 18, 2) AS price,
      UPPER(NULLIF(currency, ''))                                   AS currency,
      LOWER(NULLIF(availability, ''))                               AS availability,
      NULLIF(uniq_id, '')                                          AS uniq_id,
      -- make it work whether column is text or timestamp
      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at
  FROM product_catalog.staging.raw_products
),
clean AS (
  SELECT
    row_idx,
    url,
    title,
    images,
    description,
    COALESCE(product_id, sku, uniq_id)        AS product_nk,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    COALESCE(currency, 'USD')                 AS currency,
    availability,
    uniq_id,
    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,
    CURRENT_TIMESTAMP()                       AS loaded_at
  FROM base
)
SELECT * FROM clean
  );
[0m05:18:40.199320 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:18:41.105444 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:41.136764 [debug] [Thread-1 (]: Timing info for model.product_catalog.stg_products (execute): 05:18:40.116049 => 05:18:41.136474
[0m05:18:41.139157 [debug] [Thread-1 (]: On model.product_catalog.stg_products: Close
[0m05:18:41.276880 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be991c400>]}
[0m05:18:41.279233 [info ] [Thread-1 (]: 1 of 13 OK created sql view model CORE_staging.stg_products .................... [[32mSUCCESS 1[0m in 1.22s]
[0m05:18:41.281752 [debug] [Thread-1 (]: Finished running node model.product_catalog.stg_products
[0m05:18:41.284704 [debug] [Thread-3 (]: Began running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m05:18:41.285444 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m05:18:41.286138 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m05:18:41.287543 [info ] [Thread-3 (]: 2 of 13 START test dbt_utils_accepted_range_stg_products_price__True__0 ........ [RUN]
[0m05:18:41.289458 [info ] [Thread-4 (]: 3 of 13 START test not_null_stg_products_product_nk ............................ [RUN]
[0m05:18:41.291773 [info ] [Thread-2 (]: 4 of 13 START test not_null_stg_products_updated_at ............................ [RUN]
[0m05:18:41.294417 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_snapshots, now test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e)
[0m05:18:41.297861 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.product_catalog.not_null_stg_products_product_nk.a931f51b61'
[0m05:18:41.300541 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_PRODUCT_CATALOG_CORE_staging, now test.product_catalog.not_null_stg_products_updated_at.7ba2e52730)
[0m05:18:41.303077 [debug] [Thread-3 (]: Began compiling node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m05:18:41.305459 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m05:18:41.307637 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m05:18:41.330903 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m05:18:41.345358 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m05:18:41.352360 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m05:18:41.383475 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (compile): 05:18:41.346547 => 05:18:41.382725
[0m05:18:41.384449 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (compile): 05:18:41.309628 => 05:18:41.383979
[0m05:18:41.387720 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m05:18:41.388685 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (compile): 05:18:41.331442 => 05:18:41.388296
[0m05:18:41.391106 [debug] [Thread-3 (]: Began executing node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m05:18:41.416314 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m05:18:41.418258 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m05:18:41.426151 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m05:18:41.432351 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m05:18:41.462227 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"
[0m05:18:41.463686 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"
[0m05:18:41.464597 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"
[0m05:18:41.466228 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products
where updated_at is null



      
    ) dbt_internal_test
[0m05:18:41.468697 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with meet_condition as(
  select *
  from PRODUCT_CATALOG.CORE_staging.stg_products
),

validation_errors as (
  select *
  from meet_condition
  where
    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds
    1 = 2
    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.
    or not price >= 0
)

select *
from validation_errors


      
    ) dbt_internal_test
[0m05:18:41.471305 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_stg_products_product_nk.a931f51b61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_staging.stg_products
where product_nk is null



      
    ) dbt_internal_test
[0m05:18:41.473776 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:18:41.476228 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:18:41.478393 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m05:18:42.729189 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:42.730431 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:42.735737 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_stg_products_product_nk.a931f51b61 (execute): 05:18:41.428048 => 05:18:42.735369
[0m05:18:42.740111 [debug] [Thread-3 (]: Timing info for test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e (execute): 05:18:41.420533 => 05:18:42.739728
[0m05:18:42.742630 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:42.744089 [debug] [Thread-4 (]: On test.product_catalog.not_null_stg_products_product_nk.a931f51b61: Close
[0m05:18:42.746145 [debug] [Thread-3 (]: On test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e: Close
[0m05:18:42.750671 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_stg_products_updated_at.7ba2e52730 (execute): 05:18:41.393019 => 05:18:42.750359
[0m05:18:42.760627 [debug] [Thread-2 (]: On test.product_catalog.not_null_stg_products_updated_at.7ba2e52730: Close
[0m05:18:42.873683 [info ] [Thread-3 (]: 2 of 13 PASS dbt_utils_accepted_range_stg_products_price__True__0 .............. [[32mPASS[0m in 1.58s]
[0m05:18:42.876264 [debug] [Thread-3 (]: Finished running node test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e
[0m05:18:42.884210 [info ] [Thread-4 (]: 3 of 13 PASS not_null_stg_products_product_nk .................................. [[32mPASS[0m in 1.59s]
[0m05:18:42.887165 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_stg_products_product_nk.a931f51b61
[0m05:18:42.894366 [info ] [Thread-2 (]: 4 of 13 PASS not_null_stg_products_updated_at .................................. [[32mPASS[0m in 1.59s]
[0m05:18:42.897369 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_stg_products_updated_at.7ba2e52730
[0m05:18:42.900416 [debug] [Thread-1 (]: Began running node model.product_catalog.dim_product_scd2_window
[0m05:18:42.901395 [debug] [Thread-3 (]: Began running node snapshot.product_catalog.product_snapshot
[0m05:18:42.903348 [info ] [Thread-1 (]: 5 of 13 START sql table model CORE_core.dim_product_scd2_window ................ [RUN]
[0m05:18:42.905921 [info ] [Thread-3 (]: 6 of 13 START snapshot snapshots.product_snapshot .............................. [RUN]
[0m05:18:42.909377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.stg_products, now model.product_catalog.dim_product_scd2_window)
[0m05:18:42.913553 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e, now snapshot.product_catalog.product_snapshot)
[0m05:18:42.915706 [debug] [Thread-1 (]: Began compiling node model.product_catalog.dim_product_scd2_window
[0m05:18:42.918058 [debug] [Thread-3 (]: Began compiling node snapshot.product_catalog.product_snapshot
[0m05:18:42.943501 [debug] [Thread-3 (]: Timing info for snapshot.product_catalog.product_snapshot (compile): 05:18:42.939003 => 05:18:42.943032
[0m05:18:42.950094 [debug] [Thread-1 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_window"
[0m05:18:42.951355 [debug] [Thread-3 (]: Began executing node snapshot.product_catalog.product_snapshot
[0m05:18:43.018282 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:43.019207 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (compile): 05:18:42.920281 => 05:18:43.018759
[0m05:18:43.020956 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m05:18:43.023340 [debug] [Thread-1 (]: Began executing node model.product_catalog.dim_product_scd2_window
[0m05:18:43.025497 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:18:43.060832 [debug] [Thread-1 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_window"
[0m05:18:43.099093 [debug] [Thread-1 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_window"
[0m05:18:43.101847 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_window"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
         as
        (

WITH src AS (
  SELECT
    row_idx,
    product_nk,
    url,
    title,
    images,
    description,
    product_id,
    sku,
    gtin13,
    brand,
    price,
    currency,
    availability,
    uniq_id,
    updated_at
  FROM PRODUCT_CATALOG.CORE_staging.stg_products
),

-- keep one row per (product_nk, updated_at)
dedup AS (
  SELECT *
  FROM src
  QUALIFY ROW_NUMBER() OVER (
    PARTITION BY product_nk, updated_at
    ORDER BY row_idx
  ) = 1
),

-- build SCD2 boundaries with window functions
ordered AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    updated_at,
    LAG(updated_at)  OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_from,
    LEAD(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_to
  FROM dedup
),

final AS (
  SELECT
    md5(cast(coalesce(cast(product_nk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(valid_from as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS dim_product_sk,
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    COALESCE(valid_from, updated_at) AS valid_from,
    valid_to,
    IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
    CURRENT_TIMESTAMP() AS dbt_loaded_at
  FROM ordered
)

SELECT * FROM final
        );
[0m05:18:43.104073 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:18:43.430644 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m05:18:43.454717 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:43.457149 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
create or replace temporary table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
         as
        (with snapshot_query as (

        

select
  product_nk,
  url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  updated_at
from PRODUCT_CATALOG.CORE_staging.stg_products

    ),

    snapshotted_data as (

        select *,
            product_nk as dbt_unique_key

        from "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            product_nk as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            nullif(updated_at, updated_at) as dbt_valid_to,
            md5(coalesce(cast(product_nk as varchar ), '')
         || '|' || coalesce(cast(updated_at as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            product_nk as dbt_unique_key,
            updated_at as dbt_updated_at,
            updated_at as dbt_valid_from,
            updated_at as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.updated_at)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.updated_at)
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m05:18:44.689810 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m05:18:44.695445 [debug] [Thread-1 (]: Timing info for model.product_catalog.dim_product_scd2_window (execute): 05:18:43.027507 => 05:18:44.695137
[0m05:18:44.697696 [debug] [Thread-1 (]: On model.product_catalog.dim_product_scd2_window: Close
[0m05:18:44.858333 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be8702020>]}
[0m05:18:44.861874 [info ] [Thread-1 (]: 5 of 13 OK created sql table model CORE_core.dim_product_scd2_window ........... [[32mSUCCESS 1[0m in 1.95s]
[0m05:18:44.864536 [debug] [Thread-1 (]: Finished running node model.product_catalog.dim_product_scd2_window
[0m05:18:44.867262 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m05:18:44.867955 [debug] [Thread-4 (]: Began running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m05:18:44.868658 [debug] [Thread-1 (]: Began running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m05:18:44.870271 [info ] [Thread-2 (]: 7 of 13 START test not_null_dim_product_scd2_window_dim_product_sk ............. [RUN]
[0m05:18:44.872933 [info ] [Thread-4 (]: 8 of 13 START test not_null_dim_product_scd2_window_product_nk ................. [RUN]
[0m05:18:44.875693 [info ] [Thread-1 (]: 9 of 13 START test unique_dim_product_scd2_window_dim_product_sk ............... [RUN]
[0m05:18:44.881864 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_updated_at.7ba2e52730, now test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376)
[0m05:18:44.884850 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_stg_products_product_nk.a931f51b61, now test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e)
[0m05:18:44.888004 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.product_catalog.dim_product_scd2_window, now test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e)
[0m05:18:44.890663 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m05:18:44.894944 [debug] [Thread-4 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m05:18:44.897179 [debug] [Thread-1 (]: Began compiling node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m05:18:44.906555 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m05:18:44.917144 [debug] [Thread-4 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m05:18:44.927950 [debug] [Thread-1 (]: Writing injected SQL for node "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m05:18:44.954719 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376 (compile): 05:18:44.898998 => 05:18:44.953983
[0m05:18:44.957521 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m05:18:44.964824 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m05:18:44.967649 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m05:18:44.971211 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e (compile): 05:18:44.908342 => 05:18:44.970631
[0m05:18:44.977562 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:44.978681 [debug] [Thread-1 (]: Timing info for test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e (compile): 05:18:44.918791 => 05:18:44.978203
[0m05:18:44.980476 [debug] [Thread-4 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m05:18:44.982793 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m05:18:44.984954 [debug] [Thread-1 (]: Began executing node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m05:18:44.991057 [debug] [Thread-4 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m05:18:45.001781 [debug] [Thread-1 (]: Writing runtime sql for node "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m05:18:45.005444 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"
[0m05:18:45.008825 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select dim_product_sk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where dim_product_sk is null



      
    ) dbt_internal_test
[0m05:18:45.011286 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:18:45.033175 [debug] [Thread-1 (]: Using snowflake connection "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"
[0m05:18:45.034945 [debug] [Thread-4 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"
[0m05:18:45.036903 [debug] [Thread-1 (]: On test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    dim_product_sk as unique_field,
    count(*) as n_records

from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where dim_product_sk is not null
group by dim_product_sk
having count(*) > 1



      
    ) dbt_internal_test
[0m05:18:45.039262 [debug] [Thread-4 (]: On test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_window
where product_nk is null



      
    ) dbt_internal_test
[0m05:18:45.041402 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:18:45.043436 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:18:45.096725 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m05:18:45.107514 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:45.110388 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m05:18:45.207474 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m05:18:45.215935 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:45.218471 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m05:18:45.336254 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m05:18:45.344720 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:45.347001 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT"
[0m05:18:45.451103 [debug] [Thread-3 (]: SQL status: SUCCESS 18 in 0.0 seconds
[0m05:18:45.463460 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:45.465844 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
describe table "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp"
[0m05:18:45.579708 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:45.581996 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:45.586299 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376 (execute): 05:18:44.959527 => 05:18:45.585682
[0m05:18:45.590769 [debug] [Thread-4 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e (execute): 05:18:44.987022 => 05:18:45.590400
[0m05:18:45.593499 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376: Close
[0m05:18:45.595675 [debug] [Thread-4 (]: On test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e: Close
[0m05:18:45.605307 [debug] [Thread-3 (]: SQL status: SUCCESS 20 in 0.0 seconds
[0m05:18:45.619249 [debug] [Thread-3 (]: Writing runtime sql for node "snapshot.product_catalog.product_snapshot"
[0m05:18:45.654267 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:45.656515 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
BEGIN
[0m05:18:45.686785 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:45.691301 [debug] [Thread-1 (]: Timing info for test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e (execute): 05:18:44.997035 => 05:18:45.690795
[0m05:18:45.693288 [debug] [Thread-1 (]: On test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e: Close
[0m05:18:45.748499 [info ] [Thread-4 (]: 8 of 13 PASS not_null_dim_product_scd2_window_product_nk ....................... [[32mPASS[0m in 0.86s]
[0m05:18:45.752705 [debug] [Thread-4 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e
[0m05:18:45.757911 [info ] [Thread-2 (]: 7 of 13 PASS not_null_dim_product_scd2_window_dim_product_sk ................... [[32mPASS[0m in 0.88s]
[0m05:18:45.762261 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376
[0m05:18:45.864256 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m05:18:45.868659 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:45.867839 [info ] [Thread-1 (]: 9 of 13 PASS unique_dim_product_scd2_window_dim_product_sk ..................... [[32mPASS[0m in 0.98s]
[0m05:18:45.871075 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
merge into "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT" as DBT_INTERNAL_DEST
    using "PRODUCT_CATALOG"."SNAPSHOTS"."PRODUCT_SNAPSHOT__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("PRODUCT_NK", "URL", "TITLE", "IMAGES", "DESCRIPTION", "PRODUCT_ID", "SKU", "GTIN13", "BRAND", "PRICE", "CURRENCY", "AVAILABILITY", "UNIQ_ID", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("PRODUCT_NK", "URL", "TITLE", "IMAGES", "DESCRIPTION", "PRODUCT_ID", "SKU", "GTIN13", "BRAND", "PRICE", "CURRENCY", "AVAILABILITY", "UNIQ_ID", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m05:18:45.873602 [debug] [Thread-1 (]: Finished running node test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e
[0m05:18:46.639207 [debug] [Thread-3 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m05:18:46.642197 [debug] [Thread-3 (]: Using snowflake connection "snapshot.product_catalog.product_snapshot"
[0m05:18:46.644057 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "snapshot.product_catalog.product_snapshot"} */
COMMIT
[0m05:18:47.147651 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:47.155926 [debug] [Thread-3 (]: Timing info for snapshot.product_catalog.product_snapshot (execute): 05:18:42.955542 => 05:18:47.155234
[0m05:18:47.158092 [debug] [Thread-3 (]: On snapshot.product_catalog.product_snapshot: Close
[0m05:18:47.289467 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be868c490>]}
[0m05:18:47.292952 [info ] [Thread-3 (]: 6 of 13 OK snapshotted snapshots.product_snapshot .............................. [[32mSUCCESS 2[0m in 4.38s]
[0m05:18:47.296626 [debug] [Thread-3 (]: Finished running node snapshot.product_catalog.product_snapshot
[0m05:18:47.300178 [debug] [Thread-4 (]: Began running node model.product_catalog.dim_product_scd2_from_snapshot
[0m05:18:47.302604 [info ] [Thread-4 (]: 10 of 13 START sql table model CORE_core.dim_product_scd2_from_snapshot ........ [RUN]
[0m05:18:47.305344 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e, now model.product_catalog.dim_product_scd2_from_snapshot)
[0m05:18:47.307801 [debug] [Thread-4 (]: Began compiling node model.product_catalog.dim_product_scd2_from_snapshot
[0m05:18:47.321387 [debug] [Thread-4 (]: Writing injected SQL for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m05:18:47.364591 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (compile): 05:18:47.309739 => 05:18:47.364043
[0m05:18:47.366943 [debug] [Thread-4 (]: Began executing node model.product_catalog.dim_product_scd2_from_snapshot
[0m05:18:47.374177 [debug] [Thread-4 (]: Writing runtime sql for node "model.product_catalog.dim_product_scd2_from_snapshot"
[0m05:18:47.409198 [debug] [Thread-4 (]: Using snowflake connection "model.product_catalog.dim_product_scd2_from_snapshot"
[0m05:18:47.411577 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "model.product_catalog.dim_product_scd2_from_snapshot"} */
create or replace transient table PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
         as
        (

WITH snap AS (
  SELECT
    product_nk,
    url, title, images, description,
    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
    dbt_valid_from AS valid_from,
    dbt_valid_to   AS valid_to
  FROM PRODUCT_CATALOG.snapshots.product_snapshot
),
dedup AS (
  SELECT DISTINCT * FROM snap
)
SELECT
  MD5( COALESCE(CAST(product_nk AS STRING), '') || COALESCE(CAST(valid_from AS STRING), '') ) AS dim_product_sk,
  product_nk, url, title, images, description,
  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,
  valid_from, valid_to,
  IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,
  CURRENT_TIMESTAMP() AS dbt_loaded_at
FROM dedup
        );
[0m05:18:47.413655 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m05:18:49.086655 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m05:18:49.093365 [debug] [Thread-4 (]: Timing info for model.product_catalog.dim_product_scd2_from_snapshot (execute): 05:18:47.368702 => 05:18:49.093060
[0m05:18:49.095882 [debug] [Thread-4 (]: On model.product_catalog.dim_product_scd2_from_snapshot: Close
[0m05:18:49.235815 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66543680-9aea-4860-945e-6570a0233e40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be86734c0>]}
[0m05:18:49.238704 [info ] [Thread-4 (]: 10 of 13 OK created sql table model CORE_core.dim_product_scd2_from_snapshot ... [[32mSUCCESS 1[0m in 1.93s]
[0m05:18:49.241611 [debug] [Thread-4 (]: Finished running node model.product_catalog.dim_product_scd2_from_snapshot
[0m05:18:49.245138 [debug] [Thread-1 (]: Began running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m05:18:49.245964 [debug] [Thread-3 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m05:18:49.246776 [debug] [Thread-2 (]: Began running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m05:18:49.248701 [info ] [Thread-1 (]: 11 of 13 START test dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [RUN]
[0m05:18:49.250941 [info ] [Thread-3 (]: 12 of 13 START test not_null_dim_product_scd2_from_snapshot_is_current ......... [RUN]
[0m05:18:49.254060 [info ] [Thread-2 (]: 13 of 13 START test not_null_dim_product_scd2_from_snapshot_product_nk ......... [RUN]
[0m05:18:49.257493 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e, now test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a)
[0m05:18:49.262459 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly snapshot.product_catalog.product_snapshot, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135)
[0m05:18:49.266406 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376, now test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36)
[0m05:18:49.269471 [debug] [Thread-1 (]: Began compiling node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m05:18:49.271920 [debug] [Thread-3 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m05:18:49.274565 [debug] [Thread-2 (]: Began compiling node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m05:18:49.302785 [debug] [Thread-1 (]: Writing injected SQL for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m05:18:49.303393 [debug] [Thread-3 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m05:18:49.310983 [debug] [Thread-2 (]: Writing injected SQL for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m05:18:49.338889 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (compile): 05:18:49.296086 => 05:18:49.338293
[0m05:18:49.339952 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (compile): 05:18:49.304947 => 05:18:49.339352
[0m05:18:49.341726 [debug] [Thread-3 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m05:18:49.343682 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (compile): 05:18:49.277483 => 05:18:49.343160
[0m05:18:49.345609 [debug] [Thread-2 (]: Began executing node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m05:18:49.352065 [debug] [Thread-3 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m05:18:49.354987 [debug] [Thread-1 (]: Began executing node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m05:18:49.362917 [debug] [Thread-2 (]: Writing runtime sql for node "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m05:18:49.370322 [debug] [Thread-1 (]: Writing runtime sql for node "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m05:18:49.398915 [debug] [Thread-3 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"
[0m05:18:49.400596 [debug] [Thread-2 (]: Using snowflake connection "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"
[0m05:18:49.402315 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select is_current
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where is_current is null



      
    ) dbt_internal_test
[0m05:18:49.403996 [debug] [Thread-1 (]: Using snowflake connection "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"
[0m05:18:49.405588 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select product_nk
from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
where product_nk is null



      
    ) dbt_internal_test
[0m05:18:49.407909 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m05:18:49.410433 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "product_catalog", "target_name": "dev", "node_id": "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      





with validation_errors as (

    select
        product_nk, valid_from
    from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot
    group by product_nk, valid_from
    having count(*) > 1

)

select *
from validation_errors



      
    ) dbt_internal_test
[0m05:18:49.412672 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m05:18:49.418433 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:18:50.064501 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:50.069483 [debug] [Thread-3 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135 (execute): 05:18:49.347421 => 05:18:50.069126
[0m05:18:50.071916 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:50.073159 [debug] [Thread-3 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135: Close
[0m05:18:50.077855 [debug] [Thread-2 (]: Timing info for test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36 (execute): 05:18:49.357327 => 05:18:50.077534
[0m05:18:50.084990 [debug] [Thread-2 (]: On test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36: Close
[0m05:18:50.185978 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m05:18:50.191043 [debug] [Thread-1 (]: Timing info for test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a (execute): 05:18:49.365882 => 05:18:50.190530
[0m05:18:50.193434 [debug] [Thread-1 (]: On test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a: Close
[0m05:18:50.228764 [info ] [Thread-3 (]: 12 of 13 PASS not_null_dim_product_scd2_from_snapshot_is_current ............... [[32mPASS[0m in 0.97s]
[0m05:18:50.231842 [debug] [Thread-3 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135
[0m05:18:50.278797 [info ] [Thread-2 (]: 13 of 13 PASS not_null_dim_product_scd2_from_snapshot_product_nk ............... [[32mPASS[0m in 1.01s]
[0m05:18:50.282017 [debug] [Thread-2 (]: Finished running node test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36
[0m05:18:50.344527 [info ] [Thread-1 (]: 11 of 13 PASS dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from  [[32mPASS[0m in 1.09s]
[0m05:18:50.347585 [debug] [Thread-1 (]: Finished running node test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a
[0m05:18:50.352809 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:18:50.355406 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135' was properly closed.
[0m05:18:50.358140 [debug] [MainThread]: Connection 'test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36' was properly closed.
[0m05:18:50.360385 [debug] [MainThread]: Connection 'test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a' was properly closed.
[0m05:18:50.362720 [debug] [MainThread]: Connection 'model.product_catalog.dim_product_scd2_from_snapshot' was properly closed.
[0m05:18:50.364982 [info ] [MainThread]: 
[0m05:18:50.367407 [info ] [MainThread]: Finished running 1 view model, 9 tests, 2 table models, 1 snapshot in 0 hours 0 minutes and 13.49 seconds (13.49s).
[0m05:18:50.374809 [debug] [MainThread]: Command end result
[0m05:18:50.441296 [info ] [MainThread]: 
[0m05:18:50.443244 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:18:50.445360 [info ] [MainThread]: 
[0m05:18:50.448705 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m05:18:50.452935 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 18.700731, "process_user_time": 7.19967, "process_kernel_time": 2.172104, "process_mem_max_rss": "126320", "process_in_blocks": "93912", "process_out_blocks": "6496"}
[0m05:18:50.455320 [debug] [MainThread]: Command `dbt build` succeeded at 05:18:50.455123 after 18.70 seconds
[0m05:18:50.457244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707bec8f0a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be9d7e140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x707be8673a30>]}
[0m05:18:50.459300 [debug] [MainThread]: Flushing usage events

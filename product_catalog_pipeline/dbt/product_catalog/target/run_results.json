{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.10", "generated_at": "2025-11-13T05:18:50.369514Z", "invocation_id": "66543680-9aea-4860-945e-6570a0233e40", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:40.061093Z", "completed_at": "2025-11-13T05:18:40.110650Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:40.116049Z", "completed_at": "2025-11-13T05:18:41.136474Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.220804214477539, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0178-0016-c3df000221aa"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.product_catalog.stg_products", "compiled": true, "compiled_code": "\n\nWITH base AS (\n  SELECT\n      TRY_TO_NUMBER(index)                                        AS row_idx,\n      url,\n      title,\n      images,\n      description,\n      NULLIF(product_id, '')                                       AS product_id,\n      NULLIF(sku, '')                                              AS sku,\n      NULLIF(gtin13, '')                                           AS gtin13,\n      NULLIF(brand, '')                                            AS brand,\n      TRY_TO_DECIMAL(REGEXP_REPLACE(price, '[^0-9\\.]', ''), 18, 2) AS price,\n      UPPER(NULLIF(currency, ''))                                   AS currency,\n      LOWER(NULLIF(availability, ''))                               AS availability,\n      NULLIF(uniq_id, '')                                          AS uniq_id,\n      -- make it work whether column is text or timestamp\n      TRY_TO_TIMESTAMP_NTZ(scraped_at::STRING)                      AS scraped_at\n  FROM product_catalog.staging.raw_products\n),\nclean AS (\n  SELECT\n    row_idx,\n    url,\n    title,\n    images,\n    description,\n    COALESCE(product_id, sku, uniq_id)        AS product_nk,\n    product_id,\n    sku,\n    gtin13,\n    brand,\n    price,\n    COALESCE(currency, 'USD')                 AS currency,\n    availability,\n    uniq_id,\n    COALESCE(scraped_at, CURRENT_TIMESTAMP()) AS updated_at,\n    CURRENT_TIMESTAMP()                       AS loaded_at\n  FROM base\n)\nSELECT * FROM clean", "relation_name": "PRODUCT_CATALOG.CORE_staging.stg_products"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:41.309628Z", "completed_at": "2025-11-13T05:18:41.383979Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:41.420533Z", "completed_at": "2025-11-13T05:18:42.739728Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.5794107913970947, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0178-0016-c3df000221ae"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.dbt_utils_accepted_range_stg_products_price__True__0.12de3f926e", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from PRODUCT_CATALOG.CORE_staging.stg_products\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not price >= 0\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:41.331442Z", "completed_at": "2025-11-13T05:18:41.388296Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:41.428048Z", "completed_at": "2025-11-13T05:18:42.735369Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.5872690677642822, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0184-0016-c3df000211a6"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.not_null_stg_products_product_nk.a931f51b61", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect product_nk\nfrom PRODUCT_CATALOG.CORE_staging.stg_products\nwhere product_nk is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:41.346547Z", "completed_at": "2025-11-13T05:18:41.382725Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:41.393019Z", "completed_at": "2025-11-13T05:18:42.750359Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.5942087173461914, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0184-0016-c3df000211a2"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.not_null_stg_products_updated_at.7ba2e52730", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect updated_at\nfrom PRODUCT_CATALOG.CORE_staging.stg_products\nwhere updated_at is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:42.920281Z", "completed_at": "2025-11-13T05:18:43.018759Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:43.027507Z", "completed_at": "2025-11-13T05:18:44.695137Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.9495832920074463, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0184-0016-c3df000211ae"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.product_catalog.dim_product_scd2_window", "compiled": true, "compiled_code": "\n\nWITH src AS (\n  SELECT\n    row_idx,\n    product_nk,\n    url,\n    title,\n    images,\n    description,\n    product_id,\n    sku,\n    gtin13,\n    brand,\n    price,\n    currency,\n    availability,\n    uniq_id,\n    updated_at\n  FROM PRODUCT_CATALOG.CORE_staging.stg_products\n),\n\n-- keep one row per (product_nk, updated_at)\ndedup AS (\n  SELECT *\n  FROM src\n  QUALIFY ROW_NUMBER() OVER (\n    PARTITION BY product_nk, updated_at\n    ORDER BY row_idx\n  ) = 1\n),\n\n-- build SCD2 boundaries with window functions\nordered AS (\n  SELECT\n    product_nk,\n    url, title, images, description,\n    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,\n    updated_at,\n    LAG(updated_at)  OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_from,\n    LEAD(updated_at) OVER (PARTITION BY product_nk ORDER BY updated_at) AS valid_to\n  FROM dedup\n),\n\nfinal AS (\n  SELECT\n    md5(cast(coalesce(cast(product_nk as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(valid_from as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) AS dim_product_sk,\n    product_nk,\n    url, title, images, description,\n    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,\n    COALESCE(valid_from, updated_at) AS valid_from,\n    valid_to,\n    IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,\n    CURRENT_TIMESTAMP() AS dbt_loaded_at\n  FROM ordered\n)\n\nSELECT * FROM final", "relation_name": "PRODUCT_CATALOG.CORE_core.dim_product_scd2_window"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:44.908342Z", "completed_at": "2025-11-13T05:18:44.970631Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:44.987022Z", "completed_at": "2025-11-13T05:18:45.590400Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.864149808883667, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0178-0016-c3df000221c2"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.not_null_dim_product_scd2_window_product_nk.1869b27f5e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect product_nk\nfrom PRODUCT_CATALOG.CORE_core.dim_product_scd2_window\nwhere product_nk is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:44.898998Z", "completed_at": "2025-11-13T05:18:44.953983Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:44.959527Z", "completed_at": "2025-11-13T05:18:45.585682Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.8765158653259277, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0178-0016-c3df000221be"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.not_null_dim_product_scd2_window_dim_product_sk.d7d91fd376", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect dim_product_sk\nfrom PRODUCT_CATALOG.CORE_core.dim_product_scd2_window\nwhere dim_product_sk is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:44.918791Z", "completed_at": "2025-11-13T05:18:44.978203Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:44.997035Z", "completed_at": "2025-11-13T05:18:45.690795Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.9798917770385742, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0178-0016-c3df000221c6"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.unique_dim_product_scd2_window_dim_product_sk.06c5a4ec7e", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    dim_product_sk as unique_field,\n    count(*) as n_records\n\nfrom PRODUCT_CATALOG.CORE_core.dim_product_scd2_window\nwhere dim_product_sk is not null\ngroup by dim_product_sk\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:42.939003Z", "completed_at": "2025-11-13T05:18:42.943032Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:42.955542Z", "completed_at": "2025-11-13T05:18:47.155234Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 4.3762688636779785, "adapter_response": {"_message": "SUCCESS 2", "code": "SUCCESS", "rows_affected": 2, "query_id": "01c05b5e-0107-0184-0016-c3df000211be"}, "message": "SUCCESS 2", "failures": null, "unique_id": "snapshot.product_catalog.product_snapshot", "compiled": true, "compiled_code": "\n\nselect\n  product_nk,\n  url, title, images, description,\n  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,\n  updated_at\nfrom PRODUCT_CATALOG.CORE_staging.stg_products", "relation_name": "PRODUCT_CATALOG.snapshots.product_snapshot"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:47.309739Z", "completed_at": "2025-11-13T05:18:47.364043Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:47.368702Z", "completed_at": "2025-11-13T05:18:49.093060Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.930760383605957, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0184-0016-c3df000211c6"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.product_catalog.dim_product_scd2_from_snapshot", "compiled": true, "compiled_code": "\n\nWITH snap AS (\n  SELECT\n    product_nk,\n    url, title, images, description,\n    product_id, sku, gtin13, brand, price, currency, availability, uniq_id,\n    dbt_valid_from AS valid_from,\n    dbt_valid_to   AS valid_to\n  FROM PRODUCT_CATALOG.snapshots.product_snapshot\n),\ndedup AS (\n  SELECT DISTINCT * FROM snap\n)\nSELECT\n  MD5( COALESCE(CAST(product_nk AS STRING), '') || COALESCE(CAST(valid_from AS STRING), '') ) AS dim_product_sk,\n  product_nk, url, title, images, description,\n  product_id, sku, gtin13, brand, price, currency, availability, uniq_id,\n  valid_from, valid_to,\n  IFF(valid_to IS NULL, TRUE, FALSE) AS is_current,\n  CURRENT_TIMESTAMP() AS dbt_loaded_at\nFROM dedup", "relation_name": "PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot"}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:49.296086Z", "completed_at": "2025-11-13T05:18:49.338293Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:49.347421Z", "completed_at": "2025-11-13T05:18:50.069126Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.9668972492218018, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0178-0016-c3df000221d2"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_is_current.d885c5e135", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect is_current\nfrom PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot\nwhere is_current is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:49.304947Z", "completed_at": "2025-11-13T05:18:49.339352Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:49.357327Z", "completed_at": "2025-11-13T05:18:50.077534Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.0129187107086182, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0178-0016-c3df000221ce"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.not_null_dim_product_scd2_from_snapshot_product_nk.383f575d36", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect product_nk\nfrom PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot\nwhere product_nk is null\n\n\n", "relation_name": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-11-13T05:18:49.277483Z", "completed_at": "2025-11-13T05:18:49.343160Z"}, {"name": "execute", "started_at": "2025-11-13T05:18:49.365882Z", "completed_at": "2025-11-13T05:18:50.190530Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.0875730514526367, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c05b5e-0107-0184-0016-c3df000211ca"}, "message": null, "failures": 0, "unique_id": "test.product_catalog.dbt_utils_unique_combination_of_columns_dim_product_scd2_from_snapshot_product_nk__valid_from.f65b13106a", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        product_nk, valid_from\n    from PRODUCT_CATALOG.CORE_core.dim_product_scd2_from_snapshot\n    group by product_nk, valid_from\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}], "elapsed_time": 13.490894079208374, "args": {"favor_state": false, "log_path": "/usr/app/dbt/product_catalog/logs", "version_check": true, "printer_width": 80, "warn_error_options": {"include": [], "exclude": []}, "which": "build", "partial_parse_file_diff": true, "indirect_selection": "eager", "write_json": true, "project_dir": "/usr/app/dbt/product_catalog", "log_file_max_bytes": 10485760, "populate_cache": true, "log_format_file": "debug", "send_anonymous_usage_stats": true, "use_colors_file": true, "print": true, "invocation_command": "dbt build", "cache_selected_only": false, "profiles_dir": "/usr/app/dbt", "show": false, "vars": {}, "partial_parse": true, "macro_debugging": false, "defer": false, "select": [], "quiet": false, "log_level_file": "debug", "include_saved_query": false, "log_format": "default", "exclude": [], "log_level": "info", "static_parser": true, "enable_legacy_logger": false, "strict_mode": false, "use_colors": true, "show_resource_report": false, "resource_types": [], "introspect": true}}